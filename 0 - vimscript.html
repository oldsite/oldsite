<!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Prerequisites / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="00.html#prerequisites">Prerequisites</a><ul>
<li><a href="00.html#creating-a-vimrc-file">Creating a Vimrc File</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="../acknowledgements.html">&laquo; Prev</a>
            
            
                <a class="next" href="01.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="prerequisites">Prerequisites</h1>
<p>To use this book you should have the latest version of Vim installed, which is
version 7.3 at the time of this writing.  New versions of Vim are almost always
backwards-compatible, so everything in this book should work fine with anything
after 7.3 too.</p>
<p>Nothing in this book is specific to console Vim or GUI Vims like gVim or MacVim.
You can use whichever you prefer.</p>
<p>You should be comfortable editing files in Vim.  You should know basic Vim
terminology like "buffer", "window", "normal mode", "insert mode" and "text
object".</p>
<p>If you're not at that point yet you should go through the <code>vimtutor</code> program,
use Vim exclusively for a month or two, and come back when you've got Vim burned
into your fingers.</p>
<p>You'll also need to have some programming experience.  If you've never
programmed before check out <a href="http://learnpythonthehardway.org/">Learn Python the Hard
Way</a> first and come back to this book when
you're done.</p>
<h2 id="creating-a-vimrc-file">Creating a Vimrc File</h2>
<p>If you already know what a <code>~/.vimrc</code> file is and have one, go on to the next
chapter.</p>
<p>A <code>~/.vimrc</code> file is a file you create that contains some Vimscript code.  Vim
will automatically run the code inside this file every time you open Vim.</p>
<p>On Linux and Mac OS X this file is located in your home directory and named
<code>.vimrc</code>.</p>
<p>On Windows this file is located in your home folder and named <code>_vimrc</code>.</p>
<p>To easily find the location and name of the file on <em>any</em> operating system, run
<code>:echo $MYVIMRC</code> in Vim.  The path will be displayed at the bottom of the
screen.</p>
<p>Create this file if it doesn't already exist.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="../acknowledgements.html">&laquo; Previous</a>
            
            
                <a class="next" href="01.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Echoing Messages / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="01.html#echoing-messages">Echoing Messages</a><ul>
<li><a href="01.html#persistent-echoing">Persistent Echoing</a></li>
<li><a href="01.html#comments">Comments</a></li>
<li><a href="01.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="00.html">&laquo; Prev</a>
            
            
                <a class="next" href="02.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="echoing-messages">Echoing Messages</h1>
<p>The first pieces of Vimscript we'll look at are the <code>echo</code> and <code>echom</code> commands.</p>
<p>You can read their full documentation by running <code>:help echo</code> and <code>:help echom</code>
in Vim.  As you go through this book you should try to read the <code>:help</code> for
every new command you encounter to learn more about them.</p>
<p>Try out <code>echo</code> by running the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo "Hello, world!"</code></pre>


<p>You should see <code>Hello, world!</code> appear at the bottom of the window.</p>
<h2 id="persistent-echoing">Persistent Echoing</h2>
<p>Now try out <code>echom</code> by running the following command.</p>
<pre class="codehilite"><code class="language-vim">:echom "Hello again, world!"</code></pre>


<p>You should see <code>Hello again, world!</code> appear at the bottom of the window.</p>
<p>To see the difference between these two commands, run the following:</p>
<pre class="codehilite"><code class="language-vim">:messages</code></pre>


<p>You should see a list of messages.  <code>Hello, world!</code> will <em>not</em> be in this list,
but <code>Hello again, world!</code> <em>will</em> be in it.</p>
<p>When you're writing more complicated Vimscript later in this book you may find
yourself wanting to "print some output" to help you debug problems.  Plain old
<code>:echo</code> will print output, but it will often disappear by the time your script
is done.  Using <code>:echom</code> will save the output and let you run <code>:messages</code> to
view it later.</p>
<h2 id="comments">Comments</h2>
<p>Before moving on, let's look at how to add comments.  When you write Vimscript
code (in your <code>~/.vimrc</code> file or any other one) you can add comments with the
<code>"</code> character, like this:</p>
<pre class="codehilite"><code class="language-vim">" Make space more useful
nnoremap &lt;space&gt; za</code></pre>


<p>This doesn't <em>always</em> work (that's one of those ugly corners of Vimscript), but
in most cases it does.  Later we'll talk about when it won't (and why that
happens).</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help echo</code>.</p>
<p>Read <code>:help echom</code>.</p>
<p>Read <code>:help :messages</code>.</p>
<p>Add a line to your <code>~/.vimrc</code> file that displays a friendly ASCII-art cat
(<code>&gt;^.^&lt;</code>) whenever you open Vim.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="00.html">&laquo; Previous</a>
            
            
                <a class="next" href="02.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Setting Options / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="02.html#setting-options">Setting Options</a><ul>
<li><a href="02.html#boolean-options">Boolean Options</a></li>
<li><a href="02.html#toggling-boolean-options">Toggling Boolean Options</a></li>
<li><a href="02.html#checking-options">Checking Options</a></li>
<li><a href="02.html#options-with-values">Options with Values</a></li>
<li><a href="02.html#setting-multiple-options-at-once">Setting Multiple Options at Once</a></li>
<li><a href="02.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="01.html">&laquo; Prev</a>
            
            
                <a class="next" href="03.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="setting-options">Setting Options</h1>
<p>Vim has many options you can set to change how it behaves.</p>
<p>There are two main kinds of options: boolean options (either "on" or "off") and
options that take a value.</p>
<h2 id="boolean-options">Boolean Options</h2>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:set number</code></pre>


<p>Line numbers should appear on the left side of the window if they weren't there
already.  Now run this:</p>
<pre class="codehilite"><code class="language-vim">:set nonumber</code></pre>


<p>The line numbers should disappear.  <code>number</code> is a boolean option: it can be off
or on.  You turn it "on" by running <code>:set number</code> and "off" with <code>:set
nonumber</code>.</p>
<p>All boolean options work this way.  <code>:set &lt;name&gt;</code> turns the option on and <code>:set
no&lt;name&gt;</code> turns it off.</p>
<h2 id="toggling-boolean-options">Toggling Boolean Options</h2>
<p>You can also "toggle" boolean options to set them to the <em>opposite</em> of whatever
they are now.  Run this:</p>
<pre class="codehilite"><code class="language-vim">:set number!</code></pre>


<p>The line numbers should reappear.  Now run it again:</p>
<pre class="codehilite"><code class="language-vim">:set number!</code></pre>


<p>They should disappear once more.  Adding a <code>!</code> (exclamation point or "bang") to
a boolean option toggles it.</p>
<h2 id="checking-options">Checking Options</h2>
<p>You can ask Vim what an option is currently set to by using a <code>?</code>.  Run these
commands and watch what happens after each:</p>
<pre class="codehilite"><code class="language-vim">:set number
:set number?
:set nonumber
:set number?</code></pre>


<p>Notice how the first <code>:set number?</code> command displayed <code>number</code> while the second
displayed <code>nonumber</code>.</p>
<h2 id="options-with-values">Options with Values</h2>
<p>Some options take a value instead of just being off or on.  Run the following
commands and watch what happens after each:</p>
<pre class="codehilite"><code class="language-vim">:set number
:set numberwidth=10
:set numberwidth=4
:set numberwidth?</code></pre>


<p>The <code>numberwidth</code> option changes how wide the column containing line numbers
will be.  You can change non-boolean options with <code>:set &lt;name&gt;=&lt;value&gt;</code>, and
check them the usual way (<code>:set &lt;name&gt;?</code>).</p>
<p>Try checking what a few other common options are set to:</p>
<pre class="codehilite"><code class="language-vim">:set wrap?
:set shiftround?
:set matchtime?</code></pre>


<h2 id="setting-multiple-options-at-once">Setting Multiple Options at Once</h2>
<p>Finally, you can specify more than one option in the same <code>:set</code> command to save
on some typing.  Try running this:</p>
<pre class="codehilite"><code class="language-vim">:set numberwidth=2
:set nonumber
:set number numberwidth=6</code></pre>


<p>Notice how both options were set and took effect in the last command.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help 'number'</code> (notice the quotes).</p>
<p>Read <code>:help relativenumber</code>.</p>
<p>Read <code>:help numberwidth</code>.</p>
<p>Read <code>:help wrap</code>.</p>
<p>Read <code>:help shiftround</code>.</p>
<p>Read <code>:help matchtime</code>.</p>
<p>Add a few lines to your <code>~/.vimrc</code> file to set these options however you like.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="01.html">&laquo; Previous</a>
            
            
                <a class="next" href="03.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Basic Mapping / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="03.html#basic-mapping">Basic Mapping</a><ul>
<li><a href="03.html#special-characters">Special Characters</a></li>
<li><a href="03.html#commenting">Commenting</a></li>
<li><a href="03.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="02.html">&laquo; Prev</a>
            
            
                <a class="next" href="04.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="basic-mapping">Basic Mapping</h1>
<p>If there's one feature of Vimscript that will let you bend Vim to your will more
than any other, it's the ability to map keys.  Mapping keys lets you tell Vim:</p>
<blockquote>
<p>When I press this key, I want you to do this stuff instead of whatever you
would normally do.</p>
</blockquote>
<p>We're going to start off by mapping keys in normal mode.  We'll talk about how
to map keys in insert and other modes in the next chapter.</p>
<p>Type a few lines of text into a file, then run:</p>
<pre class="codehilite"><code class="language-vim">:map - x</code></pre>


<p>Put your cursor somewhere in the text and press <code>-</code>.  Notice how Vim deleted the
character under the cursor, just like if you had pressed <code>x</code>.</p>
<p>We already have a key for "delete the character under the cursor", so let's
change that mapping to something slightly more useful.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:map - dd</code></pre>


<p>Now put your cursor on a line somewhere and press <code>-</code> again.  This time Vim
deletes the entire line, because that's what <code>dd</code> does.</p>
<h2 id="special-characters">Special Characters</h2>
<p>You can use <code>&lt;keyname&gt;</code> to tell Vim about special keys.  Try running this
command:</p>
<pre class="codehilite"><code class="language-vim">:map &lt;space&gt; viw</code></pre>


<p>Put your cursor on a word in your text and press the space bar.  Vim will
visually select the word.</p>
<p>You can also map modifier keys like Ctrl and Alt.  Run this:</p>
<pre class="codehilite"><code class="language-vim">:map &lt;c-d&gt; dd</code></pre>


<p>Now pressing <code>Ctrl+d</code> on your keyboard will run <code>dd</code>.</p>
<h2 id="commenting">Commenting</h2>
<p>Remember in the first lesson where we talked about comments?  Mapping keys is
one of the places where Vim comments don't work.  Try running this command:</p>
<pre class="codehilite"><code class="language-vim">:map &lt;space&gt; viw " Select word</code></pre>


<p>If you try pressing space now, something horrible will almost certainly happen.
Why?</p>
<p>When you press the space bar now, Vim thinks you want it to do what
<code>viw&lt;space&gt;"&lt;space&gt;Select&lt;space&gt;word</code> would do.  Obviously this isn't what we
want.</p>
<p>If you look closely at the effect of this mapping you might notice something
strange.  Take a few minutes to try to figure out exactly what happens when you
use it, and <em>why</em> that happens.</p>
<p>Don't worry if you don't get it right away -- we'll talk about it more soon.</p>
<h2 id="exercises">Exercises</h2>
<p>Map the <code>-</code> key to "delete the current line, then paste it below the one we're
on now".  This will let you move lines downward in your file with one keystroke.</p>
<p>Add that mapping command to your <code>~/.vimrc</code> file so you can use it any time
you start Vim.</p>
<p>Figure out how to map the <code>_</code> key to move the line up instead of down.</p>
<p>Add that mapping to your <code>~/.vimrc</code> file too.</p>
<p>Try to guess how you might remove a mapping and reset a key to its normal
function.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="02.html">&laquo; Previous</a>
            
            
                <a class="next" href="04.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Modal Mapping / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="04.html#modal-mapping">Modal Mapping</a><ul>
<li><a href="04.html#muscle-memory">Muscle Memory</a></li>
<li><a href="04.html#insert-mode">Insert Mode</a></li>
<li><a href="04.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="03.html">&laquo; Prev</a>
            
            
                <a class="next" href="05.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="modal-mapping">Modal Mapping</h1>
<p>In the last chapter we talked about how to map keys in Vim.  We used the <code>map</code>
command which made the keys work in normal mode.  If you played around a bit
before moving on to this chapter, you may have noticed that the mappings also
took effect in visual mode.</p>
<p>You can be more specific about when you want mappings to apply by using <code>nmap</code>,
<code>vmap</code>, and <code>imap</code>.  These tell Vim to only use the mapping in normal, visual,
or insert mode respectively.</p>
<p>Run this command:</p>
<pre class="codehilite"><code class="language-vim">:nmap \ dd</code></pre>


<p>Now put your cursor in your text file, make sure you're in normal mode, and
press <code>\</code>.  Vim will delete the current line.</p>
<p>Now enter visual mode and try pressing <code>\</code>.  Nothing will happen, because we
told Vim to only use that mapping in normal mode (and <code>\</code> doesn't do anything by
default).</p>
<p>Run this command:</p>
<pre class="codehilite"><code class="language-vim">:vmap \ U</code></pre>


<p>Enter visual mode and select some text, then press <code>\</code>.  Vim will convert the
text to uppercase!</p>
<p>Try the <code>\</code> key a few times in normal and visual modes and notice that it now
does something completely different depending on which mode you're in.</p>
<h2 id="muscle-memory">Muscle Memory</h2>
<p>At first the idea of mapping the same key to do different things depending on
which mode you're in may sound like a terrible idea.  Why would you want to
have to stop and think which mode you're in before pressing the key?  Wouldn't
that negate any time you save from the mapping itself?</p>
<p>In practice it turns out that this isn't really a problem.  Once you start using
Vim often you won't be thinking about the individual keys you're typing any
more.  You'll think: "delete a line" and not "press <code>dd</code>".  Your fingers and
brain will learn your mappings and the keys themselves will become subconscious.</p>
<h2 id="insert-mode">Insert Mode</h2>
<p>Now that we've covered how to map keys in normal and visual mode, let's move on
to insert mode.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:imap &lt;c-d&gt; dd</code></pre>


<p>You might think that this would let you press <code>Ctrl+d</code> whenever you're in insert
mode to delete the current line.  This would be handy because you wouldn't need
to go back into normal mode to cut out lines.</p>
<p>Go ahead and try it.  It won't work -- instead it will just put two <code>d</code>s in your
file!  That's pretty useless.</p>
<p>The problem is that Vim is doing exactly what we told it to.  We said: "when
I press <code>&lt;c-d&gt;</code> I want you to do what pressing <code>d</code> and <code>d</code> would normally do".
Well, normally when you're in insert mode and press the <code>d</code> key twice, you get
two <code>d</code>s in a row!</p>
<p>To make this mapping do what we intended we need to be very explicit.  Run this
command to change the mapping:</p>
<pre class="codehilite"><code class="language-vim">:imap &lt;c-d&gt; &lt;esc&gt;dd</code></pre>


<p>The <code>&lt;esc&gt;</code> is our way of telling Vim to press the Escape key, which will take
us out of insert mode.</p>
<p>Now try the mapping.  It works, but notice how you're now back in normal mode.
This makes sense because we told Vim that <code>&lt;c-d&gt;</code> should exit insert mode and
delete a line, but we never told it to go back into insert mode.</p>
<p>Run one more command to fix the mapping once and for all:</p>
<pre class="codehilite"><code class="language-vim">:imap &lt;c-d&gt; &lt;esc&gt;ddi</code></pre>


<p>The <code>i</code> at the end enters insert mode, and our mapping is finally complete.</p>
<h2 id="exercises">Exercises</h2>
<p>Set up a mapping so that you can press <code>&lt;c-u&gt;</code> to convert the current word to
uppercase when you're in insert mode.  Remember that <code>U</code> in visual mode will
uppercase the selection.  I find this mapping extremely useful when I'm writing
out the name of a long constant like <code>MAX_CONNECTIONS_ALLOWED</code>.  I type out the
constant in lower case and then uppercase it with the mapping instead of holding
shift the entire time.</p>
<p>Add that mapping to your <code>~/.vimrc</code> file.</p>
<p>Set up a mapping so that you can uppercase the current word with <code>&lt;c-u&gt;</code> when in
<em>normal</em> mode.  This will be slightly different than the previous mapping
because you don't need to enter normal mode.  You should end up back in normal
mode at the end instead of in insert mode as well.</p>
<p>Add that mapping to your <code>~/.vimrc</code> file.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="03.html">&laquo; Previous</a>
            
            
                <a class="next" href="05.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Strict Mapping / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="05.html#strict-mapping">Strict Mapping</a><ul>
<li><a href="05.html#recursion">Recursion</a></li>
<li><a href="05.html#side-effects">Side Effects</a></li>
<li><a href="05.html#nonrecursive-mapping">Nonrecursive Mapping</a></li>
<li><a href="05.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="04.html">&laquo; Prev</a>
            
            
                <a class="next" href="06.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="strict-mapping">Strict Mapping</h1>
<p>Get ready, because things are about to get a little wild.</p>
<p>So far we've used <code>map</code>, <code>nmap</code>, <code>vmap</code>, and <code>imap</code> to create key mappings that
will save time.  These work, but they have a downside.  Run the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:nmap - dd
:nmap \ -</code></pre>


<p>Now try pressing <code>\</code> (in normal mode).  What happens?</p>
<p>When you press <code>\</code> Vim sees the mapping and says "I should run <code>-</code> instead".
But we've already mapped <code>-</code> to do something else!  Vim sees that and says "oh,
now I need to run <code>dd</code>", and so it deletes the current line.</p>
<p>When you map keys with these commands Vim will take <em>other</em> mappings into
account.  This may sound like a good thing at first but in reality it's pure
evil.  Let's talk about why, but first remove those mappings by running the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:nunmap -
:nunmap \</code></pre>


<h2 id="recursion">Recursion</h2>
<p>Run this command:</p>
<pre class="codehilite"><code class="language-vim">:nmap dd O&lt;esc&gt;jddk</code></pre>


<p>At first glance it might look like this would map <code>dd</code> to:</p>
<ul>
<li>Open a new line above this one.</li>
<li>Exit insert mode.</li>
<li>Move back down.</li>
<li>Delete the current line.</li>
<li>Move up to the blank line just created.</li>
</ul>
<p>Effectively this should "clear the current line".  Try it.</p>
<p>Vim will seem to freeze when you press <code>dd</code>.  If you press <code>&lt;c-c&gt;</code> you'll get
Vim back, but there will be a ton of empty lines in your file!  What happened?</p>
<p>This mapping is actually <em>recursive</em>!  When you press <code>dd</code>, Vim says:</p>
<ul>
<li><code>dd</code> is mapped, so perform the mapping.<ul>
<li>Open a line.</li>
<li>Exit insert mode.</li>
<li>Move down a line.</li>
<li><code>dd</code> is mapped, so perform the mapping.<ul>
<li>Open a line.</li>
<li>Exit insert mode.</li>
<li>Move down a line.</li>
<li><code>dd</code> is mapped, so perform the mapping, and so on.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This mapping can never finish running!  Go ahead and remove this terrible thing
with the following command:</p>
<pre class="codehilite"><code class="language-vim">:nunmap dd</code></pre>


<h2 id="side-effects">Side Effects</h2>
<p>One downside of the <code>*map</code> commands is the danger of recursing.  Another is that
their behavior can change if you install a plugin that maps keys they depend on.</p>
<p>When you install a new Vim plugin there's a good chance that you won't use and
memorize every mapping it creates.  Even if you do, you'd have to go back and
look through your <code>~/.vimrc</code> file to make sure none of your custom mappings use
a key that the plugin has mapped.</p>
<p>This would make installing plugins tedious and error-prone.  There must be
a better way.</p>
<h2 id="nonrecursive-mapping">Nonrecursive Mapping</h2>
<p>Vim offers another set of mapping commands that will <em>not</em> take mappings into
account when they perform their actions.  Run these commands:</p>
<pre class="codehilite"><code class="language-vim">:nmap x dd
:nnoremap \ x</code></pre>


<p>Now press <code>\</code> and see what happens.</p>
<p>When you press <code>\</code> Vim ignores the <code>x</code> mapping and does whatever it would do for
<code>x</code> by default.  Instead of deleting the current line, it deletes the current
character.</p>
<p>Each of the <code>*map</code> commands has a <code>*noremap</code> counterpart that ignores other
mappings: <code>noremap</code>, <code>nnoremap</code>, <code>vnoremap</code>, and <code>inoremap</code>.</p>
<p>When should you use these nonrecursive variants instead of their normal
counterparts?</p>
<p><strong>Always.</strong></p>
<p><strong>No, seriously, <em>always</em>.</strong></p>
<p>Using a bare <code>*map</code> is just <em>asking</em> for pain down the road when you install
a plugin or add a new custom mapping.  Save yourself the trouble and type the
extra characters to make sure it never happens.</p>
<h2 id="exercises">Exercises</h2>
<p>Convert all the mappings you added to your <code>~/.vimrc</code> file in the previous
chapters to their nonrecursive counterparts.</p>
<p>Read <code>:help unmap</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="04.html">&laquo; Previous</a>
            
            
                <a class="next" href="06.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Leaders / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="06.html#leaders">Leaders</a><ul>
<li><a href="06.html#mapping-key-sequences">Mapping Key Sequences</a></li>
<li><a href="06.html#leader">Leader</a></li>
<li><a href="06.html#local-leader">Local Leader</a></li>
<li><a href="06.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="05.html">&laquo; Prev</a>
            
            
                <a class="next" href="07.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="leaders">Leaders</h1>
<p>We've learned how to map keys in a way that won't make us want to tear our hair
out later, but you might have noticed one more problem.</p>
<p>Every time we do something like <code>:nnoremap &lt;space&gt; dd</code> we've overwritten what
<code>&lt;space&gt;</code> normally does.  What if we need that key later?</p>
<p>There are a bunch of keys that you don't normally need in your day-to-day Vim
usage.  <code>-</code>, <code>H</code>, <code>L</code>, <code>&lt;space&gt;</code>, <code>&lt;cr&gt;</code>, and <code>&lt;bs&gt;</code> do things that you almost
never need (in normal mode, of course).  Depending on how you work you may find
others that you never use.</p>
<p>Those are safe to map, but that only gives us six keys to work with.  What
happened to Vim's legendary customizability?</p>
<h2 id="mapping-key-sequences">Mapping Key Sequences</h2>
<p>Unlike Emacs, Vim makes it easy to map more than just single keys.  Run these
commands:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap -d dd
:nnoremap -c ddO</code></pre>


<p>Try them out by typing <code>-d</code> and <code>-c</code> (quickly) in normal mode.  The first
creates a custom mapping to delete a line, while the second "clears" a line and
puts you into insert mode.</p>
<p>This means you can pick a key that you don't care about (like <code>-</code>) as a "prefix"
key and create mappings on top of it.  It means you'll have to type an extra key
to activate the mappings, but one extra keystroke can easily be absorbed into
muscle memory.</p>
<p>If you think this might be a good idea, you're right, and it turns out that Vim
already has mechanisms for this "prefix" key!</p>
<h2 id="leader">Leader</h2>
<p>Vim calls this "prefix" key the "leader".  You can set your leader key to
whatever you like.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:let mapleader = "-"</code></pre>


<p>You can replace <code>-</code> with any key you like.  I personally like <code>,</code> even though it
shadows a useful function, because it's very easy to type.</p>
<p>When you're creating new mappings you can use <code>&lt;leader&gt;</code> to mean "whatever
I have my leader key set to".  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;d dd</code></pre>


<p>Now try it out by pressing your leader key and then <code>d</code>.  Vim will delete the
current line.</p>
<p>Why bother with setting <code>&lt;leader&gt;</code> at all, though?  Why not just include your
"prefix" key directly in your mapping commands?  There are three good reasons.</p>
<p>First of all, you may decide you need the normal function of your leader later
on down the road.  Defining it in one place makes it easy to change later.</p>
<p>Second, when someone else is looking at your <code>~/.vimrc</code> file they'll immediately
know what you mean when you say <code>&lt;leader&gt;</code>.  They can simply copy your mapping
into their own <code>~/.vimrc</code> if they like it even if they use a different leader.</p>
<p>Finally, many Vim plugins create mappings that start with <code>&lt;leader&gt;</code>.  If you've
already got it set up they'll work properly and will feel familiar right out of
the box.</p>
<h2 id="local-leader">Local Leader</h2>
<p>Vim has a second "leader" key called "local leader".  This is meant to be
a prefix for mappings that only take effect for certain types of files, like
Python files or HTML files.</p>
<p>We'll talk about how to make mappings for specific types of files later in the
book, but you can go ahead and set your "localleader" now:</p>
<pre class="codehilite"><code class="language-vim">:let maplocalleader = "\\"</code></pre>


<p>Notice that we have to use <code>\\</code> and not just <code>\</code> because <code>\</code> is the escape
character in Vimscript strings.  You'll learn more about this later.</p>
<p>Now you can use <code>&lt;localleader&gt;</code> in mappings and it will work just like
<code>&lt;leader&gt;</code> does (except for resolving to a different key, of course).</p>
<p>Feel free to change this key to something else if you don't like backslash.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help mapleader</code>.</p>
<p>Read <code>:help maplocalleader</code>.</p>
<p>Set <code>mapleader</code> and <code>maplocalleader</code> in your <code>~/.vimrc</code> file.</p>
<p>Convert all the mappings you added to your <code>~/.vimrc</code> file in the previous
chapters to be prefixed with <code>&lt;leader&gt;</code> so they don't shadow existing commands.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="05.html">&laquo; Previous</a>
            
            
                <a class="next" href="07.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Editing Your Vimrc / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="07.html#editing-your-vimrc">Editing Your Vimrc</a><ul>
<li><a href="07.html#editing-mapping">Editing Mapping</a></li>
<li><a href="07.html#sourcing-mapping">Sourcing Mapping</a></li>
<li><a href="07.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="06.html">&laquo; Prev</a>
            
            
                <a class="next" href="08.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="editing-your-vimrc">Editing Your Vimrc</h1>
<p>Before we move on to learning more Vimscript, let's find a way to make it easier
to add new mappings to our <code>~/.vimrc</code> file.</p>
<p>Sometimes you're coding away furiously at a problem and realize a new mapping
would make your editing easier.  You should add it to your <code>~/.vimrc</code> file right
then and there to make sure you don't forget, but you <em>don't</em> want to lose your
concentration.</p>
<p>The idea of this chapter is that you want to make it easier to make it easier to
edit text.</p>
<p>That's not a typo.  Read it again.</p>
<p>The idea of this chapter is that you want to (make it easier to (make it easier
to (edit text))).</p>
<h2 id="editing-mapping">Editing Mapping</h2>
<p>Let's add a mapping that will open your <code>~/.vimrc</code> file in a split so you can
quickly edit it and get back to coding.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;ev :vsplit $MYVIMRC&lt;cr&gt;</code></pre>


<p>I like to think of this command as "<strong>e</strong>dit my <strong>v</strong>imrc file".</p>
<p><code>$MYVIMRC</code> is a special Vim variable that points to your <code>~/.vimrc</code> file.  Don't
worry about that for right now, just trust me that it works.</p>
<p><code>:vsplit</code> opens a new vertical split.  If you'd prefer a horizontal split you
can replace it with <code>:split</code>.</p>
<p>Take a minute and think through that command in your mind.  The goal is: "open
my <code>~/.vimrc</code> file in a new split".  Why does it work?  Why is every single
piece of that mapping necessary?</p>
<p>With that mapping you can open up your <code>~/.vimrc</code> file with three keystrokes.
Once you use it a few times it will burn its way into your muscle memory and
take less than half a second to type.</p>
<p>When you're in the middle of coding and come up with a new mapping that would
save you time it's now trivial to add it to your <code>~/.vimrc</code> file.</p>
<h2 id="sourcing-mapping">Sourcing Mapping</h2>
<p>Once you've added a mapping to your <code>~/.vimrc</code> file, it doesn't immediately take
effect.  Your <code>~/.vimrc</code> file is only read when you start Vim.  This means you
need to also run the command manually to make it work in the current session,
which is a pain.</p>
<p>Let's add a mapping to make this easier:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;sv :source $MYVIMRC&lt;cr&gt;</code></pre>


<p>I like to think of this command as "<strong>s</strong>ource my <strong>v</strong>imrc file".</p>
<p>The <code>source</code> command tells Vim to take the contents of the given file and
execute it as Vimscript.</p>
<p>Now you can easily add new mappings during the heat of coding:</p>
<ul>
<li>Use <code>&lt;leader&gt;ev</code> to open the file.</li>
<li>Add the mapping.</li>
<li>Use <code>:wq&lt;cr&gt;</code> (or <code>ZZ</code>) to write the file and close the split, bringing you
  back to where you were.</li>
<li>Use <code>&lt;leader&gt;sv</code> to source the file and make our changes take effect.</li>
</ul>
<p>That's eight keystrokes plus whatever it takes to define the mapping.  It's very
little overhead, which reduces the chance of breaking focus.</p>
<h2 id="exercises">Exercises</h2>
<p>Add mappings to "edit my <code>~/.vimrc</code>" and "source my <code>~/.vimrc</code>" to your
<code>~/.vimrc</code> file.</p>
<p>Try them out a few times, adding dummy mappings each time.</p>
<p>Read <code>:help myvimrc</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="06.html">&laquo; Previous</a>
            
            
                <a class="next" href="08.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Abbreviations / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="08.html#abbreviations">Abbreviations</a><ul>
<li><a href="08.html#keyword-characters">Keyword Characters</a></li>
<li><a href="08.html#more-abbreviations">More Abbreviations</a></li>
<li><a href="08.html#why-not-use-mappings">Why Not Use Mappings?</a></li>
<li><a href="08.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="07.html">&laquo; Prev</a>
            
            
                <a class="next" href="09.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="abbreviations">Abbreviations</h1>
<p>Vim has a feature called "abbreviations" that feel similar to mappings but are
meant for use in insert, replace, and command modes.  They're extremely flexible
and powerful, but we're just going to cover the most common uses here.</p>
<p>We're only going to worry about insert mode abbreviations in this book. Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:iabbrev adn and</code></pre>


<p>Now enter insert mode and type:</p>
<pre class="codehilite"><code class="language-text">One adn two.</code></pre>


<p>As soon as you hit space after typing the <code>adn</code> Vim will replace it with <code>and</code>.</p>
<p>Correcting typos like this is a great use for abbreviations.  Run these
commands:</p>
<pre class="codehilite"><code class="language-vim">:iabbrev waht what
:iabbrev tehn then</code></pre>


<p>Now enter insert mode again and type:</p>
<pre class="codehilite"><code class="language-text">Well, I don't know waht we should do tehn.</code></pre>


<p>Notice how <em>both</em> abbreviations were substituted, even though you didn't type
a space after the second one.</p>
<h2 id="keyword-characters">Keyword Characters</h2>
<p>Vim will substitute an abbreviation when you type any "non-keyword character"
after an abbreviation.  "Non-keyword character" means any character not in the
<code>iskeyword</code> option.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:set iskeyword?</code></pre>


<p>You should see something like <code>iskeyword=@,48-57,_,192-255</code>.  This format is
very complicated, but in essence it means that all of the following are
considered "keyword characters":</p>
<ul>
<li>All alphabetic ASCII characters, both upper and lower case, and their accented
  versions.</li>
<li>Any characters with an ASCII value between 48 and 57 (the digits zero through
  nine).</li>
<li>The underscore character (<code>_</code>).</li>
<li>Any characters with an ASCII value between 192 and 255 (some special ASCII
  characters).</li>
</ul>
<p>If you want to read the <em>full</em> description of this option's format you can check
out <code>:help isfname</code>, but I'll warn you that you'd better have a beer at the
ready for this one.</p>
<p>For our purposes you can simply remember that abbreviations will be expanded
when you type anything that's not a letter, number, or underscore.</p>
<h2 id="more-abbreviations">More Abbreviations</h2>
<p>Abbreviations are useful for more than just correcting typos.  Let's add a few
more that can help in day-to-day text editing.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:iabbrev @@    steve@stevelosh.com
:iabbrev ccopy Copyright 2013 Steve Losh, all rights reserved.</code></pre>


<p>Feel free to replace my name and email address with your own, then enter insert
mode and try them out.</p>
<p>These abbreviations take large chunks of text that you type often and compress
them down to a few characters.  Over time, this can save you a lot of typing, as
well as wear and tear on your fingers.</p>
<h2 id="why-not-use-mappings">Why Not Use Mappings?</h2>
<p>If you're thinking that abbreviations seem similar to mappings, you're right.
However, they're intended to be used for different things.  Let's look at an
example.</p>
<p>Run this command:</p>
<pre class="codehilite"><code class="language-vim">:inoremap ssig -- &lt;cr&gt;Steve Losh&lt;cr&gt;steve@stevelosh.com</code></pre>


<p>This is a <em>mapping</em> intended to let you insert your signature quickly.  Try it
out by entering insert mode and typing <code>ssig</code>.</p>
<p>It seems to work great, but there's a problem.  Try entering insert mode and
typing this text:</p>
<pre class="codehilite"><code class="language-text">Larry Lessig wrote the book "Remix".</code></pre>


<p>You'll notice that Vim has expanded the <code>ssig</code> in Larry's name!  Mappings don't
take into account what characters come before or after the map -- they only look
at the specific sequence that you mapped to.</p>
<p>Remove the mapping and replace it with an abbreviation by running the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:iunmap ssig
:iabbrev ssig -- &lt;cr&gt;Steve Losh&lt;cr&gt;steve@stevelosh.com</code></pre>


<p>Now try out the abbreviation again.</p>
<p>This time Vim will pay attention to the characters before and after <code>ssig</code> and
only expand it when we want.</p>
<h2 id="exercises">Exercises</h2>
<p>Add abbreviations for some common typos you know you personally make to your
<code>~/.vimrc</code> file.  Be sure to use the mappings you created in the last chapter to
open and source the file!</p>
<p>Add abbreviations for your own email address, website, and signature as well.</p>
<p>Think of some pieces of text you type very often and add abbreviations for them
too.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="07.html">&laquo; Previous</a>
            
            
                <a class="next" href="09.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>More Mappings / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="09.html#more-mappings">More Mappings</a><ul>
<li><a href="09.html#a-more-complicated-mapping">A More Complicated Mapping</a></li>
<li><a href="09.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="08.html">&laquo; Prev</a>
            
            
                <a class="next" href="10.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="more-mappings">More Mappings</h1>
<p>I know we've talked a lot about mappings so far, but we're going to practice
them again now.  Mappings are one of the easiest and fastest ways to make your
Vim editing more productive so it's good to focus on them quite a bit.</p>
<p>One concept that has showed up in several examples but that we haven't
explicitly talked about is mapping a sequence of multiple keys.</p>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap jk dd</code></pre>


<p>Now make sure you're in normal mode and press <code>j</code> followed quickly by <code>k</code>.  Vim
will delete the current line.</p>
<p>Now try pressing only <code>j</code> and waiting for a bit.  If you don't press <code>k</code> quickly
after the <code>j</code>, Vim decides that you don't want to activate the mapping and
instead runs the normal <code>j</code> functionality (moving down a line).</p>
<p>This mapping will make it painful to move around, so let's remove it.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:nunmap jk</code></pre>


<p>Now typing <code>jk</code> in normal mode will move down and then up a line as usual.</p>
<h2 id="a-more-complicated-mapping">A More Complicated Mapping</h2>
<p>You've seen a bunch of simple mappings so far, so it's time to look at something
with a bit more meat to it.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;" viw&lt;esc&gt;a"&lt;esc&gt;bi"&lt;esc&gt;lel</code></pre>


<p>Now <em>that's</em> an interesting mapping!  First, go ahead and try it out.  Enter
normal mode, put your cursor over a word in your text and type <code>&lt;leader&gt;"</code>.  Vim
will surround the word in double quotes!</p>
<p>How does this work?  Let's split it apart into pieces and think of what each one
does:</p>
<pre class="codehilite"><code class="language-text">viw&lt;esc&gt;a"&lt;esc&gt;bi"&lt;esc&gt;lel</code></pre>


<ul>
<li><code>viw</code>: visually select the current word</li>
<li><code>&lt;esc&gt;</code>: exit visual mode, which leaves the cursor on the last character of
  the word</li>
<li><code>a</code>: enter insert mode <em>after</em> the current character</li>
<li><code>"</code>: insert a <code>"</code> into the text, because we're in insert mode</li>
<li><code>&lt;esc&gt;</code>: return to normal mode</li>
<li><code>b</code>: move back to the beginning of the word</li>
<li><code>i</code>: enter insert mode <em>before</em> the current character</li>
<li><code>"</code>: insert a <code>"</code> into the text again</li>
<li><code>&lt;esc&gt;</code>: return to normal mode</li>
<li><code>l</code>: move right, which puts our cursor on the first character of the word</li>
<li><code>e</code>: move to the end of the word</li>
<li><code>l</code>: move right, which puts our cursor over the ending quote</li>
</ul>
<p>Remember: because we used <code>nnoremap</code> instead of <code>nmap</code> it doesn't matter if
you've mapped any of the keys in this sequence to something else.  Vim will use
the default functionality for all of them.</p>
<p>Hopefully you can see how much potential Vim's mappings have, as well as how
unreadable they can become.</p>
<h2 id="exercises">Exercises</h2>
<p>Create a mapping similar to the one we just looked at, but for single quotes
instead of double quotes.</p>
<p>Try using <code>vnoremap</code> to add a mapping that will wrap whatever text you have
<em>visually selected</em> in quotes.  You'll probably need the <code>`&lt;</code> and <code>`&gt;</code>
commands for this, so read up on them with <code>:help `&lt;</code>.</p>
<p>Map <code>H</code> in normal mode to go to the beginning of the current line.  Since <code>h</code>
moves left you can think of <code>H</code> as a "stronger" <code>h</code>.</p>
<p>Map <code>L</code> in normal mode to go to the end of the current line. Since <code>l</code>
moves right you can think of <code>L</code> as a "stronger" <code>l</code>.</p>
<p>Find out what commands you just overwrote by reading <code>:help H</code> and <code>:help L</code>.
Decide whether you care about them.</p>
<p>Add all of these mappings to your <code>~/.vimrc</code> file, making sure to use your "edit
my <code>~/.vimrc</code>" and "source my <code>~/.vimrc</code>" mappings to do so.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="08.html">&laquo; Previous</a>
            
            
                <a class="next" href="10.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Training Your Fingers / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="10.html#training-your-fingers">Training Your Fingers</a><ul>
<li><a href="10.html#learning-the-map">Learning the Map</a></li>
<li><a href="10.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="09.html">&laquo; Prev</a>
            
            
                <a class="next" href="11.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="training-your-fingers">Training Your Fingers</h1>
<p>In this chapter we're going to talk about how to learn Vim more effectively, but
we need to do a bit of preparation first.</p>
<p>Let's set up one more mapping that will save more wear on your left hand than
any other mapping you ever create.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:inoremap jk &lt;esc&gt;</code></pre>


<p>Now enter insert mode and type <code>jk</code>.  Vim will act as if you pressed the escape
key and return you to normal mode.</p>
<p>There are a number of ways to exit insert mode in Vim by default:</p>
<ul>
<li><code>&lt;esc&gt;</code></li>
<li><code>&lt;c-c&gt;</code></li>
<li><code>&lt;c-[&gt;</code></li>
</ul>
<p>Each of those requires you to stretch your fingers uncomfortably.  Using <code>jk</code> is
great because the keys are right under two of your strongest fingers and you
don't have to perform a chord.</p>
<p>Some people prefer using <code>jj</code> instead of <code>jk</code>, but I prefer <code>jk</code> for two
reasons:</p>
<ul>
<li>It's typed with two separate keys, so you can "roll" your fingers instead of
  using the same one twice.</li>
<li>Pressing <code>jk</code> in normal mode out of habit will move down and then up, leaving
  you exactly where you started.  Using <code>jj</code> in normal mode will move you to
  a different place in your file.</li>
</ul>
<p>If you write in a language where <code>jk</code> is a frequently used combination of
letters (like Dutch) you'll probably want to pick a different mapping.</p>
<h2 id="learning-the-map">Learning the Map</h2>
<p>Now that you've got a great new mapping, how can you learn to use it?  Chances
are you've already got the escape key in your muscle memory, so when you're
editing you'll hit it without even thinking.</p>
<p>The trick to relearning a mapping is to <em>force</em> yourself to use it by
<em>disabling</em> the old key(s).  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:inoremap &lt;esc&gt; &lt;nop&gt;</code></pre>


<p>This effectively disables the escape key in insert mode by telling Vim to
perform <code>&lt;nop&gt;</code> (no operation) instead.  Now you <em>have</em> to use your <code>jk</code> mapping
to exit insert mode.</p>
<p>At first you'll forget, type escape and start trying to do something in normal
mode and you'll wind up with stray characters in your text.  It will be
frustrating, but if you stick with it you'll be surprised at how fast your mind
and fingers absorb the new mapping.  Within an hour or two you won't be
accidentally hitting escape any more.</p>
<p>This idea applies to any new mapping you create to replace an old one, and even
to life in general.  When you want to change a habit, make it harder or
impossible to do!</p>
<p>If you want to start cooking meals instead of microwaving TV dinners, don't buy
any TV dinners when you go shopping.  You'll cook some real food when you get
hungry enough.</p>
<p>If you want to quit smoking, always leave your cigarettes in your car's trunk.
When you get the urge to have a casual cigarette you'll think of what a pain in
the ass it will be to walk out to the car and are less likely to bother doing
it.</p>
<h2 id="exercises">Exercises</h2>
<p>If you still find yourself using the arrow keys to navigate around Vim in normal
mode, map them to <code>&lt;nop&gt;</code> to make yourself stop.</p>
<p>If you still use the arrow keys in insert mode, map them to <code>&lt;nop&gt;</code> there too.
The right way to use Vim is to get out of insert mode as soon as you can and use
normal mode to move around.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="09.html">&laquo; Previous</a>
            
            
                <a class="next" href="11.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Buffer-Local Options and Mappings / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="11.html#buffer-local-options-and-mappings">Buffer-Local Options and Mappings</a><ul>
<li><a href="11.html#mappings">Mappings</a></li>
<li><a href="11.html#local-leader">Local Leader</a></li>
<li><a href="11.html#settings">Settings</a></li>
<li><a href="11.html#shadowing">Shadowing</a></li>
<li><a href="11.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="10.html">&laquo; Prev</a>
            
            
                <a class="next" href="12.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="buffer-local-options-and-mappings">Buffer-Local Options and Mappings</h1>
<p>Now we're going to take a few minutes to revisit three things we've already
talked about: mappings, abbreviations, and options, but with a twist.  We're
going to set each of them in a single buffer at a time.</p>
<p>The true power of this idea will become apparent in the next chapter, but we
need to lay the groundwork for it now.</p>
<p>For this chapter you'll need to open two files in Vim, each in its own split.
I'll call them <code>foo</code> and <code>bar</code>, but you can name them whatever you like.  Put
some text into each of them.</p>
<h2 id="mappings">Mappings</h2>
<p>Switch to file <code>foo</code> and run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap          &lt;leader&gt;d dd
:nnoremap &lt;buffer&gt; &lt;leader&gt;x dd</code></pre>


<p>Now stay in file <code>foo</code>, make sure you're in normal mode, and type <code>&lt;leader&gt;d</code>.
Vim will delete a line.  This is nothing new.</p>
<p>Still in file <code>foo</code>, type <code>&lt;leader&gt;x</code>.  Vim will delete a line again.  This
makes sense because we mapped <code>&lt;leader&gt;x</code> to <code>dd</code> as well.</p>
<p>Now move over to file <code>bar</code>.  While in normal mode, type <code>&lt;leader&gt;d</code>.  Again,
Vim deletes the current line.  Nothing surprising here either.</p>
<p>Now for the twist: while still in file <code>bar</code>, type <code>&lt;leader&gt;x</code>.</p>
<p>Instead of deleting the entire line, Vim just deleted a single character!
What happened?</p>
<p>The <code>&lt;buffer&gt;</code> in the second <code>nnoremap</code> command told Vim to only consider that
mapping when we're in the buffer where we defined it.</p>
<p>When you typed <code>&lt;leader&gt;x</code> in file <code>bar</code> Vim couldn't find a mapping that
matched it, so it treated it as two commands: <code>&lt;leader&gt;</code> (which does nothing on
its own) and <code>x</code> (the normal command to delete a single character).</p>
<h2 id="local-leader">Local Leader</h2>
<p>In our example we used <code>&lt;leader&gt;x</code> for our buffer-local mapping, but this is bad
form.  In general, when you create a mapping that only applies to specific
buffers you should use <code>&lt;localleader&gt;</code> instead of <code>&lt;leader&gt;</code>.</p>
<p>Using two separate leader keys provides a sort of "namespacing" that will help
you keep all your various mappings straight in your head.</p>
<p>It's even more important when you're writing a plugin for other people to use.
The convention of using <code>&lt;localleader&gt;</code> for local mappings will prevent your
plugin from overwriting someone else's <code>&lt;leader&gt;</code> mapping that they've
painstakingly burned into their fingers over time.</p>
<h2 id="settings">Settings</h2>
<p>In one of the earliest chapters of the book we talked about settings options
with <code>set</code>.  Some options always apply to all of Vim, but others can be set on
a per-buffer basis.</p>
<p>Switch to file <code>foo</code> and run the following command:</p>
<pre class="codehilite"><code class="language-vim">:setlocal wrap</code></pre>


<p>Now switch to file <code>bar</code> and run this command:</p>
<pre class="codehilite"><code class="language-vim">:setlocal nowrap</code></pre>


<p>Make your Vim window smaller and you'll see that the lines in <code>foo</code> wrap, but
the lines in <code>bar</code> don't.</p>
<p>Let's try another option.  Switch to <code>foo</code> and run this command:</p>
<pre class="codehilite"><code class="language-vim">:setlocal number</code></pre>


<p>Now switch over to <code>bar</code> and run this command:</p>
<pre class="codehilite"><code class="language-vim">:setlocal nonumber</code></pre>


<p>You now have line numbers in <code>foo</code> but not in <code>bar</code>.</p>
<p>Not all options can be used with <code>setlocal</code>.  To see if you can set a particular
option locally, read its <code>:help</code>.</p>
<p>I've glossed over a bit of detail about how local options <em>actually</em> work for
now.  In the exercises you'll learn more about the gory details.</p>
<h2 id="shadowing">Shadowing</h2>
<p>Before we move on, let's look at a particularly interesting property of local
mappings.  Switch over to <code>foo</code> and run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;buffer&gt; Q x
:nnoremap          Q dd</code></pre>


<p>Now type <code>Q</code>.  What happens?</p>
<p>When you press <code>Q</code>, Vim will run the first mapping, not the second, because the
first mapping is <em>more specific</em> than the second.</p>
<p>Switch to file <code>bar</code> and type <code>Q</code> to see that Vim uses the second mapping,
because it's not shadowed by the first in this buffer.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help local-options</code>.</p>
<p>Read <code>:help setlocal</code>.</p>
<p>Read <code>:help map-local</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="10.html">&laquo; Previous</a>
            
            
                <a class="next" href="12.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Autocommands / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="12.html#autocommands">Autocommands</a><ul>
<li><a href="12.html#autocommand-structure">Autocommand Structure</a></li>
<li><a href="12.html#another-example">Another Example</a></li>
<li><a href="12.html#multiple-events">Multiple Events</a></li>
<li><a href="12.html#filetype-events">FileType Events</a></li>
<li><a href="12.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="11.html">&laquo; Prev</a>
            
            
                <a class="next" href="13.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="autocommands">Autocommands</h1>
<p>Now we're going to look at a topic almost as important as mappings:
autocommands.</p>
<p>Autocommands are a way to tell Vim to run certain commands whenever certain
events happen.  Let's dive right into an example.</p>
<p>Open a new file with <code>:edit foo</code> and close it right away with <code>:quit</code>.  Look on
your hard drive and you'll notice that the file is not there.  This is because
Vim doesn't actually <em>create</em> the file until you save it for the first time.</p>
<p>Let's change it so that Vim creates files as soon as you edit them.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufNewFile * :write</code></pre>


<p>This is a lot to take in, but try it out and see that it works.  Run <code>:edit foo</code>
again, close it with <code>:quit</code>, and look at your hard drive.  This time the file
will be there (and empty, of course).</p>
<p>You'll have to close Vim to remove the autocommand.  We'll talk about how to
avoid this in a later chapter.</p>
<h2 id="autocommand-structure">Autocommand Structure</h2>
<p>Let's take a closer look at the autocommand we just created:</p>
<pre class="codehilite"><code class="language-text">:autocmd BufNewFile * :write
         ^          ^ ^
         |          | |
         |          | The command to run.
         |          |
         |          A "pattern" to filter the event.
         |
         The "event" to watch for.</code></pre>


<p>The first piece of the command is the type of event we want to watch for.  Vim
offers <em>many</em> events to watch.  Some of them include:</p>
<ul>
<li>Starting to edit a file that doesn't already exist.</li>
<li>Reading a file, whether it exists or not.</li>
<li>Switching a buffer's <code>filetype</code> setting.</li>
<li>Not pressing a key on your keyboard for a certain amount of time.</li>
<li>Entering insert mode.</li>
<li>Exiting insert mode.</li>
</ul>
<p>This is just a tiny sample of the available events.  There are many more you can
use to do lots of interesting things.</p>
<p>The next part of the command is a "pattern" that lets you be more specific about
when you want the command to fire.  Start up a new Vim instance and run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufNewFile *.txt :write</code></pre>


<p>This is almost the same as the last command, but this time it will only apply to
files whose names end in <code>.txt</code>.</p>
<p>Try it out by running <code>:edit bar</code>, then <code>:quit</code>, then <code>:edit bar.txt</code>, then
<code>:quit</code>.  You'll see that Vim writes the <code>bar.txt</code> automatically, but <em>doesn't</em>
write <code>bar</code> because it doesn't match the pattern.</p>
<p>The final part of the command is the command we want to run when the event
fires.  This is pretty self-explanatory, except for one catch: you can't use
special characters like <code>&lt;cr&gt;</code> in the command.  We'll talk about how to get
around this limitation later in the book, but for now you'll just have to live
with it.</p>
<h2 id="another-example">Another Example</h2>
<p>Let's define another autocommand, this time using a different event.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufWritePre *.html :normal gg=G</code></pre>


<p>We're getting a bit ahead of ourselves here because we're going to talk about
<code>normal</code> later in the book, but for now you'll need to bear with me because it's
tough to come up with useful examples at this point.</p>
<p>Create a new file called <code>foo.html</code>.  Edit it with Vim and enter the following
text <em>exactly</em>, including the whitespace:</p>
<pre class="codehilite"><code class="language-html">&lt;html&gt;
&lt;body&gt;
 &lt;p&gt;Hello!&lt;/p&gt;
                 &lt;/body&gt;
                  &lt;/html&gt;</code></pre>


<p>Now save this file with <code>:w</code>.  What happened?  Vim seems to have reindented the
file for us before saving it!</p>
<p>For now I want you to trust me that running <code>:normal gg=G</code> will tell Vim to
reindent the current file.  Don't worry about how that works just yet.</p>
<p>What we <em>do</em> want to pay attention to is the autocommand.  The event type is
<code>BufWritePre</code>, which means the event will be checked just before you write <em>any</em>
file.</p>
<p>We used a pattern of <code>*.html</code> to ensure that this command will only fire when
we're working on files that end in <code>.html</code>.  This lets us target our
autocommands at specific files, which is a very powerful idea that we'll
continue to explore later on.</p>
<h2 id="multiple-events">Multiple Events</h2>
<p>You can create a single autocommand bound to <em>multiple</em> events by separating the
events with a comma.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufWritePre,BufRead *.html :normal gg=G</code></pre>


<p>This is almost like our last command, except it will also reindent the code
whenever we <em>read</em> an HTML file as well as when we write it.  This could be
useful if you have coworkers that don't indent their HTML nicely.</p>
<p>A common idiom in Vim scripting is to pair the <code>BufRead</code> and <code>BufNewFile</code> events
together to run a command whenever you open a certain kind of file, regardless
of whether it happens to exist already or not.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufNewFile,BufRead *.html setlocal nowrap</code></pre>


<p>This will turn line wrapping off whenever you're working on an HTML file.</p>
<h2 id="filetype-events">FileType Events</h2>
<p>One of the most useful events is the <code>FileType</code> event.  This event is fired
whenever Vim sets a buffer's <code>filetype</code>.</p>
<p>Let's set up a few useful mappings for a variety of file types.  Run the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:autocmd FileType javascript nnoremap &lt;buffer&gt; &lt;localleader&gt;c I//&lt;esc&gt;
:autocmd FileType python     nnoremap &lt;buffer&gt; &lt;localleader&gt;c I#&lt;esc&gt;</code></pre>


<p>Open a Javascript file (a file that ends in <code>.js</code>), pick a line and type
<code>&lt;localleader&gt;c</code>.  This will comment out the line.</p>
<p>Now open a Python file (a file that ends in <code>.py</code>), pick a line and type
<code>&lt;localleader&gt;c</code>.  This will comment out the line, but it will use Python's
comment character!</p>
<p>Using autocommands alongside the buffer-local mappings we learned about in the
last chapter we can create mappings that are specific to the type of file that
we're editing.</p>
<p>This reduces the load on our minds when we're coding.  Instead of having to
think about moving to the beginning of the line and adding a comment character
we can simply think "comment this line".</p>
<h2 id="exercises">Exercises</h2>
<p>Skim <code>:help autocmd-events</code> to see a list of all the events you can bind
autocommands to.  You don't need to memorize each one right now.  Just try to
get a feel for the kinds of things you can do.</p>
<p>Create a few <code>FileType</code> autocommands that use <code>setlocal</code> to set options for your
favorite filetypes just the way you like them.  Some options you might like to
change on a per-filetype basis are <code>wrap</code>, <code>list</code>, <code>spell</code>, and <code>number</code>.</p>
<p>Create a few more "comment this line" autocommands for filetypes you work with
often.</p>
<p>Add all of these autocommands to your <code>~/.vimrc</code> file.  Use your shortcut
mappings for editing and sourcing it quickly, of course!</p></div>

        <div class="prevnext">
            
                <a class="prev" href="11.html">&laquo; Previous</a>
            
            
                <a class="next" href="13.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Buffer-Local Abbreviations / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="13.html#buffer-local-abbreviations">Buffer-Local Abbreviations</a><ul>
<li><a href="13.html#autocommands-and-abbreviations">Autocommands and Abbreviations</a></li>
<li><a href="13.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="12.html">&laquo; Prev</a>
            
            
                <a class="next" href="14.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="buffer-local-abbreviations">Buffer-Local Abbreviations</h1>
<p>That last chapter was a monster, so let's tackle something easier.  We've seen
how to define buffer-local mappings and options, so let's apply the same idea to
abbreviations.</p>
<p>Open your <code>foo</code> and <code>bar</code> files again, switch to <code>foo</code>, and run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:iabbrev &lt;buffer&gt; --- &amp;mdash;</code></pre>


<p>While still in <code>foo</code> enter insert mode and type the following text:</p>
<pre class="codehilite"><code class="language-text">Hello --- world.</code></pre>


<p>Vim will replace the <code>---</code> for you.  Now switch to <code>bar</code> and try it.  It should
be no surprise that it's not replaced, because we defined the abbreviation to be
local to the <code>foo</code> buffer.</p>
<h2 id="autocommands-and-abbreviations">Autocommands and Abbreviations</h2>
<p>Let's pair up these buffer-local abbreviations with autocommands to set them to
make ourselves a little "snippet" system.</p>
<p>Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:autocmd FileType python     :iabbrev &lt;buffer&gt; iff if:&lt;left&gt;
:autocmd FileType javascript :iabbrev &lt;buffer&gt; iff if ()&lt;left&gt;</code></pre>


<p>Open a Javascript file and try out the <code>iff</code> abbreviation.  Then open a Python
file and try it there too.  Vim will perform the appropriate abbreviation
depending on the type of the current file.</p>
<h2 id="exercises">Exercises</h2>
<p>Create a few more "snippet" abbreviations for some of the things you type often
in specific kinds of files.  Some good candidates are <code>return</code> for most
languages, <code>function</code> for javascript, and things like <code>&amp;ldquo;</code> and <code>&amp;rdquo;</code>
for HTML files.</p>
<p>Add these snippets to your <code>~/.vimrc</code> file.</p>
<p>Remember: the best way to learn to use these new snippets is to <em>disable</em> the
old way of doing things.  Running <code>:iabbrev &lt;buffer&gt; return NOPENOPENOPE</code> will
<em>force</em> you to use your abbreviation instead.  Add these "training" snippets to
match all the ones you created to save time.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="12.html">&laquo; Previous</a>
            
            
                <a class="next" href="14.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Autocommand Groups / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="14.html#autocommand-groups">Autocommand Groups</a><ul>
<li><a href="14.html#the-problem">The Problem</a></li>
<li><a href="14.html#grouping-autocommands">Grouping Autocommands</a></li>
<li><a href="14.html#clearing-groups">Clearing Groups</a></li>
<li><a href="14.html#using-autocommands-in-your-vimrc">Using Autocommands in Your Vimrc</a></li>
<li><a href="14.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="13.html">&laquo; Prev</a>
            
            
                <a class="next" href="15.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="autocommand-groups">Autocommand Groups</h1>
<p>A few chapters ago we learned about autocommands.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufWrite * :echom "Writing buffer!"</code></pre>


<p>Now write the current buffer with <code>:write</code> and run <code>:messages</code> to view the
message log.  You should see the <code>Writing buffer!</code> message in the list.</p>
<p>Now write the current buffer again and run <code>:messages</code> to view the message log.
You should see the <code>Writing buffer!</code> message in the list twice.</p>
<p>Now run the exact same autocommand again:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufWrite * :echom "Writing buffer!"</code></pre>


<p>Write the current buffer one more time and run <code>:messages</code>.  You will see the
<code>Writing buffer!</code> message in the list <em>four</em> times.  What happened?</p>
<p>When you create an autocommand like this Vim has no way of knowing if you want
it to replace an existing one.  In our case, Vim created two <em>separate</em>
autocommands that each happen to do the same thing.</p>
<h2 id="the-problem">The Problem</h2>
<p>Now that you know it's possible to create duplicate autocommands, you may be
thinking: "So what?  Just don't do that!"</p>
<p>The problem is that sourcing your <code>~/.vimrc</code> file rereads the entire file,
including any autocommands you've defined!  This means that every time you
source your <code>~/.vimrc</code> you'll be duplicating autocommands, which will make Vim
run slower because it executes the same commands over and over.</p>
<p>To simulate this, try running the following command:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufWrite * :sleep 200m</code></pre>


<p>Now write the current buffer.  You may or may not notice a slight sluggishness
in Vim's writing time.  Now run the command three more times:</p>
<pre class="codehilite"><code class="language-vim">:autocmd BufWrite * :sleep 200m
:autocmd BufWrite * :sleep 200m
:autocmd BufWrite * :sleep 200m</code></pre>


<p>Write the file again.  This time the slowness will be more apparent.</p>
<p>Obviously you won't have any autocommands that do nothing but sleep, but the
<code>~/.vimrc</code> of a seasoned Vim user can easily reach 1,000 lines, many of which will
be autocommands.  Combine that with autocommands defined in any installed
plugins and it can definitely affect performance.</p>
<h2 id="grouping-autocommands">Grouping Autocommands</h2>
<p>Vim has a solution to the problem.  The first step is to group related
autocommands into named groups. </p>
<p>Open a fresh instance of Vim to clear out the autocommands from before, then run
the following commands:</p>
<pre class="codehilite"><code class="language-vim">:augroup testgroup
:    autocmd BufWrite * :echom "Foo"
:    autocmd BufWrite * :echom "Bar"
:augroup END</code></pre>


<p>The indentation in the middle two lines is insignificant.  You don't have to
type it if you don't want to.</p>
<p>Write a buffer and check <code>:messages</code>.  You should see both <code>Foo</code> and <code>Bar</code>.  Now
run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:augroup testgroup
:    autocmd BufWrite * :echom "Baz"
:augroup END</code></pre>


<p>Try to guess what will happen when you write the buffer again.  Once you have
a guess in mind, write the buffer and check <code>:messages</code> to see if you were
correct.</p>
<h2 id="clearing-groups">Clearing Groups</h2>
<p>What happened when you wrote the file?  Was it what you expected?</p>
<p>If you thought Vim would replace the group, you can see that you guessed
wrong.  Don't worry, most people think the same thing at first (I know I did).</p>
<p>When you use <code>augroup</code> multiple times Vim will <em>combine</em> the groups each time.</p>
<p>If you want to <em>clear</em> a group you can use <code>autocmd!</code> inside the group.  Run the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:augroup testgroup
:    autocmd!
:    autocmd BufWrite * :echom "Cats"
:augroup END</code></pre>


<p>Now try writing your file and checking <code>:messages</code>.  This time Vim only echoed
<code>Cats</code> when you wrote the file.</p>
<h2 id="using-autocommands-in-your-vimrc">Using Autocommands in Your Vimrc</h2>
<p>Now that we know how to group autocommands and clear those groups, we can use
this to add autocommands to <code>~/.vimrc</code> that don't add a duplicate every time we
source it.</p>
<p>Add the following to your <code>~/.vimrc</code> file:</p>
<pre class="codehilite"><code class="language-vim">augroup filetype_html
    autocmd!
    autocmd FileType html nnoremap &lt;buffer&gt; &lt;localleader&gt;f Vatzf
augroup END</code></pre>


<p>We enter the <code>filetype_html</code> group, immediately clear it, define an autocommand,
and leave the group.  If we source <code>~/.vimrc</code> again the clearing will prevent
Vim from adding duplicate autocommands.</p>
<h2 id="exercises">Exercises</h2>
<p>Go through your <code>~/.vimrc</code> file and wrap <em>every</em> autocommand you have in groups
like this.  You can put multiple autocommands in the same group if it makes
sense to you.</p>
<p>Try to figure out what the mapping in the last example does.</p>
<p>Read <code>:help autocmd-groups</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="13.html">&laquo; Previous</a>
            
            
                <a class="next" href="15.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Operator-Pending Mappings / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="15.html#operator-pending-mappings">Operator-Pending Mappings</a><ul>
<li><a href="15.html#movement-mappings">Movement Mappings</a></li>
<li><a href="15.html#changing-the-start">Changing the Start</a></li>
<li><a href="15.html#general-rules">General Rules</a></li>
<li><a href="15.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="14.html">&laquo; Prev</a>
            
            
                <a class="next" href="16.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="operator-pending-mappings">Operator-Pending Mappings</h1>
<p>In this chapter we're going to explore one more rabbit hole in Vim's mapping
system: "operator-pending mappings".  Let's step back for a second and make sure
we're clear on vocabulary.</p>
<p>An operator is a command that waits for you to enter a movement command, and
then does something on the text between where you currently are and where the
movement would take you.</p>
<p>Some examples of operators are <code>d</code>, <code>y</code>, and <code>c</code>.  For example:</p>
<pre class="codehilite"><code class="language-text">Keys   Operator   Movement
----   --------   -------------
dw     Delete     to next word
ci(    Change     inside parens
yt,    Yank       until comma</code></pre>


<h2 id="movement-mappings">Movement Mappings</h2>
<p>Vim lets you create new movements that work with all existing commands.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:onoremap p i(</code></pre>


<p>Now type the following text into a buffer:</p>
<pre class="codehilite"><code class="language-text">return person.get_pets(type="cat", fluffy_only=True)</code></pre>


<p>Put your cursor on the word "cat" and type <code>dp</code>.  What happened?  Vim deleted
all the text inside the parentheses.  You can think of this new movement as
"parameters".</p>
<p>The <code>onoremap</code> command tells Vim that when it's waiting for a movement to give
to an operator and it sees <code>p</code>, it should treat it like <code>i(</code>.  When we ran <code>dp</code>
it was like saying "delete parameters", which Vim translates to "delete inside
parentheses".</p>
<p>We can use this new mapping immediately with all operators.  Type the same text
as before into the buffer (or simply undo the change):</p>
<pre class="codehilite"><code class="language-text">return person.get_pets(type="cat", fluffy_only=True)</code></pre>


<p>Put your cursor on the word "cat" and type <code>cp</code>.  What happened?  Vim deleted
all the text inside the parentheses, but this time it left you in insert mode
because you used "change" instead of "delete".</p>
<p>Let's try another example.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:onoremap b /return&lt;cr&gt;</code></pre>


<p>Now type the following text into a buffer:</p>
<pre class="codehilite"><code class="language-python">def count(i):
    i += 1
    print i

    return foo</code></pre>


<p>Put your cursor on the <code>i</code> in the second line and press <code>db</code>.  What happened?
Vim deleted the entire body of the function, all the way up until the <code>return</code>,
which our mapping used Vim's normal search to find.</p>
<p>When you're trying to think about how to define a new operator-pending movement,
you can think of it like this:</p>
<ol>
<li>Start at the cursor position.</li>
<li>Enter visual mode (charwise).</li>
<li>... mapping keys go here ...</li>
<li>All the text you want to include in the movement should now be selected.</li>
</ol>
<p>It's your job to fill in step three with the appropriate keys.</p>
<h2 id="changing-the-start">Changing the Start</h2>
<p>You may have already seen a problem in what we've learned so far.  If our
movements always have to start at the current cursor position it limits what we
can do.</p>
<p>Vim isn't in the habit of limiting what you can do, so of course there's a way
around this problem.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:onoremap in( :&lt;c-u&gt;normal! f(vi(&lt;cr&gt;</code></pre>


<p>This might look frightening, but let's try it out.  Enter the following text
into the buffer:</p>
<pre class="codehilite"><code class="language-python">print foo(bar)</code></pre>


<p>Put your cursor somewhere in the word <code>print</code> and type <code>cin(</code>.  Vim will delete
the contents of the parentheses and place you in insert mode between them.</p>
<p>You can think of this mapping as meaning "inside next parentheses", and it will
perform the operator on the text inside the next set of parentheses on the
current line.</p>
<p>Let's make a companion "inside last parentheses" ("previous" would be a better
word, but it would shadow the "paragraph" movement).  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:onoremap il( :&lt;c-u&gt;normal! F)vi(&lt;cr&gt;</code></pre>


<p>Try it out on some text of your own to make sure it works.</p>
<p>So how do these mappings work?  First, the <code>&lt;c-u&gt;</code> is something special that you
can ignore for now -- just trust me that it needs to be there to make the
mappings work in all cases.  If we remove that we're left with:</p>
<pre class="codehilite"><code class="language-vim">:normal! F)vi(&lt;cr&gt;</code></pre>


<p><code>:normal!</code> is something we'll talk about in a later chapter, but for now it's
enough to know that it is a command used to simulate pressing keys in normal
mode.  For example, running <code>:normal! dddd</code> will delete two lines, just like
pressing <code>dddd</code>.  The <code>&lt;cr&gt;</code> at the end of the mapping is what executes the
<code>:normal!</code> command.</p>
<p>So now we know that the mapping is essentially just running the last block of
keys:</p>
<pre class="codehilite"><code class="language-vim">F)vi(</code></pre>


<p>This is fairly simple:</p>
<ul>
<li><code>F)</code>: Move backwards to the nearest <code>)</code> character.</li>
<li><code>vi(</code>: Visually select inside the parentheses.</li>
</ul>
<p>We end up with the text we want to operate on visually selected, and Vim
performs the operation on it as normal.</p>
<h2 id="general-rules">General Rules</h2>
<p>A good way to keep the multiple ways of creating operator-pending mappings
straight is to remember the following two rules:</p>
<ul>
<li>If your operator-pending mapping ends with some text visually selected, Vim
  will operate on that text.</li>
<li>Otherwise, Vim will operate on the text between the original cursor position
  and the new position.</li>
</ul>
<h2 id="exercises">Exercises</h2>
<p>Create operator-pending mappings for "around next parentheses" and "around last
parentheses".</p>
<p>Create similar mappings for in/around next/last for curly brackets.</p>
<p>Read <code>:help omap-info</code> and see if you can puzzle out what the <code>&lt;c-u&gt;</code> in the
examples is for.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="14.html">&laquo; Previous</a>
            
            
                <a class="next" href="16.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>More Operator-Pending Mappings / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="16.html#more-operator-pending-mappings">More Operator-Pending Mappings</a><ul>
<li><a href="16.html#normal">Normal</a></li>
<li><a href="16.html#execute">Execute</a></li>
<li><a href="16.html#results">Results</a></li>
<li><a href="16.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="15.html">&laquo; Prev</a>
            
            
                <a class="next" href="17.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="more-operator-pending-mappings">More Operator-Pending Mappings</h1>
<p>The idea of operators and movements is one of the most important concepts in Vim,
and it's one of the biggest reasons Vim is so efficient.  We're going to
practice defining new motions a bit more, because extending this powerful idea
makes Vim even <em>more</em> powerful.</p>
<p>Let's say you're writing some text in Markdown.  If you haven't used Markdown
before, don't worry, for our purposes here it's very simple.  Type the following
into a file:</p>
<pre class="codehilite"><code class="language-markdown">Topic One
=========

This is some text about topic one.

It has multiple paragraphs.

Topic Two
=========

This is some text about topic two.  It has only one paragraph.</code></pre>


<p>The lines "underlined" with <code>=</code> characters are treated as headings by Markdown.
Let's create some mappings that let us target headings with movements.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:onoremap ih :&lt;c-u&gt;execute "normal! ?^==\\+$\r:nohlsearch\rkvg_"&lt;cr&gt;</code></pre>


<p>This mapping is pretty complicated, so put your cursor in one of the paragraphs
(not the headings) and type <code>cih</code>.  Vim will delete the heading of whatever
section you're in and put you in insert mode ("change inside heading").</p>
<p>It uses some things we've never seen before, so let's look at each piece
individually.  The first part of the mapping, <code>:onoremap ih</code> is just the mapping
command that we've seen before, so we'll skip over that.  We'll keep ignoring
the <code>&lt;c-u&gt;</code> for the moment as well.</p>
<p>Now we're looking at the remainder of the line:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! ?^==\\+$\r:nohlsearch\rkvg_"&lt;cr&gt;</code></pre>


<h2 id="normal">Normal</h2>
<p>The <code>:normal</code> command takes a set of characters and performs whatever action
they would do if they were typed in normal mode.  We'll go into greater detail
in a later chapter, but we've seen it a few times already so it's time to at
least get a taste.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:normal gg</code></pre>


<p>Vim will move you to the top of the file.  Now run this command:</p>
<pre class="codehilite"><code class="language-vim">:normal &gt;&gt;</code></pre>


<p>Vim will indent the current line.</p>
<p>For now, don't worry about the <code>!</code> after <code>normal</code> in our mapping.  We'll talk
about that later.</p>
<h2 id="execute">Execute</h2>
<p>The <code>execute</code> command takes a Vimscript string (which we'll cover in more detail
later) and performs it as a command.  Run this:</p>
<pre class="codehilite"><code class="language-vim">:execute "write"</code></pre>


<p>Vim will write your file, just as if you had typed <code>:write&lt;cr&gt;</code>.  Now run this
command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! gg"</code></pre>


<p>Vim will run <code>:normal! gg</code>, which as we just saw will move you to the top of the
file.  But why bother with this when we could just run the <code>normal!</code> command
itself?</p>
<p>Look at the following command and try to guess what it will do:</p>
<pre class="codehilite"><code class="language-vim">:normal! gg/a&lt;cr&gt;</code></pre>


<p>It seems like it should:</p>
<ul>
<li>Move to the top of the file.</li>
<li>Start a search.</li>
<li>Fill in "a" as the target to search for.</li>
<li>Press return to perform the search.</li>
</ul>
<p>Run it.  Vim will move to the top of the file and nothing else!</p>
<p>The problem is that <code>normal!</code> doesn't recognize "special characters" like
<code>&lt;cr&gt;</code>.  There are a number of ways around this, but the easiest to use and read
is <code>execute</code>.</p>
<p>When <code>execute</code> looks at the string you tell it to run, it will substitute any
special characters it finds <em>before</em> running it.  In this case, <code>\r</code> is an
escape sequence that means "carriage return".  The double backslash is also an
escape sequence that puts a literal backslash in the string.</p>
<p>If we perform this replacement in our mapping and look at the result we can see
that the mapping is going to perform:</p>
<pre class="codehilite"><code class="language-text">:normal! ?^==\+$&lt;cr&gt;:nohlsearch&lt;cr&gt;kvg_
                ^^^^           ^^^^
                 ||             ||
These are ACTUAL carriage returns, NOT the four characters
"left angle bracket", "c", "r", and "right angle bracket".</code></pre>


<p>So now <code>normal!</code> will execute these characters as if we had typed them in normal
mode.  Let's split them apart at the returns to find out what they're doing:</p>
<pre class="codehilite"><code class="language-vim">?^==\+$
:nohlsearch
kvg_</code></pre>


<p>The first piece, <code>?^==\+$</code> performs a search backwards for any line that
consists of two or more equal signs and nothing else. This will leave our cursor
on the first character of the line of equal signs.</p>
<p>We're searching backwards because when you say "change inside heading" while
your cursor is in a section of text, you probably want to change the heading for
<em>that</em> section, not the next one.</p>
<p>The second piece is the <code>:nohlsearch</code> command.  This simply clears the search
highlighting from the search we just performed so it's not distracting.</p>
<p>The final piece is a sequence of three normal mode commands:</p>
<ul>
<li><code>k</code>: move up a line.  Since we were on the first character of the line of
  equal signs, we're now on the first character of the heading text.</li>
<li><code>v</code>: enter (characterwise) visual mode.</li>
<li><code>g_</code>: move to the last non-blank character of the current line.  We use this
  instead of <code>$</code> because <code>$</code> would highlight the newline character as well, and
  this isn't what we want.</li>
</ul>
<h2 id="results">Results</h2>
<p>That was a lot of work, but now we've looked at each part of the mapping.  To
recap:</p>
<ul>
<li>We created a operator-pending mapping for "inside this section's heading".</li>
<li>We used <code>execute</code> and <code>normal!</code> to run the normal commands we needed to select
  the heading, and allowing us to use special characters in those.</li>
<li>Our mapping searches for the line of equal signs which denotes a heading and
  visually selects the heading text above that.</li>
<li>Vim handles the rest.</li>
</ul>
<p>Let's look at one more mapping before we move on.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:onoremap ah :&lt;c-u&gt;execute "normal! ?^==\\+$\r:nohlsearch\rg_vk0"&lt;cr&gt;</code></pre>


<p>Try it by putting your cursor in a section's text and typing <code>cah</code>.  This time
Vim will delete not only the heading's text but also the line of equal signs
that denotes a heading.  You can think of this movement as "<em>around</em> this
section's heading".</p>
<p>What's different about this mapping?  Let's look at them side by side:</p>
<pre class="codehilite"><code class="language-vim">:onoremap ih :&lt;c-u&gt;execute "normal! ?^==\\+$\r:nohlsearch\rkvg_"&lt;cr&gt;
:onoremap ah :&lt;c-u&gt;execute "normal! ?^==\\+$\r:nohlsearch\rg_vk0"&lt;cr&gt;</code></pre>


<p>The only difference from the previous mapping is the very end, where we select
the text to operate on:</p>
<pre class="codehilite"><code class="language-text">inside heading: kvg_
around heading: g_vk0</code></pre>


<p>The rest of the mapping is the same, so we still start on the first character of
the line of equal signs.  From there:</p>
<ul>
<li><code>g_</code>: move to the last non-blank character in the line.</li>
<li><code>v</code>: enter (characterwise) visual mode.</li>
<li><code>k</code>: move up a line.  This puts us on the line containing the heading's text.</li>
<li><code>0</code>: move to the first character of the line.</li>
</ul>
<p>The result is that both the text and the equal signs end up visually selected,
and Vim performs the operation on both.</p>
<h2 id="exercises">Exercises</h2>
<p>Markdown can also have headings delimited with lines of <code>-</code> characters.  Adjust
the regex in these mappings to work for either type of heading.  You may want to
check out <code>:help pattern-overview</code>.  Remember that the regex is inside of
a string, so backslashes will need to be escaped.</p>
<p>Add two autocommands to your <code>~/.vimrc</code> file that will create these mappings.
Make sure to only map them in the appropriate buffers, and make sure to group
them so they don't get duplicated each time you source the file.</p>
<p>Read <code>:help normal</code>.</p>
<p>Read <code>:help execute</code>.</p>
<p>Read <code>:help expr-quote</code> to see the escape sequences you can use in strings.</p>
<p>Create a "inside next email address" operator-pending mapping so you can say
"change inside next email address".  <code>in@</code> is a good candidate for the keys to
map. You'll probably want to use <code>/...some regex...&lt;cr&gt;</code> for this.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="15.html">&laquo; Previous</a>
            
            
                <a class="next" href="17.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Status Lines / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="17.html#status-lines">Status Lines</a><ul>
<li><a href="17.html#width-and-padding">Width and Padding</a></li>
<li><a href="17.html#general-format">General Format</a></li>
<li><a href="17.html#splitting">Splitting</a></li>
<li><a href="17.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="16.html">&laquo; Prev</a>
            
            
                <a class="next" href="18.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="status-lines">Status Lines</h1>
<p>Vim allows you to customize the text in the status line at the bottom of each
window.  This is done through the <code>statusline</code> option.  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=%f</code></pre>


<p>You should see the path to the file (relative to the current directory) in the
status line.  Now run this command:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=%f\ -\ FileType:\ %y</code></pre>


<p>Now you'll see something like <code>foo.markdown - FileType: [markdown]</code> in the
status line.</p>
<p>If you're familiar with C's <code>printf</code> or Python's string interpolation the format
of this option may look familiar.  If not, the only trick is that things that
start with <code>%</code> are expanded to different text depending on what comes after
them.  In our example <code>%f</code> is replaced with the filename and <code>%y</code> is replaced
with the type of the file.</p>
<p>Notice how the spaces in the status line need to be escaped with backslashes.
This is because <code>set</code> allows you to set multiple options at once, as we saw in
the second chapter.</p>
<p>Status lines can get extremely complicated very quickly, so there's a better way
to set them that will let us be more clear.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=%f         " Path to the file
:set statusline+=\ -\      " Separator
:set statusline+=FileType: " Label
:set statusline+=%y        " Filetype of the file</code></pre>


<p>In the first command we used <code>=</code> to wipe out any existing value present.  In the
rest we used <code>+=</code> to build up the option one piece at a time.  We also added
comments explaining each piece for other people reading the code (or ourselves
several months later).</p>
<p>Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=%l    " Current line
:set statusline+=/    " Separator
:set statusline+=%L   " Total lines</code></pre>


<p>Now the status line contains only the current line number and number of lines in
the file, and looks something like <code>12/223</code>.</p>
<h2 id="width-and-padding">Width and Padding</h2>
<p>Additional characters can be used in some of the various <code>%</code> codes to change how
the information is displayed.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=[%4l]</code></pre>


<p>The line number in the status line will now be preceded by enough spaces to make
it at least four characters wide (for example: <code>[  12]</code>).  This can be useful to
prevent the text in the status line from shifting around distractingly.</p>
<p>By default the padding spaces are added on the left side of the value.  Run this
command:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=Current:\ %4l\ Total:\ %4L</code></pre>


<p>Your status line will now look like this:</p>
<pre class="codehilite"><code class="language-text">Current:   12 Total:  223</code></pre>


<p>You can use <code>-</code> to place padding on the right instead of the left.  Run this
command:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=Current:\ %-4l\ Total:\ %-4L</code></pre>


<p>Your status line will now look like this:</p>
<pre class="codehilite"><code class="language-text">Current: 12   Total: 223</code></pre>


<p>This looks much nicer because the numbers are next to their labels.</p>
<p>For codes that result in a number you can tell Vim to pad with zeros instead of
spaces.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=%04l</code></pre>


<p>Now your status line will read <code>0012</code> when on line twelve.</p>
<p>Finally, you can also set the maximum width of a code's output.  Run this
command:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=%F</code></pre>


<p><code>%F</code> displays the <em>full</em> path to the current file.  Now run this command to
change the maximum width:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=%.20F</code></pre>


<p>The path will be truncated if necessary, looking something like this:</p>
<pre class="codehilite"><code class="language-text">&lt;hapters/17.markdown</code></pre>


<p>This can be useful for preventing paths and other long codes from taking up the
entire line.</p>
<h2 id="general-format">General Format</h2>
<p>The general format for a code in a status line is shown in <code>:help statusline</code>:</p>
<pre class="codehilite"><code class="language-text">%-0{minwid}.{maxwid}{item}</code></pre>


<p>Everything except the <code>%</code> and the item is optional.</p>
<h2 id="splitting">Splitting</h2>
<p>We're not going to cover status lines in too much detail here (Vim's own
documentation on them is very extensive if you want to learn more), but there's
one more simple code that can be very useful immediately.  Run the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:set statusline=%f         " Path to the file
:set statusline+=%=        " Switch to the right side
:set statusline+=%l        " Current line
:set statusline+=/         " Separator
:set statusline+=%L        " Total lines</code></pre>


<p>Now the status line will contain the path to the file on the left side, and the
current/total lines on the right side.  The <code>%=</code> code tells Vim that everything
coming after that should be aligned (as a whole) to the right instead of the
left.</p>
<h2 id="exercises">Exercises</h2>
<p>Skim the list of available codes in <code>:help statusline</code>.  Don't worry if you
don't understand some of them just yet.</p>
<p>Add some lines to your <code>~/.vimrc</code> file to build yourself a custom status line.
Be sure to use the <code>+=</code> form of <code>set</code> to split the definition across multiple
lines, and add a comment on each line to document what each piece does.</p>
<p>Try using autocommands and <code>setlocal</code> to define different status lines for
different filetypes.  Make sure to wrap the autocommands in groups to prevent
duplication (as always).</p></div>

        <div class="prevnext">
            
                <a class="prev" href="16.html">&laquo; Previous</a>
            
            
                <a class="next" href="18.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Responsible Coding / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="18.html#responsible-coding">Responsible Coding</a><ul>
<li><a href="18.html#commenting">Commenting</a></li>
<li><a href="18.html#grouping">Grouping</a></li>
<li><a href="18.html#short-names">Short Names</a></li>
<li><a href="18.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="17.html">&laquo; Prev</a>
            
            
                <a class="next" href="19.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="responsible-coding">Responsible Coding</h1>
<p>So far we've covered a bunch of Vim commands that let you customize Vim quickly.
All of them except for autocommand groups were single-line commands that you
can add to your <code>~/.vimrc</code> file in seconds.</p>
<p>In the next part of the book we're going to dive into Vimscript as a real
programming language, but before we do that I want to talk a bit about how to
stay sane while writing large amounts of Vimscript.</p>
<h2 id="commenting">Commenting</h2>
<p>Vimscript is extremely powerful, but has grown organically over the years into
a twisty maze ready to ensnare unwary programmers who enter it.</p>
<p>Options and commands are often terse and hard to read, and working around
compatibility issues can increase the complexity of your code.  Writing a plugin
and allowing for user customization introduces another entire layer above that!</p>
<p>Be defensive when writing anything that takes more than a few lines of
Vimscript.  Add a comment explaining what it does, and if there is a relevant
help topic, mention it in the comment!</p>
<p>This not only benefits you when you try to maintain it months or years later,
but also helps other people understand it if you share your <code>~/.vimrc</code> file on
Bitbucket or GitHub (which I highly recommend).</p>
<h2 id="grouping">Grouping</h2>
<p>Our mappings for editing and sourcing <code>~/.vimrc</code> have made it quick and easy to
add new things to it on the fly.  Unfortunately this also makes it easy for it
to grow out of control and become hard to navigate.</p>
<p>One way to combat this is to use Vim's code folding capabilities and group lines
into sections.  If you've never used Vim's folding you should look into it as
soon as you can.  Some people (myself included) find it indispensable in our day
to day coding.</p>
<p>First we need to set up folding for Vimscript files.  Add the following lines to
your <code>~/.vimrc</code> file:</p>
<pre class="codehilite"><code class="language-vim">augroup filetype_vim
    autocmd!
    autocmd FileType vim setlocal foldmethod=marker
augroup END</code></pre>


<p>This will tell Vim to use the <code>marker</code> method of folding for any Vimscript
files.</p>
<p>Go ahead and run <code>:setlocal foldmethod=marker</code> in the window with your
<code>~/.vimrc</code> file now.  Sourcing the file won't work, because Vim has already set
the FileType for this file and the autocommand only fires when that happens.  In
the future you won't need to do it manually.</p>
<p>Now add lines before and after that autocommand group so that it looks like
this:</p>
<pre class="codehilite"><code class="language-vim">" Vimscript file settings ---------------------- {{{
augroup filetype_vim
    autocmd!
    autocmd FileType vim setlocal foldmethod=marker
augroup END
" }}}</code></pre>


<p>Return to normal mode, put your cursor on any of those lines and type <code>za</code>.  Vim
will fold the lines starting at the one containing <code>{{{</code> and ending at the one
containing <code>}}}</code>.  Typing <code>za</code> again will unfold the lines.</p>
<p>You may think that adding explicit comments to source code that describe folding
is ugly at first.  I thought the same way when I first saw it.  For most files
I still think it's wrong.  Not everyone uses the same editor, so littering your
code with folding comments is just noisy to anyone else looking at the code in
something other than Vim.</p>
<p>Vimscript files are special case, though.  It's highly unlikely that someone who
doesn't use Vim will be reading your code, and it's especially important to
group things explicitly and thoughtfully when writing Vimscript so you don't go
crazy.</p>
<p>Try these explicit folds out for a while.  You might grow to love them.</p>
<h2 id="short-names">Short Names</h2>
<p>Vim allows you to use abbreviated names for most commands and options.  For
example, both of these commands do exactly the same thing:</p>
<pre class="codehilite"><code class="language-vim">:setlocal wrap
:setl wrap</code></pre>


<p>I'd like to <em>strongly</em> caution you against using these abbreviations in your
<code>~/.vimrc</code> file and in plugins that you write.  Vimscript is terse and cryptic
enough to begin with; shortening things further is only going to make it even
harder to read.  Even if <em>you</em> know what a certain short command means, someone
else reading your code might not.</p>
<p>With that said, the abbreviated forms are <em>great</em> for running commands manually
in the middle of coding.  No one will ever see them again after you press
return, so there's no reason to press more keys than you have to.</p>
<h2 id="exercises">Exercises</h2>
<p>Go through your entire <code>~/.vimrc</code> file and arrange the lines into related
groups.  Some places to start might be: "Basic Settings", "FileType-specific
settings", "Mappings", and "Status Line".  Add folding markers with headings to
each section.</p>
<p>Find out how to make Vim fold everything automatically the first time you open
the file.  Look at <code>:help foldlevelstart</code> for a good place to start.</p>
<p>Go through your <code>~/.vimrc</code> file and change any abbreviated commands and options
to their full names.</p>
<p>Look through your <code>~/.vimrc</code> file and make sure you don't have any sensitive
information inside.  Create a git or Mercurial repository, move the file into
it, and symlink that file to <code>~/.vimrc</code>.</p>
<p>Commit the repository you just made and put it on Bitbucket or GitHub so other
people can see it and get ideas for their own.  Be sure to commit and push the
repository fairly often so your changes are recorded.</p>
<p>If you use Vim on more than one machine, clone down that repository and symlink
the file there as well.  This will make it simple and easy to use the exact same
Vim configuration on all machines you work with.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="17.html">&laquo; Previous</a>
            
            
                <a class="next" href="19.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Variables / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="19.html#variables">Variables</a><ul>
<li><a href="19.html#options-as-variables">Options as Variables</a></li>
<li><a href="19.html#local-options">Local Options</a></li>
<li><a href="19.html#registers-as-variables">Registers as Variables</a></li>
<li><a href="19.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="18.html">&laquo; Prev</a>
            
            
                <a class="next" href="20.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="variables">Variables</h1>
<p>Up to this point we've covered single commands.  For the next third of the book
we're going to look at Vimscript as a <em>programming language</em>.  This won't be as
instantly gratifying as the rest of what you've learned, but it will lay the
groundwork for the last part of the book, which walks through creating
a full-fledged Vim plugin from scratch.</p>
<p>Let's get started.  The first thing we need to talk about are variables.  Run
the following commands:</p>
<pre class="codehilite"><code class="language-vim">:let foo = "bar"
:echo foo</code></pre>


<p>Vim will display <code>bar</code>.  <code>foo</code> is now a variable, and we've assigned it
a string: <code>"bar"</code>.  Now run these commands:</p>
<pre class="codehilite"><code class="language-vim">:let foo = 42
:echo foo</code></pre>


<p>Vim will display <code>42</code>, because we've reassigned <code>foo</code> to the integer <code>42</code>.</p>
<p>From these short examples it may seem like Vimscript is dynamically typed.
That's not the case, but we'll talk more about that later.</p>
<h2 id="options-as-variables">Options as Variables</h2>
<p>You can read and set <em>options</em> as variables by using a special syntax.  Run the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:set textwidth=80
:echo &amp;textwidth</code></pre>


<p>Vim will display <code>80</code>.  Using an ampersand in front of a name tells Vim that
you're referring to the option, not a variable that happens to have the same
name.</p>
<p>Let's see how Vim works with boolean options.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:set nowrap
:echo &amp;wrap</code></pre>


<p>Vim displays <code>0</code>.  Now try these commands:</p>
<pre class="codehilite"><code class="language-vim">:set wrap
:echo &amp;wrap</code></pre>


<p>This time Vim displays <code>1</code>.  This is a very strong hint that Vim treats the
integer <code>0</code> as "false" and the integer <code>1</code> as "true".  It would be reasonable to
assume that Vim treats <em>any</em> non-zero integer as "truthy", and this is indeed
the case.</p>
<p>We can also <em>set</em> options as variables using the <code>let</code> command.  Run the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:let &amp;textwidth = 100
:set textwidth?</code></pre>


<p>Vim will display <code>textwidth=100</code>.</p>
<p>Why would we want to do this when we could just use <code>set</code>? Run the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:let &amp;textwidth = &amp;textwidth + 10
:set textwidth?</code></pre>


<p>This time Vim displays <code>textwidth=110</code>.  When you set an option using <code>set</code> you
can only set it to a single literal value.  When you use <code>let</code> and set it as
a variable you can use the full power of Vimscript to determine the value.</p>
<h2 id="local-options">Local Options</h2>
<p>If you want to set the <em>local</em> value of an option as a variable, instead of the
<em>global</em> value, you need to prefix the variable name.</p>
<p>Open two files in separate splits.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:let &amp;l:number = 1</code></pre>


<p>Now switch to the other file and run this command:</p>
<pre class="codehilite"><code class="language-vim">:let &amp;l:number = 0</code></pre>


<p>Notice that the first window has line numbers and the second does not.</p>
<h2 id="registers-as-variables">Registers as Variables</h2>
<p>You can also read and set <em>registers</em> as variables.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:let @a = "hello!"</code></pre>


<p>Now put your cursor somewhere in your text and type <code>"ap</code>.  This command tells
Vim to "paste the contents of register <code>a</code> here".  We just set the contents of
that register, so Vim pastes <code>hello!</code> into your text.</p>
<p>Registers can also be read.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo @a</code></pre>


<p>Vim will echo <code>hello!</code>.</p>
<p>Select a word in your file and yank it with <code>y</code>, then run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo @"</code></pre>


<p>Vim will echo the word you just yanked.  The <code>"</code> register is the "unnamed"
register, which is where text you yank without specifying a destination will go.</p>
<p>Perform a search in your file with <code>/someword</code>, then run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo @/</code></pre>


<p>Vim will echo the search pattern you just used.  This lets you programmatically
read <em>and modify</em> the current search pattern, which can be very useful at times.</p>
<h2 id="exercises">Exercises</h2>
<p>Go through your <code>~/.vimrc</code> file and change some of the <code>set</code> and <code>setlocal</code>
commands to their <code>let</code> forms.  Remember that boolean options still need to be
set to something.</p>
<p>Try setting a boolean option like <code>wrap</code> to something other than zero or one.
What happens when you set it to a different number?  What happens if you set it
to a string?</p>
<p>Go back through your <code>~/.vimrc</code> file and undo the changes.  You should never use
<code>let</code> if <code>set</code> will suffice -- it's harder to read.</p>
<p>Read <code>:help registers</code> and look over the list of registers you can read and
write.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="18.html">&laquo; Previous</a>
            
            
                <a class="next" href="20.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Variable Scoping / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="20.html#variable-scoping">Variable Scoping</a><ul>
<li><a href="20.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="19.html">&laquo; Prev</a>
            
            
                <a class="next" href="21.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="variable-scoping">Variable Scoping</h1>
<p>So far Vimscript's variables may seem familiar if you come from a dynamic
language like Python or Ruby.  For the most part variables act like you would
expect, but Vim adds a certain twist to variables: scoping.</p>
<p>Open two different files in separate splits, then go into one of them and run
the following commands:</p>
<pre class="codehilite"><code class="language-vim">:let b:hello = "world"
:echo b:hello</code></pre>


<p>As expected, Vim displays <code>world</code>.  Now switch to the other buffer and run the
<code>echo</code> command again:</p>
<pre class="codehilite"><code class="language-vim">:echo b:hello</code></pre>


<p>This time Vim throws an error, saying it can't find the variable.</p>
<p>When we used <code>b:</code> in the variable name we told Vim that the variable <code>hello</code>
should be local to the current buffer.</p>
<p>Vim has many different scopes for variables, but we need to learn a little more
about Vimscript before we can take advantage of the rest.  For now, just
remember that when you see a variable that starts with a character and a colon
that it's describing a scoped variable.</p>
<h2 id="exercises">Exercises</h2>
<p>Skim over the list of scopes in <code>:help internal-variables</code>.  Don't worry if you
don't know what some of them mean, just take a look and keep them in the back of
your mind.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="19.html">&laquo; Previous</a>
            
            
                <a class="next" href="21.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Conditionals / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="21.html#conditionals">Conditionals</a><ul>
<li><a href="21.html#multiple-line-statements">Multiple-Line Statements</a></li>
<li><a href="21.html#basic-if">Basic If</a></li>
<li><a href="21.html#else-and-elseif">Else and Elseif</a></li>
<li><a href="21.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="20.html">&laquo; Prev</a>
            
            
                <a class="next" href="22.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="conditionals">Conditionals</h1>
<p>Every programming language has a way to branch, and in Vimscript that method is
the <code>if</code> statement.  The <code>if</code> statement is the core of branching in Vim.
There's no <code>unless</code> statement like Ruby, so any decision making you do in your
coding will be done with <code>if</code>s.</p>
<p>Before we talk about Vim's <code>if</code> statement we need to take a short detour to talk
about syntax so we're all on the same page.</p>
<h2 id="multiple-line-statements">Multiple-Line Statements</h2>
<p>Sometimes you can't fit a piece of Vimscript on a single line of code.  We saw this
when we talked about autocommand groups.  Here's a chunk of code we used before:</p>
<pre class="codehilite"><code class="language-vim">:augroup testgroup
:    autocmd BufWrite * :echom "Baz"
:augroup END</code></pre>


<p>You can write this as three separate lines in a Vimscript file, which is ideal,
but it gets tedious to write this way when running commands manually.  Instead
you can separate each line with a pipe character (<code>|</code>).  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:echom "foo" | echom "bar"</code></pre>


<p>Vim will treat that as two separate commands.  Use <code>:messages</code> to check the log
if you didn't see both lines appear.</p>
<p>For the rest of this book if you want to manually run a command but don't want
to bother typing in the newlines and colons, feel free to put it all on one line
separated by pipes.</p>
<h2 id="basic-if">Basic If</h2>
<p>Now that we've got that out of the way, run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:if 1
:    echom "ONE"
:endif</code></pre>


<p>Vim will display <code>ONE</code>, because the integer <code>1</code> is "truthy".  Now try these
commands:</p>
<pre class="codehilite"><code class="language-vim">:if 0
:    echom "ZERO"
:endif</code></pre>


<p>Vim will <em>not</em> display <code>ZERO</code> because the integer <code>0</code> is "falsy".  Let's see how
strings behave.  Run these commands:</p>
<pre class="codehilite"><code class="language-vim">:if "something"
:    echom "INDEED"
:endif</code></pre>


<p>The results may surprise you.  Vim does <em>not</em> necessarily treat a non-empty
string as "truthy", so it will not display anything!</p>
<p>Let's dive a bit further down the rabbit hole.  Run these commands:</p>
<pre class="codehilite"><code class="language-vim">:if "9024"
:    echom "WHAT?!"
:endif</code></pre>


<p>This time Vim <em>does</em> display the text!  What's going on here?</p>
<p>To try to wrap our heads around what's going on, run the following three commands:</p>
<pre class="codehilite"><code class="language-vim">:echom "hello" + 10
:echom "10hello" + 10
:echom "hello10" + 10</code></pre>


<p>The first command causes Vim to echo <code>10</code>, the second command echoes <code>20</code>, and
the third echoes <code>10</code> again!</p>
<p>After observing all of these commands we can draw a few informed conclusions
about Vimscript:</p>
<ul>
<li>Vim will try to coerce variables (and literals) when necessary.  When <code>10 + 
  "20foo"</code> is evaluated Vim will convert <code>"20foo"</code> to an integer (which
  results in <code>20</code>) and then add it to <code>10</code>.</li>
<li>Strings that start with a number are coerced to that number, otherwise they're
  coerced to <code>0</code>.</li>
<li>Vim will execute the body of an <code>if</code> statement when its condition evaluates to
  a non-zero integer, <em>after</em> all coercion takes place.</li>
</ul>
<h2 id="else-and-elseif">Else and Elseif</h2>
<p>Vim, like Python, supports both "else" and "else if" clauses.  Run the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:if 0
:    echom "if"
:elseif "nope!"
:    echom "elseif"
:else
:    echom "finally!"
:endif</code></pre>


<p>Vim echoes <code>finally!</code> because both of the previous conditions evaluate to zero,
which is falsy.</p>
<h2 id="exercises">Exercises</h2>
<p>Drink a beer to console yourself about Vim's coercion of strings to integers.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="20.html">&laquo; Previous</a>
            
            
                <a class="next" href="22.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Comparisons / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="22.html#comparisons">Comparisons</a><ul>
<li><a href="22.html#case-sensitivity">Case Sensitivity</a></li>
<li><a href="22.html#code-defensively">Code Defensively</a></li>
<li><a href="22.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="21.html">&laquo; Prev</a>
            
            
                <a class="next" href="23.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="comparisons">Comparisons</h1>
<p>We've gone over conditionals, but <code>if</code> statements aren't very useful if we can't
compare things.  Of course Vim lets us compare values, but it's not as
straightforward as it may seem.</p>
<p>Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:if 10 &gt; 1
:    echom "foo"
:endif</code></pre>


<p>Vim will, of course, display <code>foo</code>.  Now run these commands:</p>
<pre class="codehilite"><code class="language-vim">:if 10 &gt; 2001
:    echom "bar"
:endif</code></pre>


<p>Vim displays nothing, because <code>10</code> is not greater than <code>2001</code>.  So far
everything works as expected.  Run these commands:</p>
<pre class="codehilite"><code class="language-vim">:if 10 == 11
:    echom "first"
:elseif 10 == 10
:    echom "second"
:endif</code></pre>


<p>Vim displays <code>second</code>.  Nothing surprising here.  Let's try comparing strings.
Run these commands:</p>
<pre class="codehilite"><code class="language-vim">:if "foo" == "bar"
:    echom "one"
:elseif "foo" == "foo"
:    echom "two"
:endif</code></pre>


<p>Vim echoes <code>two</code>.  There's still nothing surprising, so what was I going on
about at the beginning of the chapter?</p>
<h2 id="case-sensitivity">Case Sensitivity</h2>
<p>Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:set noignorecase
:if "foo" == "FOO"
:    echom "vim is case insensitive"
:elseif "foo" == "foo"
:    echom "vim is case sensitive"
:endif</code></pre>


<p>Vim evaluates the <code>elseif</code>, so apparently Vimscript is case sensitive.  Good to
know, but nothing earth-shattering.  Now run these commands:</p>
<pre class="codehilite"><code class="language-vim">:set ignorecase
:if "foo" == "FOO"
:    echom "no, it couldn't be"
:elseif "foo" == "foo"
:    echom "this must be the one"
:endif</code></pre>


<p><strong>Whoa</strong>.  Stop right there.  Yes, you saw that right.</p>
<p><strong>The behavior of <code>==</code> depends on a user's settings.</strong></p>
<p>I promise I'm not messing with you.  Try it again and see.  I'm not kidding,
I can't make this stuff up.</p>
<h2 id="code-defensively">Code Defensively</h2>
<p>What does this mean?  It means that you can <em>never</em> trust the <code>==</code> comparison
when writing a plugin for other people to use.  A bare <code>==</code> should <em>never</em>
appear in your plugins' code.</p>
<p>This idea is the same as the "<code>nmap</code> versus <code>nnoremap</code>" one.  <em>Never</em> trust your
users' settings.  Vim is old, vast, and complicated.  When writing a plugin you
<em>have</em> to assume that users will have every variation of every setting.</p>
<p>So how can you get around this ridiculousness?  It turns out that Vim has <em>two
extra sets</em> of comparison operators to deal with this.</p>
<p>Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:set noignorecase
:if "foo" ==? "FOO"
:    echom "first"
:elseif "foo" ==? "foo"
:    echom "second"
:endif</code></pre>


<p>Vim displays <code>first</code> because <code>==?</code> is the "case-insensitive no matter what the
user has set" comparison operator.  Now run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:set ignorecase
:if "foo" ==# "FOO"
:    echom "one"
:elseif "foo" ==# "foo"
:    echom "two"
:endif</code></pre>


<p>Vim displays <code>two</code> because <code>==#</code> is the "case-sensitive no matter what the user
has set" comparison operator.</p>
<p>The moral of this story is that you should <em>always</em> use explicit case sensitive
or insensitive comparisons.  Using the normal forms is <em>wrong</em> and it <em>will</em>
break at some point.  Save yourself the trouble and type the extra character.</p>
<p>When you're comparing integers this distinction obviously doesn't matter.
Still, I feel that it's better to use the case-sensitive comparisons everywhere
(even where they're not strictly needed), than to forget them in a place that
they <em>are</em> needed.</p>
<p>Using <code>==#</code> and <code>==?</code> with integers will work just fine, and if you change them
to strings in the future it will work correctly.  If you'd rather use <code>==</code> for
integers that's fine, just remember that you'll need to change the comparison if
you change them to strings in the future.</p>
<h2 id="exercises">Exercises</h2>
<p>Play around with <code>:set ignorecase</code> and <code>:set noignorecase</code> and see how various
comparisons act.</p>
<p>Read <code>:help ignorecase</code> to see why someone might set that option.</p>
<p>Read <code>:help expr4</code> to see all the available comparison operators.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="21.html">&laquo; Previous</a>
            
            
                <a class="next" href="23.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Functions / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="23.html#functions">Functions</a><ul>
<li><a href="23.html#calling-functions">Calling Functions</a></li>
<li><a href="23.html#implicit-returning">Implicit Returning</a></li>
<li><a href="23.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="22.html">&laquo; Prev</a>
            
            
                <a class="next" href="24.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="functions">Functions</h1>
<p>Like most programming languages, Vimscript has functions.  Let's take a look at
how to create them, and then talk about some of their quirks.</p>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:function meow()</code></pre>


<p>You might think this would start defining a function named <code>meow</code>.
Unfortunately this is not the case, and we've already run into one of
Vimscript's quirks.</p>
<p><strong>Vimscript functions <em>must</em> start with a capital letter if they are unscoped!</strong></p>
<p>Even if you <em>do</em> add a scope to a function (we'll talk about that later) you
may as well capitalize the first letter of function names anyway.  Most
Vimscript coders seem to do it, so don't break the convention.</p>
<p>Okay, let's define a function for real this time.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:function Meow()
:  echom "Meow!"
:endfunction</code></pre>


<p>This time Vim will happily define the function.  Let's try running it:</p>
<pre class="codehilite"><code class="language-vim">:call Meow()</code></pre>


<p>Vim will display <code>Meow!</code> as expected.</p>
<p>Let's try returning a value.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:function GetMeow()
:  return "Meow String!"
:endfunction</code></pre>


<p>Now try it out by running this command:</p>
<pre class="codehilite"><code class="language-vim">:echom GetMeow()</code></pre>


<p>Vim will call the function and give the result to <code>echom</code>, which will display
<code>Meow String!</code>.</p>
<h2 id="calling-functions">Calling Functions</h2>
<p>We can already see that there are two different ways of calling functions in
Vimscript.</p>
<p>When you want to call a function directly you use the <code>call</code> command.  Run the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:call Meow()
:call GetMeow()</code></pre>


<p>The first will display <code>Meow!</code> but the second doesn't display anything. The
return value is thrown away when you use <code>call</code>, so this is only useful when the
function has side effects.</p>
<p>The second way to call functions is in expressions.  You don't need to use
<code>call</code> in this case, you can just name the function.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom GetMeow()</code></pre>


<p>As we saw before, this calls <code>GetMeow</code> and passes the return value to <code>echom</code>.</p>
<h2 id="implicit-returning">Implicit Returning</h2>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom Meow()</code></pre>


<p>This will display two lines: <code>Meow!</code> and <code>0</code>.  The first obviously comes from
the <code>echom</code> inside of <code>Meow</code>.  The second shows us that if a Vimscript function
doesn't return a value, it implicitly returns <code>0</code>.  Let's use this to our
advantage.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:function TextwidthIsTooWide()
:  if &amp;l:textwidth &gt;# 80
:    return 1
:  endif
:endfunction</code></pre>


<p>This function uses a lot of important concepts we've seen before:</p>
<ul>
<li><code>if</code> statements</li>
<li>Treating options as variables</li>
<li>Localizing those option variables</li>
<li>Case-sensitive comparisons</li>
</ul>
<p>If any of those sound unfamiliar you should go back a few chapters and read
about them.</p>
<p>We've now defined a function that will tell us if the <code>textwidth</code> setting is
"too wide" in the current buffer (because 80 characters is, of course, the
correct width for anything but HTML).</p>
<p>Let's try using it.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:set textwidth=80
:if TextwidthIsTooWide()
:  echom "WARNING: Wide text!"
:endif</code></pre>


<p>What did we do here?</p>
<ul>
<li>First we set the <code>textwidth</code> globally to <code>80</code>.</li>
<li>Then we ran an if statement that checked if <code>TextwidthIsTooWide()</code> was truthy.</li>
<li>This wound up not being the case, so the <code>if</code>'s body wasn't executed.</li>
</ul>
<p>Because we never explicitly returned a value, Vim returned <code>0</code> from the
function, which is falsy.  Let's try changing that.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:setlocal textwidth=100
:if TextwidthIsTooWide()
:  echom "WARNING: Wide text!"
:endif</code></pre>


<p>This time the <code>if</code> statement in the function executes its body, returns <code>1</code>, and
so the <code>if</code> we manually typed in executes <em>its</em> body.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help :call</code>.  Ignore anything about "ranges" for now.  How many arguments
can you pass to a function?  Is this surprising?</p>
<p>Read the first paragraph of <code>:help E124</code> and find out what characters you're
allowed to use in function names.  Are underscores okay?  Dashes?  Accented
characters?  Unicode characters?  If it's not clear from the documentation just
try them out and see.</p>
<p>Read <code>:help return</code>.  What's the "short form" of that command (which I told you
to never use)?  Is it what you expected?  If not, why not?</p></div>

        <div class="prevnext">
            
                <a class="prev" href="22.html">&laquo; Previous</a>
            
            
                <a class="next" href="24.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Function Arguments / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="24.html#function-arguments">Function Arguments</a><ul>
<li><a href="24.html#varargs">Varargs</a></li>
<li><a href="24.html#assignment">Assignment</a></li>
<li><a href="24.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="23.html">&laquo; Prev</a>
            
            
                <a class="next" href="25.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="function-arguments">Function Arguments</h1>
<p>Vimscript functions can, of course, take arguments.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:function DisplayName(name)
:  echom "Hello!  My name is:"
:  echom a:name
:endfunction</code></pre>


<p>Run the function:</p>
<pre class="codehilite"><code class="language-vim">:call DisplayName("Your Name")</code></pre>


<p>Vim will display two lines: <code>Hello!  My name is:</code> and <code>Your Name</code>.</p>
<p>Notice the <code>a:</code> in the name of the variable that we passed to the <code>echom</code>
command.  This represents a variable scope, which we talked about in an earlier
chapter.</p>
<p>Let's remove this scope prefix and see how Vim reacts.  Run the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:function UnscopedDisplayName(name)
:  echom "Hello!  My name is:"
:  echom name
:endfunction
:call UnscopedDisplayName("Your Name")</code></pre>


<p>This time Vim complains that it can't find the variable <code>name</code>.</p>
<p>When you write a Vimscript function that takes arguments you <em>always</em> need to
prefix those arguments with <code>a:</code> when you use them to tell Vim that they're in
the argument scope.</p>
<h2 id="varargs">Varargs</h2>
<p>Vimscript functions can optionally take variable-length argument lists like
Javascript and Python.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:function Varg(...)
:  echom a:0
:  echom a:1
:  echo a:000
:endfunction

:call Varg("a", "b")</code></pre>


<p>This function shows us several things, so let's look at each one individually.</p>
<p>The <code>...</code> in the function definition tells Vim that this function can take any
number of arguments.  This is like a <code>*args</code> argument in a Python function.</p>
<p>The first line of the function echoes the message <code>a:0</code> and displays <code>2</code>.  When
you define a function that takes a variable number of arguments in Vim, <code>a:0</code>
will be set to the number of extra arguments you were given.  In this case we
passed two arguments to <code>Varg</code> so Vim displayed <code>2</code>.</p>
<p>The second line echoes <code>a:1</code> which displays <code>a</code>.  You can use <code>a:1</code>, <code>a:2</code>, etc
to refer to each extra argument your function receives.  If we had used <code>a:2</code>
Vim would have displayed "b".</p>
<p>The third line is a bit trickier.  When a function has varargs, <code>a:000</code> will be
set to a list containing all the extra arguments that were passed.  We haven't
looked at lists quite yet, so don't worry about this too much.  You can't use
<code>echom</code> with a list, which is why we used <code>echo</code> instead for that line.</p>
<p>You can use varargs together with regular arguments too.  Run the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:function Varg2(foo, ...)
:  echom a:foo
:  echom a:0
:  echom a:1
:  echo a:000
:endfunction

:call Varg2("a", "b", "c")</code></pre>


<p>We can see that Vim puts <code>"a"</code> into the named argument <code>a:foo</code>, and the rest are
put into the list of varargs.</p>
<h2 id="assignment">Assignment</h2>
<p>Try running the following commands:</p>
<pre class="codehilite"><code class="language-vim">:function Assign(foo)
:  let a:foo = "Nope"
:  echom a:foo
:endfunction

:call Assign("test")</code></pre>


<p>Vim will throw an error, because you can't reassign argument variables.  Now run
these commands:</p>
<pre class="codehilite"><code class="language-vim">:function AssignGood(foo)
:  let foo_tmp = a:foo
:  let foo_tmp = "Yep"
:  echom foo_tmp
:endfunction

:call AssignGood("test")</code></pre>


<p>This time the function works, and Vim displays <code>Yep</code>.</p>
<h2 id="exercises">Exercises</h2>
<p>Read the first two paragraphs of <code>:help function-argument</code>.</p>
<p>Read <code>:help local-variables</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="23.html">&laquo; Previous</a>
            
            
                <a class="next" href="25.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Numbers / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="25.html#numbers">Numbers</a><ul>
<li><a href="25.html#number-formats">Number Formats</a></li>
<li><a href="25.html#float-formats">Float Formats</a></li>
<li><a href="25.html#coercion">Coercion</a></li>
<li><a href="25.html#division">Division</a></li>
<li><a href="25.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="24.html">&laquo; Prev</a>
            
            
                <a class="next" href="26.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="numbers">Numbers</h1>
<p>Now it's time to start taking a closer look at the different types of variables
you can use.  First we'll go over Vim's numeric types.</p>
<p>Vimscript has two types of numeric variables: Numbers and Floats.  A Number is
a 32 bit signed integer.  A Float is a floating point number.</p>
<h2 id="number-formats">Number Formats</h2>
<p>You can specify Numbers in a few different ways.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom 100</code></pre>


<p>No surprises here -- Vim displays <code>100</code>.  Now run this command:</p>
<pre class="codehilite"><code class="language-vim">:echom 0xff</code></pre>


<p>This time Vim displays <code>255</code>.  You can specify numbers in hex notation by
prefixing them with <code>0x</code> or <code>0X</code>.  Now run this command:</p>
<pre class="codehilite"><code class="language-vim">:echom 010</code></pre>


<p>You can also use octal by starting a number with a <code>0</code>.  Be careful with this,
because it's easy to make mistakes.  Try the following commands:</p>
<pre class="codehilite"><code class="language-vim">:echom 017
:echom 019</code></pre>


<p>Vim will print <code>15</code> for the first command, because <code>17</code> in octal is equal to
<code>15</code> in decimal.  For the second command Vim treats it as a decimal number, even
though it starts with a <code>0</code>, because it's not a valid octal number.</p>
<p>Because Vim silently does the wrong thing in this case, I'd recommend avoiding
the use of octal numbers when possible.</p>
<h2 id="float-formats">Float Formats</h2>
<p>Floats can also be specified in multiple ways.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo 100.1</code></pre>


<p>Notice that we're using <code>echo</code> here and not <code>echom</code> like we usually do.  We'll
talk about why in a moment.</p>
<p>Vim displays <code>100.1</code> as expected.  You can also use exponential notation.  Run
this command:</p>
<pre class="codehilite"><code class="language-vim">:echo 5.45e+3</code></pre>


<p>Vim displays <code>5450.0</code>.  A negative exponent can also be used.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo 15.45e-2</code></pre>


<p>Vim displays <code>0.1545</code>.  The <code>+</code> or <code>-</code> before the power of ten is optional. If
it's omitted then it's assumed to be positive.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo 15.3e9</code></pre>


<p>Vim will display <code>1.53e10</code>, which is equivalent.  The decimal point and number
after it are <em>not</em> optional.  Run the following command and see that it crashes:</p>
<pre class="codehilite"><code class="language-vim">:echo 5e10</code></pre>


<h2 id="coercion">Coercion</h2>
<p>When you combine a Number and a Float through arithmetic, comparison, or any
other operation Vim will cast the Number to a Float, resulting in a Float.  Run
the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo 2 * 2.0</code></pre>


<p>Vim displays <code>4.0</code>.</p>
<h2 id="division">Division</h2>
<p>When dividing two Numbers, the remainder is dropped.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo 3 / 2</code></pre>


<p>Vim displays <code>1</code>.  If you want Vim to perform floating point division one of the
numbers needs to be a Float, which will cause the other one to be coerced to
a Float as well.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo 3 / 2.0</code></pre>


<p>Vim displays <code>1.5</code>.  The <code>3</code> is coerced to a Float, and then normal floating
point division is performed.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help Float</code>.  When might floating point number not work in Vimscript?</p>
<p>Read <code>:help floating-point-precision</code>.  What might this mean if you're writing
a Vim plugin that deals with floating point numbers?</p></div>

        <div class="prevnext">
            
                <a class="prev" href="24.html">&laquo; Previous</a>
            
            
                <a class="next" href="26.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Strings / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="26.html#strings">Strings</a><ul>
<li><a href="26.html#concatenation">Concatenation</a></li>
<li><a href="26.html#special-characters">Special Characters</a></li>
<li><a href="26.html#literal-strings">Literal Strings</a></li>
<li><a href="26.html#truthiness">Truthiness</a></li>
<li><a href="26.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="25.html">&laquo; Prev</a>
            
            
                <a class="next" href="27.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="strings">Strings</h1>
<p>The next type of variable we'll look at is the String.  Since Vim is all about
manipulating text you'll be using this one quite a bit.</p>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom "Hello"</code></pre>


<p>Vim will echo <code>Hello</code>.  So far, so good.</p>
<h2 id="concatenation">Concatenation</h2>
<p>One of the most common things you'll want to do with strings is adding them
together.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echom "Hello, " + "world"</code></pre>


<p>What happened?  Vim displayed <code>0</code> for some reason!</p>
<p>Here's the issue: Vim's <code>+</code> operator is <em>only</em> for Numbers.  When you pass
a string to <code>+</code> Vim will try to coerce it to a Number before performing the
addition.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom "3 mice" + "2 cats"</code></pre>


<p>This time Vim displays <code>5</code>, because the strings are coerced to the numbers <code>3</code>
and <code>2</code> respectively.</p>
<p>When I said "Number" I really <em>meant</em> Number.  Vim will <em>not</em> coerce strings to
Floats!  Try this command to see proof of this:</p>
<pre class="codehilite"><code class="language-vim">:echom 10 + "10.10"</code></pre>


<p>Vim displays <code>20</code> because it dropped everything after the decimal point when
coercing <code>10.10</code> to a Number.</p>
<p>To combine strings you need to use the concatenation operator.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:echom "Hello, " . "world"</code></pre>


<p>This time Vim displays <code>Hello, world</code>.  <code>.</code> is the "concatenate strings"
operator in Vim, which lets you combine strings.  It doesn't add whitespace or
anything else in between.</p>
<p>Coercion works both ways.  Kind of.  Try this command:</p>
<pre class="codehilite"><code class="language-vim">:echom 10 . "foo"</code></pre>


<p>Vim will display <code>10foo</code>.  First it coerces <code>10</code> to a String, then it
concatenates it with the string on the right hand side.  Things get a bit
stickier when we're working with Floats, though.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echom 10.1 . "foo"</code></pre>


<p>This time Vim throws an error, saying we're using a Float as a String.  Vim will
happily let you use a String as a Float when performing addition, but <em>won't</em>
let you use a Float as a String when concatenating.</p>
<p>The moral of this story is that Vim is a lot like Javascript: it allows you to
play fast and loose with types sometimes, but it's a really bad idea to do so
because it will come back to bite you at some point.</p>
<p>When writing Vimscript, make sure you know what the type of each of your
variables is.  If you need to change that type you should use a function to
explicitly change it, even if it's not strictly necessary at the moment.  Don't
rely on Vim's coercion because at some point you <em>will</em> regret it.</p>
<h2 id="special-characters">Special Characters</h2>
<p>Like most programming languages, Vimscript lets you use escape sequences in
strings to represent hard-to-type characters.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom "foo \"bar\""</code></pre>


<p>The <code>\"</code> in the string is replaced with a double quote character, as you would
probably expect.  Escape sequences work mostly as you would expect.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:echom "foo\\bar"</code></pre>


<p>Vim displays <code>foo\bar</code>, because <code>\\</code> is the escape sequence for a literal
backslash, just like in most programming languages.  Now run the following
command (note that it's an <code>echo</code> and <em>not</em> an <code>echom</code>):</p>
<pre class="codehilite"><code class="language-vim">:echo "foo\nbar"</code></pre>


<p>This time Vim will display two lines, <code>foo</code> and <code>bar</code>, because the <code>\n</code> is
replaced with a newline.  Now try running this command:</p>
<pre class="codehilite"><code class="language-vim">:echom "foo\nbar"</code></pre>


<p>Vim will display something like <code>foo^@bar</code>.  When you use <code>echom</code> instead of
<code>echo</code> with a String Vim will echo the <em>exact</em> characters of the string, which
sometimes means that it will show a different representation than plain old
<code>echo</code>.  <code>^@</code> is Vim's way of saying "newline character".</p>
<h2 id="literal-strings">Literal Strings</h2>
<p>Vim also lets you use "literal strings" to avoid excessive use of escape
sequences.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom '\n\\'</code></pre>


<p>Vim displays <code>\n\\</code>.  Using single quotes tells Vim that you want the string
<em>exactly</em> as-is, with no escape sequences.  The one exception is that two single
quotes in a row will produce one single quote.  Try this command:</p>
<pre class="codehilite"><code class="language-vim">:echom 'That''s enough.'</code></pre>


<p>Vim will display <code>That's enough.</code>.  Two single quotes is the <em>only</em> sequence
that has special meaning in a literal string.</p>
<p>We'll revisit literal strings when they become most useful, later in the book
(when we dive into regular expressions).</p>
<h2 id="truthiness">Truthiness</h2>
<p>You might be wondering how Vim treats strings when used in an <code>if</code> statement.
Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:if "foo"
:  echo "yes"
:else
:  echo "no"
:endif</code></pre>


<p>Vim will display <code>no</code>.  If you're wondering why this happens you should reread
the chapter on conditionals, because we talked about it there.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help expr-quote</code>.  Review the list of escape sequences you can use in
a normal Vim string.  Find out how to insert a tab character.</p>
<p>Try to figure out a way to insert a tab character into a string <em>without</em> using
an escape sequence.  Read <code>:help i_CTRL-V</code> for a hint.</p>
<p>Read <code>:help literal-string</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="25.html">&laquo; Previous</a>
            
            
                <a class="next" href="27.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>String Functions / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="27.html#string-functions">String Functions</a><ul>
<li><a href="27.html#length">Length</a></li>
<li><a href="27.html#splitting">Splitting</a></li>
<li><a href="27.html#joining">Joining</a></li>
<li><a href="27.html#lower-and-upper-case">Lower and Upper Case</a></li>
<li><a href="27.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="26.html">&laquo; Prev</a>
            
            
                <a class="next" href="28.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="string-functions">String Functions</h1>
<p>Vim has many built-in functions to manipulate strings.  In this chapter we'll
look at a few of the most important ones.</p>
<h2 id="length">Length</h2>
<p>The first function we'll look at is <code>strlen</code>.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom strlen("foo")</code></pre>


<p>Vim displays <code>3</code>, which is the length of the string <code>"foo"</code>.  Now try the
following command:</p>
<pre class="codehilite"><code class="language-vim">:echom len("foo")</code></pre>


<p>Vim once again displays <code>3</code>.  When used with Strings <code>len</code> and <code>strlen</code> have
identical effects.  We'll come back to <code>len</code> later in the book.</p>
<h2 id="splitting">Splitting</h2>
<p>Run the following command (note that it's an <code>echo</code> and not an <code>echom</code>):</p>
<pre class="codehilite"><code class="language-vim">:echo split("one two three")</code></pre>


<p>Vim displays <code>['one', 'two', 'three']</code>.  The <code>split</code> function splits a String
into a List.  We'll talk about Lists shortly, but for now don't worry too much
about them.</p>
<p>You can also tell Vim to use a separator other than "whitespace" for splitting.
Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo split("one,two,three", ",")</code></pre>


<p>Vim will once again display <code>['one', 'two', 'three']</code>, because the second
argument to <code>split</code> tells it to split the string on the comma character instead
of on whitespace.</p>
<h2 id="joining">Joining</h2>
<p>Not only can you split strings, you can also join them.  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:echo join(["foo", "bar"], "...")</code></pre>


<p>Vim will display <code>foo...bar</code>.  Don't worry about the list syntax for now.</p>
<p><code>split</code> and <code>join</code> can be paired to great effect.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo join(split("foo bar"), ";")</code></pre>


<p>Vim displays <code>foo;bar</code>.  First we split the string <code>"foo bar"</code> into a list, then
we joined that list together using a semicolon as the separator.</p>
<h2 id="lower-and-upper-case">Lower and Upper Case</h2>
<p>Vim has two functions to change the case of Strings.  Run the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:echom tolower("Foo")
:echom toupper("Foo")</code></pre>


<p>Vim displays <code>foo</code> and <code>FOO</code>.  This should be pretty easy to understand.</p>
<p>In many languages (like Python) a common idiom is to force strings to lowercase
before comparing them to perform a case-insensitive comparison.  In Vimscript
this isn't necessary because we have the case-insensitive comparison operators.
Reread the chapter on comparisons if you don't remember those.</p>
<p>It's up to you to decide whether to use <code>tolower</code> and <code>==#</code>, or just <code>==?</code> to
perform case-sensitive comparisons.  There doesn't seem to be any strong
preference in the Vimscript community.  Pick one and stick to it for all of your
scripts.</p>
<h2 id="exercises">Exercises</h2>
<p>Run <code>:echo split('1   2')</code> and <code>:echo split('1,,,2', ',')</code>.  Do they behave the
same?</p>
<p>Read <code>:help split()</code>.</p>
<p>Read <code>:help join()</code>.</p>
<p>Read <code>:help functions</code> and skim the list of built-in functions for ones that
mention the word "String".  Use the <code>/</code> command to make it easier (remember,
Vim's help files can be navigated like any other kind of file).  There are
a <em>lot</em> of functions here, so don't feel like you need to read the documentation
for every single one.  Just try to get an idea of what's available if you need
it in the future.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="26.html">&laquo; Previous</a>
            
            
                <a class="next" href="28.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Execute / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="28.html#execute">Execute</a><ul>
<li><a href="28.html#basic-execution">Basic Execution</a></li>
<li><a href="28.html#is-execute-dangerous">Is Execute Dangerous?</a></li>
<li><a href="28.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="27.html">&laquo; Prev</a>
            
            
                <a class="next" href="29.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="execute">Execute</h1>
<p>The <code>execute</code> command is used to evaluate a string as if it were a Vimscript
command.  We saw it in an earlier chapter, but now that we know a bit more about
Vimscript Strings we're going to take another look.</p>
<h2 id="basic-execution">Basic Execution</h2>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "echom 'Hello, world!'"</code></pre>


<p>Vim evaluates <code>echom 'Hello, world!'</code> as a command and dutifully echoes it to
the screen and message log.  Execute is a very powerful tool because it lets you
build commands out of arbitrary strings.</p>
<p>Let's try a more useful example.  Prepare by opening a file in Vim, then using
<code>:edit foo.txt</code> in the same window to open a new buffer.  Now run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "rightbelow vsplit " . bufname("#")</code></pre>


<p>Vim will open the first file in a vertical split to the right of the second
file.  What happened here?</p>
<p>First, Vim builds the command string by concatenating <code>"rightbelow vsplit "</code>
with the result of the <code>bufname("#")</code> call.</p>
<p>We'll look at the function more later, but for now just trust that it returns
the path of the previous buffer.  You can play with it using <code>echom</code> if you want
to see for yourself.</p>
<p>Once <code>bufname</code> is evaluated Vim builds the string <code>"rightbelow vsplit
bar.txt"</code>.  The <code>execute</code> command evaluates this as a Vimscript command which
opens the split with the file.</p>
<h2 id="is-execute-dangerous">Is Execute Dangerous?</h2>
<p>In most programming languages the use of such an "eval" construct to evaluate
strings as program code is frowned upon (to put it lightly).  Vimscript's
<code>execute</code> command doesn't have the same stigma for two reasons.</p>
<p>First, most Vimscript code only ever takes input from a single person: the user.
If the user wants to input a tricky string that will cause an <code>execute</code> command
to do something bad, well, it's their computer!  Contrast this with other
languages, where programs constantly take input from untrusted users.  Vim is
a unique environment where the normal security concerns simply aren't common.</p>
<p>The second reason is that because Vimscript has sometimes arcane and tricky
syntax, <code>execute</code> is often the easiest, most straightforward way to get
something done.  In most other languages using an "eval" construct won't usually
save you much typing, but in Vimscript it can collapse many lines into a single
one.</p>
<h2 id="exercises">Exercises</h2>
<p>Skim <code>:help execute</code> to get an idea of some of the things you can and can't use
<code>execute</code> for.  Don't dive too deeply yet -- we're going to revisit it very
soon.</p>
<p>Read <code>:help leftabove</code>, <code>:help rightbelow</code>, <code>:help :split</code>, and <code>:help :vsplit</code>
(notice the extra colon in the last two topics).</p>
<p>Add a mapping to your <code>~/.vimrc</code> file that opens the previous buffer in a split
of your choosing (vertical/horizontal, above/below/left/right).</p></div>

        <div class="prevnext">
            
                <a class="prev" href="27.html">&laquo; Previous</a>
            
            
                <a class="next" href="29.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Normal / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="29.html#normal">Normal</a><ul>
<li><a href="29.html#avoiding-mappings">Avoiding Mappings</a></li>
<li><a href="29.html#special-characters">Special Characters</a></li>
<li><a href="29.html#exercises">Exercises</a></li>
<li><a href="29.html#extra-credit">Extra Credit</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="28.html">&laquo; Prev</a>
            
            
                <a class="next" href="30.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="normal">Normal</h1>
<p>So far we've covered some of the most useful Vimscript commands, but what about
all the stuff you do on a daily basis in normal mode?  Can we somehow use all
the knowledge we have from editing text in our scripting?</p>
<p>The answer is: "of course".  We've seen the <code>normal</code> command before, and now
it's time to revisit it in a bit more detail.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:normal G</code></pre>


<p>Vim will move your cursor to the last line in the current file, just like
pressing <code>G</code> in normal mode would.  Now run the following command:</p>
<pre class="codehilite"><code class="language-vim">:normal ggdd</code></pre>


<p>Vim will move to the first line in the file (<code>gg</code>) and then delete it (<code>dd</code>).</p>
<p>The <code>normal</code> command simply takes a sequence of keys and pretends they were
typed in normal mode.  Seems simple enough.</p>
<h2 id="avoiding-mappings">Avoiding Mappings</h2>
<p>Run the following command to map the <code>G</code> key to something else:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap G dd</code></pre>


<p>Now pressing <code>G</code> in normal mode will delete a line.  Try this command:</p>
<pre class="codehilite"><code class="language-vim">:normal G</code></pre>


<p>Vim will delete the current line.  The <code>normal</code> command will take into account
any mappings that exist.</p>
<p>This means that we need something like the <code>nnoremap</code> version of <code>nmap</code> for
<code>normal</code>, otherwise we'll never be able to use it since we can't know what keys
our users have mapped.</p>
<p>Luckily Vim has a <code>normal!</code> command that does exactly this.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:normal! G</code></pre>


<p>This time Vim moves to the bottom of the file even though <code>G</code> has been mapped.</p>
<p>When writing Vim scripts you should <strong>always</strong> use <code>normal!</code>, and <strong>never</strong> use
plain old <code>normal</code>.  You can't trust what keys your users will have mapped in
their <code>~/.vimrc</code> files.</p>
<h2 id="special-characters">Special Characters</h2>
<p>If you play around with <code>normal!</code> long enough you'll probably notice a problem.
Try the following command:</p>
<pre class="codehilite"><code class="language-vim">:normal! /foo&lt;cr&gt;</code></pre>


<p>At first glance it may seem like this should perform a search for <code>foo</code>, but
you'll see that it doesn't work.  The problem is that <code>normal!</code> doesn't parse
special character sequences like <code>&lt;cr&gt;</code>.</p>
<p>In this case Vim thinks you wanted to search for the character sequence "f, o,
o, left angle bracket, c, r, right angle bracket", and doesn't realize that you
even pressed return to perform the search!  We'll talk about how to get around
this in the next chapter.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help normal</code>.  The end of it will hint at the topic of the next chapter.</p>
<h2 id="extra-credit">Extra Credit</h2>
<p>If you're not feeling up for a challenge, skip this section.  If you are, good
luck!</p>
<p>Recall what <code>:help normal</code> said about undo.  Try to make a mapping that will
delete two lines but let you undo each deletion separately.  <code>nnoremap &lt;leader&gt;d
dddd</code> is a good place to start.</p>
<p>You won't actually need <code>normal!</code> for this (<code>nnoremap</code> will suffice), but it
illustrates a good point: sometimes reading about one Vim command can spark an
interest in something unrelated.</p>
<p>If you've never used the <code>helpgrep</code> command you'll probably need it now.  Read
<code>:help helpgrep</code>.  Pay attention to the parts about how to navigate between the
matches.</p>
<p>Don't worry about patterns yet, we're going to cover them soon.  For now it's
enough to know that you can use something like <code>foo.*bar</code> to find lines
containing that regex in the documentation.</p>
<p>Unfortunately <code>helpgrep</code> can be frustrating at times because you need to know
what words to search for before you can find them!  I'll cut you some slack and
tell you that in this case you're looking for a way to break Vim's undo sequence
manually, so that the two deletes in your mapping can be undone separately.</p>
<p>In the future, be pragmatic.  Sometimes Google is quicker and easier when you
don't know exactly what you're after.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="28.html">&laquo; Previous</a>
            
            
                <a class="next" href="30.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Execute Normal! / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="30.html#execute-normal">Execute Normal!</a><ul>
<li><a href="30.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="29.html">&laquo; Prev</a>
            
            
                <a class="next" href="31.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="execute-normal">Execute Normal!</h1>
<p>Now that we've seen <code>execute</code> and <code>normal!</code> we can talk about a common Vimscript
idiom in more detail.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! gg/foo\&lt;cr&gt;dd"</code></pre>


<p>This will move to the top of the file, search for the first occurrence of <code>foo</code>,
and delete the line that contains it.</p>
<p>Previously we tried to use <code>normal!</code> with a search command but couldn't enter
the return needed to actually perform the search.  Combining <code>normal!</code> with
<code>execute</code> fixes that problem.</p>
<p><code>execute</code> lets you build commands programmatically, so you can use Vim's normal
string escape sequences to generate the non-printing characters you need.  Try
the following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! mqA;\&lt;esc&gt;`q"</code></pre>


<p>What does this do?  Let's break it apart:</p>
<ul>
<li><code>:execute "normal! ..."</code>: run the sequence of commands as if they were entered
  in normal mode, ignoring all mappings, and replacing string escape sequences
  with their results.</li>
<li><code>mq</code>: store the current location in mark "q".</li>
<li><code>A</code>: move to the end of the current line and enter insert mode after the last
  character.</li>
<li><code>;</code>: we're now in insert mode, so just put a literal semicolon in the file.</li>
<li><code>\&lt;esc&gt;</code>: this is a string escape sequence which resolves to a press of the
  escape key, which takes us out of insert mode.</li>
<li><code>`q</code>: return to the exact location of mark "q".</li>
</ul>
<p>It looks a bit scary but it's actually quite useful: it puts a semicolon at the
end of the current line while leaving your cursor in place.  A mapping for this
could come in handy if you forget a semicolon when writing Javascript, C, or any
other language with semicolons as statement terminators.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help expr-quote</code> again (you've seen it before) to remind yourself how to
use string escapes to pass special characters to <code>normal!</code> with <code>execute</code>.</p>
<p>Put down this book for a while before you go on to the next chapter.  Get
a sandwich or a cup of coffee, feed your pets if you have them, and relax for
a bit before continuing.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="29.html">&laquo; Previous</a>
            
            
                <a class="next" href="31.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Basic Regular Expressions / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="31.html#basic-regular-expressions">Basic Regular Expressions</a><ul>
<li><a href="31.html#highlighting">Highlighting</a></li>
<li><a href="31.html#searching">Searching</a></li>
<li><a href="31.html#magic">Magic</a></li>
<li><a href="31.html#literal-strings">Literal Strings</a></li>
<li><a href="31.html#very-magic">Very Magic</a></li>
<li><a href="31.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="30.html">&laquo; Prev</a>
            
            
                <a class="next" href="32.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="basic-regular-expressions">Basic Regular Expressions</h1>
<p>Vim is a text editor, which means that a great deal of your Vimscript code will
be dedicated to working with text.  Vim has powerful support for regular
expressions, but as usual there are some quirks.</p>
<p>Type the following text into a buffer:</p>
<pre class="codehilite"><code class="language-text">max = 10

print "Starting"

for i in range(max):
    print "Counter:", i

print "Done"</code></pre>


<p>This is the text we'll use to experiment with Vimscript's regex support.  It
happens to be Python code, but don't worry if you don't know Python.  It's just
an example.</p>
<p>I'm going to assume that you know the basics of regular expressions.  If you
don't you should stop reading this book and start reading <a href="http://regex.learncodethehardway.org/">Learn Regex the Hard
Way</a> by Zed Shaw.  Come back when you're done with that.</p>
<h2 id="highlighting">Highlighting</h2>
<p>Before we start we need to turn on search highlighting so we can see what we're
doing.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:set hlsearch incsearch</code></pre>


<p><code>hlsearch</code> tells Vim to highlight all matches in a file when you perform
a search, and <code>incsearch</code> tells Vim to highlight the <em>next</em> match while you're
still typing out your search pattern.</p>
<h2 id="searching">Searching</h2>
<p>Put your cursor at the top of the file and run the following command:</p>
<pre class="codehilite"><code class="language-vim">/print</code></pre>


<p>As you type in each letter, Vim will start highlighting them in the first line.
When you press return to execute the search <em>all</em> the instances of <code>print</code> will
be highlighted and your cursor will be moved to the next match.</p>
<p>Now try running the following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! gg/print\&lt;cr&gt;"</code></pre>


<p>This will go to the top of the file and perform a search for <code>print</code>, putting us
at the first match.  It does this using <code>:execute "normal! ..."</code> which we saw in
the previous chapter.</p>
<p>To get to the second match in the file you can just add more commands onto the
end of the string.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! gg/print\&lt;cr&gt;n"</code></pre>


<p>Vim will put the cursor on the second <code>print</code> in the buffer (and all the matches
will be highlighted).</p>
<p>Let's try going in the opposite direction.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! G?print\&lt;cr&gt;"</code></pre>


<p>This time we move to the bottom of the file with <code>G</code> and use <code>?</code> to search
backward instead of forward.</p>
<p>All of these searching commands should be familiar -- we're mostly going over
them to get you used to the <code>:execute "normal! ..."</code> idiom, because it will let
you do anything you know how to do in vanilla Vim in your Vimscript code.</p>
<h2 id="magic">Magic</h2>
<p>The <code>/</code> and <code>?</code> commands actually take regular expressions, not just literal
characters.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! gg/for .+ in .+:\&lt;cr&gt;"</code></pre>


<p>Vim complains that the pattern is not found!  I told you that Vim supports
regular expressions in searches, so what's going on?  Try the following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! gg/for .\\+ in .\\+:\&lt;cr&gt;"</code></pre>


<p>This time Vim highlights the "for" loop as we expected in the first place.  Take
a minute and try to think about what exactly changed before moving on.  Remember
that <code>execute</code> takes a String.</p>
<p>The answer is that there are two reasons we needed to write the command like we
did:</p>
<ul>
<li>First, <code>execute</code> takes a String, so the double backslashes we used turn into
  single backslashes by the time they get to <code>normal!</code>.</li>
<li>Vim has <em>four</em> different "modes" of parsing regular expressions!  The default
  mode requires a backslash before the <code>+</code> character to make it mean "1 or more
  of the preceding character" instead of "a literal plus sign".</li>
</ul>
<p>You can see this a bit easier by just running the search in Vim directly.  Type
the following command and press return:</p>
<pre class="codehilite"><code class="language-vim">/print .\+</code></pre>


<p>You can see the <code>\+</code> working its magic now.  The double backslashes were only
used because we were passing the pattern as a String to <code>execute</code>.</p>
<h2 id="literal-strings">Literal Strings</h2>
<p>As we mentioned in the chapter on Strings, Vim allows you to use single quotes
to define a "literal string" that passes through characters directly.  For
example, the string <code>'a\nb'</code> is four characters long.</p>
<p>Can we use literal strings to avoid having to type those double backslashes?
Think about this for a minute or two before you move on, because the answer is
a bit more complicated that you might think.</p>
<p>Try running the following command (note the single quotes and single backslashes
this time):</p>
<pre class="codehilite"><code class="language-vim">:execute 'normal! gg/for .\+ in .\+:\&lt;cr&gt;'</code></pre>


<p>Vim moves you to the top of the file but doesn't move you to the first match.
Is this what you expected?</p>
<p>The command doesn't work because we need the <code>\&lt;cr&gt;</code> in the pattern to be
escaped into a real carriage return character, which tells the search command to
actually run.  Because we're in a literal string, it's the equivalent of typing
<code>/for .\+ in .\+:\&lt;cr&gt;</code> in vanilla Vim, which obviously isn't what we want.</p>
<p>All hope is not lost, though!  Remember that Vim allows you to concatenate
strings, so for larger commands we can use this to split apart the string into
easier to read chunks.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! gg" . '/for .\+ in .\+:' . "\&lt;cr&gt;"</code></pre>


<p>This concatenates the three smaller strings before sending them to <code>execute</code>,
and lets us use a literal string for the regex while using normal strings for
everything else.</p>
<h2 id="very-magic">Very Magic</h2>
<p>You may be wondering about Vimscript's four different modes of regex parsing and
how they're different from the regular expressions you're used to from languages
like Python, Perl or Ruby.  You can read their documentation if you really want
to, but if you want the sane, easy solution just read on.</p>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:execute "normal! gg" . '/\vfor .+ in .+:' . "\&lt;cr&gt;"</code></pre>


<p>We've split the pattern out from the rest of the command into its own literal
string again, and this time we started the pattern with <code>\v</code>.  This tells Vim to
use its "very magic" regex parsing mode, which is pretty much the same as you're
used to in any other programming language.</p>
<p>If you simply start all of your regular expressions with <code>\v</code> you'll never need
to worry about Vimscript's three other crazy regex modes.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help magic</code> carefully.</p>
<p>Read <code>:help pattern-overview</code> to see the kinds of things Vim regexes support.
Stop reading after the character classes.</p>
<p>Read <code>:help :match</code>.  Try running the <code>:match Error /\v.../</code> command a few times
by hand.</p>
<p>Edit your <code>~/.vimrc</code> file to add a mapping that will use <code>match</code> to highlight
trailing whitespace as an error.  A good key to use might be <code>&lt;leader&gt;w</code>.</p>
<p>Add another mapping that will clear the match (perhaps <code>&lt;leader&gt;W</code>).</p>
<p>Add a normal mode mapping that will automatically insert the <code>\v</code> for you
whenever you begin a search.  If you're stuck remember that Vim's mappings are
extremely simple and you just need to tell it which keys to press when you use
the mapped key.</p>
<p>Add the <code>hlsearch</code> and <code>incsearch</code> options to your <code>~/.vimrc</code> file, set however
you prefer.</p>
<p>Read <code>:help nohlsearch</code>.  Note that this is a <em>command</em> and <em>not</em> the "off mode"
setting of <code>hlsearch</code>!</p>
<p>Add a mapping to "stop highlighting items from the last search" to your
<code>~/.vimrc</code> file.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="30.html">&laquo; Previous</a>
            
            
                <a class="next" href="32.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Case Study: Grep Operator, Part One / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="32.html#case-study-grep-operator-part-one">Case Study: Grep Operator, Part One</a><ul>
<li><a href="32.html#grep">Grep</a></li>
<li><a href="32.html#usage">Usage</a></li>
<li><a href="32.html#a-preliminary-sketch">A Preliminary Sketch</a></li>
<li><a href="32.html#the-search-term">The Search Term</a></li>
<li><a href="32.html#escaping-shell-command-arguments">Escaping Shell Command Arguments</a></li>
<li><a href="32.html#cleanup">Cleanup</a></li>
<li><a href="32.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="31.html">&laquo; Prev</a>
            
            
                <a class="next" href="33.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="case-study-grep-operator-part-one">Case Study: Grep Operator, Part One</h1>
<p>In this chapter and the next we're going to walk through creating
a fairly complicated piece of Vimscript.  We'll talk about several things we
haven't seen before, as well as how some of the things we've studied fit
together in practice.</p>
<p>As you work through this case study make sure to look up anything unfamiliar
with <code>:help</code>.  If you coast through without fully understanding everything, you
won't learn much.</p>
<h2 id="grep">Grep</h2>
<p>If you've never used <code>:grep</code> you should take a minute to read <code>:help :grep</code> and
<code>:help :make</code> now.  Read <code>:help quickfix-window</code> if you've never used the
quickfix window before.</p>
<p>In a nutshell: <code>:grep ...</code> will run an external grep program with any arguments
you give, parse the result, and fill the quickfix list so you can jump to
results inside Vim.</p>
<p>Our example is going to make <code>:grep</code> easier to invoke by adding a "grep
operator" you can use with any of Vim's built-in (or custom!) motions to select
the text you want to search for.</p>
<h2 id="usage">Usage</h2>
<p>The first thing you should think about when creating any non-trivial piece of
Vimscript is: "how will this functionality be used?".  Try to come up with
a smooth, easy, intuitive way to invoke it.</p>
<p>In this case I'll do that step for you:</p>
<ul>
<li>We're going to create a "grep operator" and bind it to <code>&lt;leader&gt;g</code>. </li>
<li>It will act like any other Vim operator and take a motion (like <code>w</code> or <code>i{</code>). </li>
<li>It will perform the search immediately and open the quickfix window to show
  the results.</li>
<li>It will <em>not</em> jump to the first result, because that can be jarring if the
  first result isn't what you're expecting.</li>
</ul>
<p>Some examples of how you might end up using it:</p>
<ul>
<li><code>&lt;leader&gt;giw</code>: Grep for the word under the cursor.</li>
<li><code>&lt;leader&gt;giW</code>: Grep for the WORD under the cursor.</li>
<li><code>&lt;leader&gt;gi'</code>: Grep for the contents of the single-quoted string you're
  currently in.</li>
<li><code>viwe&lt;leader&gt;g</code>: Visually select a word, extend the selection to the end of
  the word after it, then grep for the selected text.</li>
</ul>
<p>There are many, <em>many</em> other ways to use this.  It may seem like it will take
a lot of coding, but actually all we need to do is implement the "operator"
functionality and Vim will handle the rest.</p>
<h2 id="a-preliminary-sketch">A Preliminary Sketch</h2>
<p>One thing that's sometimes helpful when writing tricky bits of Vimscript is to
simplify your goal and implement <em>that</em> to get an idea of the "shape" your final
solution will take.</p>
<p>Let's simplify our goal to: "create a mapping to search for the word under the
cursor".  This is useful but should be easier, so we can get something running
much faster.  We'll map this to <code>&lt;leader&gt;g</code> for now.</p>
<p>We'll start with a skeleton of the mapping and fill it in as we go.  Run this
command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :grep -R something .&lt;cr&gt;</code></pre>


<p>If you've read <code>:help grep</code> this should be pretty easy to understand.  We've
looked at lots of mappings before, and there's nothing new here.</p>
<p>Obviously we're not done yet, so let's refine this mapping until it meets our
simplified goal.</p>
<h2 id="the-search-term">The Search Term</h2>
<p>First we need to search for the word under the cursor, not the string
<code>something</code>.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :grep -R &lt;cword&gt; .&lt;cr&gt;</code></pre>


<p>Now try it out.  <code>&lt;cword&gt;</code> is a special bit of text you can use in Vim's
command-line mode, and Vim will replace it with "the word under the cursor"
before running the command.</p>
<p>You can use <code>&lt;cWORD&gt;</code> to get a WORD instead of a word.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :grep -R &lt;cWORD&gt; .&lt;cr&gt;</code></pre>


<p>Now try the mapping when your cursor is over something like <code>foo-bar</code>.  Vim will
grep for <code>foo-bar</code> instead of just part of the word.</p>
<p>There's still a problem with our search term: if there are any special shell
characters in it Vim will happily pass them along to the external grep command,
which will explode (or worse: do something terrible).</p>
<p>Go ahead and try this to make sure it breaks.  Type <code>foo;ls</code> into a file and run
the mapping while your cursor is over it.  The grep command will fail, and Vim
will actually run an <code>ls</code> command as well!  Clearly this could be bad if the
word contained a command more dangerous than <code>ls</code>.</p>
<p>To try to fix this we'll quote the argument in the grep call.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :grep -R '&lt;cWORD&gt;' .&lt;cr&gt;</code></pre>


<p>Most shells treat single-quoted text as (almost) literal, so our mapping is much
more robust now.</p>
<h2 id="escaping-shell-command-arguments">Escaping Shell Command Arguments</h2>
<p>There's still one more problem with the search term.  Try the mapping on the
word <code>that's</code>.  It won't work, because the single quote inside the word
interferes with the quotes in the grep command!</p>
<p>To get around this we can use Vim's <code>shellescape</code> function.  Read <code>:help
escape()</code> and <code>:help shellescape()</code> to see how it works (it's pretty simple).</p>
<p>Because <code>shellescape()</code> works on Vim strings, we'll need to dynamically build
the command with <code>execute</code>.  First run the following command to transform the
<code>:grep</code> mapping into <code>:execute "..."</code> form:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :execute "grep -R '&lt;cWORD&gt;' ."&lt;cr&gt;</code></pre>


<p>Try it out and make sure it still works.  If not, find any typos and fix them.
Then run the following command, which uses <code>shellescape</code> to fix the search term:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :execute "grep -R " . shellescape("&lt;cWORD&gt;") . " ."&lt;cr&gt;</code></pre>


<p>Try it out by running it on a normal word like <code>foo</code>.  It will work properly.
Now try it out on a word with a quote in it, like <code>that's</code>.  It still doesn't
work!  What happened?</p>
<p>The problem is that Vim performed the <code>shellescape()</code> call <em>before</em> it expanded
out special strings like <code>&lt;cWORD&gt;</code> in the command line.  So Vim shell-escaped
the literal string <code>"&lt;cWORD&gt;"</code> (which did nothing but add single quotes to it)
and then concatenated it with the strings of our <code>grep</code> command.</p>
<p>You can see this by running the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom shellescape("&lt;cWORD&gt;")</code></pre>


<p>Vim will output <code>'&lt;cWORD&gt;'</code>.  Note that those quotes are actually part of the
string.  Vim has prepared it for use as a shell command argument.</p>
<p>To fix this we'll use the <code>expand()</code> function to force the expansion of
<code>&lt;cWORD&gt;</code> into the actual string <em>before</em> it gets passed to <code>shellescape</code>.</p>
<p>Let's break this apart and see how it works, in steps.  Put your cursor over
a word with a quote, like <code>that's</code>, and run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom expand("&lt;cWORD&gt;")</code></pre>


<p>Vim outputs <code>that's</code> because <code>expand("&lt;cWORD&gt;")</code> will return the current word
under the cursor as a Vim string.  Now let's add <code>shellescape</code> back in:</p>
<pre class="codehilite"><code class="language-vim">:echom shellescape(expand("&lt;cWORD&gt;"))</code></pre>


<p>This time Vim outputs <code>'that'\''s'</code>.  If this looks a little funny, you probably
haven't had the pleasure of wrapping your brain around shell-quoting in all its
insane glory.  For now, don't worry about it.  Just trust the Vim has taken the
string from <code>expand</code> and escaped it properly.</p>
<p>Now that we know how to get a fully-escaped version of the word under the
cursor, it's time to concatenate it into our mapping!  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :exe "grep -R " . shellescape(expand("&lt;cWORD&gt;")) . " ."&lt;cr&gt;</code></pre>


<p>Try it out.  This mapping won't break if the word we're searching for happens to
contain strange characters.</p>
<p>The process of starting with a trivial bit of Vimscript and transforming it
little-by-little into something closer to your goal is one you'll find yourself
using often.</p>
<h2 id="cleanup">Cleanup</h2>
<p>There are still a couple of small things to take care of before our mapping is
finished.  First, we said that we don't want to go to the first result
automatically, and we can use <code>grep!</code> instead of plain <code>grep</code> to do that.  Run
this command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :execute "grep! -R " . shellescape(expand("&lt;cWORD&gt;")) . " ."&lt;cr&gt;</code></pre>


<p>Try it out again and nothing will seem to happen.  Vim has filled the quickfix
window with the results, but we haven't opened it yet.  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :execute "grep! -R " . shellescape(expand("&lt;cWORD&gt;")) . " ."&lt;cr&gt;:copen&lt;cr&gt;</code></pre>


<p>Now try the mapping and you'll see that Vim automatically opens the quickfix
window with the search results.  All we did was tack <code>:copen&lt;cr&gt;</code> onto the end
of our mapping.</p>
<p>As the finishing touch we'll remove all the grep output Vim displays while
searching.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;g :silent execute "grep! -R " . shellescape(expand("&lt;cWORD&gt;")) . " ."&lt;cr&gt;:copen&lt;cr&gt;</code></pre>


<p>We're done, so try it out and admire your hard work!  The <code>silent</code> command just
runs the command that follows it while hiding any messages it would normally
display.</p>
<h2 id="exercises">Exercises</h2>
<p>Add the mapping we just created to your <code>~/.vimrc</code> file.</p>
<p>Read <code>:help :grep</code> if you didn't read it before.</p>
<p>Read <code>:help cword</code>.</p>
<p>Read <code>:help cnext</code> and <code>:help cprevious</code>.  Try them out after using your new
grep mapping.</p>
<p>Set up mappings for <code>:cnext</code> and <code>:cprevious</code> to make it easier to quickly run
through matches.</p>
<p>Read <code>:help expand</code>.</p>
<p>Read <code>:help copen</code>.</p>
<p>Add a height to the <code>:copen</code> command in the mapping we created to make sure the
quickfix window is opened to whatever height you prefer.</p>
<p>Read <code>:help silent</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="31.html">&laquo; Previous</a>
            
            
                <a class="next" href="33.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Case Study: Grep Operator, Part Two / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="33.html#case-study-grep-operator-part-two">Case Study: Grep Operator, Part Two</a><ul>
<li><a href="33.html#create-a-file">Create a File</a></li>
<li><a href="33.html#skeleton">Skeleton</a></li>
<li><a href="33.html#visual-mode">Visual Mode</a></li>
<li><a href="33.html#motion-types">Motion Types</a></li>
<li><a href="33.html#copying-the-text">Copying the Text</a></li>
<li><a href="33.html#escaping-the-search-term">Escaping the Search Term</a></li>
<li><a href="33.html#running-grep">Running Grep</a></li>
<li><a href="33.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="32.html">&laquo; Prev</a>
            
            
                <a class="next" href="34.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="case-study-grep-operator-part-two">Case Study: Grep Operator, Part Two</h1>
<p>Now that we've got a preliminary sketch of our solution, it's time to flesh it
out into something powerful.</p>
<p>Remember: our original goal was to create a "grep operator".  There are a whole
bunch of new things we need to cover to do this, but we're going to follow the
same process we did in the last chapter: start with something simple and
transform it until it does what you need.</p>
<p>Before we start, comment out the mapping we creating the previous chapter from
your <code>~/.vimrc</code> file -- we're going to use the same keystroke for our new
operator.</p>
<h2 id="create-a-file">Create a File</h2>
<p>Creating an operator will take a number of commands and typing those out by
hand will get tedious very quickly.  You could add it to your <code>~/.vimrc</code> file,
but let's create a separate file just for this operator instead.  It's meaty
enough to warrant a file of its own.</p>
<p>First, find your Vim <code>plugin</code> directory.  On Linux or OS X this will be at
<code>~/.vim/plugin</code>.  If you're on Windows it will be inside the <code>vimfiles</code>
directory in your home directory. (Use the command: <code>:echo $HOME</code> in Vim if
you're not sure where this is). If this directory doesn't exist, create it.</p>
<p>Inside <code>plugin/</code> create a file named <code>grep-operator.vim</code>.  This is where you'll
place the code for this new operator.  When you're editing the file you can run
<code>:source %</code> to reload the code at any time.  This file will also be loaded each
time you open Vim just like <code>~/.vimrc</code>.</p>
<p>Remember that you <em>must</em> write the file before you source it for the changes to
be seen!</p>
<h2 id="skeleton">Skeleton</h2>
<p>To create a new Vim operator you'll start with two components: a function and
a mapping.  Start by adding the following code to <code>grep-operator.vim</code>:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;g :set operatorfunc=GrepOperator&lt;cr&gt;g@

function! GrepOperator(type)
    echom "Test"
endfunction</code></pre>


<p>Write the file and source it with <code>:source %</code>.  Try it out by pressing
<code>&lt;leader&gt;giw</code> to say "grep inside word".  Vim will echo <code>Test</code> <em>after</em> accepting
the <code>iw</code> motion, which means we've laid out the skeleton.</p>
<p>The function is simple and nothing we haven't seen before, but that mapping is
a bit more complicated.  First we set the <code>operatorfunc</code> option to our function,
and then we run <code>g@</code> which calls this function as an operator.  This may seem
a bit convoluted, but it's how Vim works.</p>
<p>For now it's okay to consider this mapping to be black magic.  You can delve
into the detailed documentation later.</p>
<h2 id="visual-mode">Visual Mode</h2>
<p>We've added the operator to normal mode, but we'll want to be able to use it
from visual mode as well.  Add another mapping below the first:</p>
<pre class="codehilite"><code class="language-vim">vnoremap &lt;leader&gt;g :&lt;c-u&gt;call GrepOperator(visualmode())&lt;cr&gt;</code></pre>


<p>Write and source the file.  Now visually select something and press <code>&lt;leader&gt;g</code>.
Nothing happens, but Vim does echo <code>Test</code>, so our function is getting called.</p>
<p>We've seen the <code>&lt;c-u&gt;</code> in this mapping before but never explained what it did.
Try visually selecting some text and pressing <code>:</code>.  Vim will open a command line
as it usually does when <code>:</code> is pressed, but it automatically fills in <code>'&lt;,'&gt;</code> at
the beginning of the line!</p>
<p>Vim is trying to be helpful and inserts this text to make the command you're
about to run function on the visually selected range.  In this case, however, we
don't want the help.  We use <code>&lt;c-u&gt;</code> to say "delete from the cursor to the
beginning of the line", removing the text.  This leaves us with a bare <code>:</code>,
ready for the <code>call</code> command.</p>
<p>The <code>call GrepOperator()</code> is simply a function call like we've seen before, but
the <code>visualmode()</code> we're passing as an argument is new.  This function is
a built-in Vim function that returns a one-character string representing the
last type of visual mode used: <code>"v"</code> for characterwise, <code>"V"</code> for
linewise, and a <code>Ctrl-v</code> character for blockwise.</p>
<h2 id="motion-types">Motion Types</h2>
<p>The function we defined takes a <code>type</code> argument.  We know that when we use the
operator from visual mode it will be the result of <code>visualmode()</code>, but what
about when we run it as an operator from normal mode?</p>
<p>Edit the function body so the file looks like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;g :set operatorfunc=GrepOperator&lt;cr&gt;g@
vnoremap &lt;leader&gt;g :&lt;c-u&gt;call GrepOperator(visualmode())&lt;cr&gt;

function! GrepOperator(type)
    echom a:type
endfunction</code></pre>


<p>Source the file, then go ahead and try it out in a variety of ways.  Some
examples of the output you get are:</p>
<ul>
<li>Pressing <code>viw&lt;leader&gt;g</code> echoes <code>v</code> because we were in characterwise visual
  mode.</li>
<li>Pressing <code>Vjj&lt;leader&gt;g</code> echoes <code>V</code> because we were in linewise visual mode.</li>
<li>Pressing <code>&lt;leader&gt;giw</code> echoes <code>char</code> because we used a characterwise motion
  with the operator.</li>
<li>Pressing <code>&lt;leader&gt;gG</code> echoes <code>line</code> because we used a linewise motion with the
  operator.</li>
</ul>
<p>Now we know how we can tell the difference between motion types, which will be
important when we select the text to search for.</p>
<h2 id="copying-the-text">Copying the Text</h2>
<p>Our function is going to need to somehow get access to the text the user wants
to search for, and the easiest way to do that is to simply copy it.  Edit the
function to look like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;g :set operatorfunc=GrepOperator&lt;cr&gt;g@
vnoremap &lt;leader&gt;g :&lt;c-u&gt;call GrepOperator(visualmode())&lt;cr&gt;

function! GrepOperator(type)
    if a:type ==# 'v'
        execute "normal! `&lt;v`&gt;y"
    elseif a:type ==# 'char'
        execute "normal! `[v`]y"
    else
        return
    endif

    echom @@
endfunction</code></pre>


<p>Wow.  That's a lot of new stuff.  Try it out by pressing things like
<code>&lt;leader&gt;giw</code>, <code>&lt;leader&gt;g2e</code> and <code>vi(&lt;leader&gt;g</code>.  Each time Vim will echo the
text that the motion covers, so clearly we're making progress!</p>
<p>Let's break this new code down one step at a time.  First we have an <code>if</code>
statement that checks the <code>a:type</code> argument.  If the type is <code>'v'</code> it was called
from characterwise visual mode, so we do something to copy the visually-selected
text.</p>
<p>Notice that we use the case-sensitive comparison <code>==#</code>.  If we used plain <code>==</code>
and the user has <code>ignorecase</code> set it would match <code>"V"</code> as well, which is <em>not</em>
what we want.  Code defensively!</p>
<p>The second case of the <code>if</code> fires if the operator was called from normal mode
using a characterwise motion.</p>
<p>The final case simply returns.  We explicitly ignore the cases of
linewise/blockwise visual mode and linewise/blockwise motions.  Grep doesn't
search across lines by default, so having a newline in the search pattern
doesn't make any sense!</p>
<p>Each of our two <code>if</code> cases runs a <code>normal!</code> command that does two
things:</p>
<ul>
<li>Visually select the range of text we want by:<ul>
<li>Moving to mark at the beginning of the range.</li>
<li>Entering characterwise visual mode.</li>
<li>Moving to the mark at the end of the range.</li>
</ul>
</li>
<li>Yanking the visually selected text.</li>
</ul>
<p>Don't worry about the specific marks for now.  You'll learn why they need to be
different when you complete the exercises at the end of this chapter.</p>
<p>The final line of the function echoes the variable <code>@@</code>.  Remember that
variables starting with an <code>@</code> are registers.  <code>@@</code> is the "unnamed" register:
the one that Vim places text into when you yank or delete without specify
a particular register.</p>
<p>In a nutshell: we select the text to search for, yank it, then echo the yanked
text.</p>
<h2 id="escaping-the-search-term">Escaping the Search Term</h2>
<p>Now that we've got the text we need in a Vim string we can escape it like we did
in the previous chapter.  Modify the <code>echom</code> command so it looks like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;g :set operatorfunc=GrepOperator&lt;cr&gt;g@
vnoremap &lt;leader&gt;g :&lt;c-u&gt;call GrepOperator(visualmode())&lt;cr&gt;

function! GrepOperator(type)
    if a:type ==# 'v'
        normal! `&lt;v`&gt;y
    elseif a:type ==# 'char'
        normal! `[v`]y
    else
        return
    endif

    echom shellescape(@@)
endfunction</code></pre>


<p>Write and source the file and try it out by visually selecting some text with
a special character in it and pressing <code>&lt;leader&gt;g</code>.  Vim will echo a version of
the selected text suitable for passing to a shell command.</p>
<h2 id="running-grep">Running Grep</h2>
<p>We're finally ready to add the <code>grep!</code> command that will perform the actual
search.  Replace the <code>echom</code> line so the code looks like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;g :set operatorfunc=GrepOperator&lt;cr&gt;g@
vnoremap &lt;leader&gt;g :&lt;c-u&gt;call GrepOperator(visualmode())&lt;cr&gt;

function! GrepOperator(type)
    if a:type ==# 'v'
        normal! `&lt;v`&gt;y
    elseif a:type ==# 'char'
        normal! `[v`]y
    else
        return
    endif

    silent execute "grep! -R " . shellescape(@@) . " ."
    copen
endfunction</code></pre>


<p>This should look familiar.  We simply execute the <code>silent execute "grep! ..."</code>
command we came up with in the last chapter.  It's even more readable here
because we're not trying to stuff the entire thing into a <code>nnoremap</code> command!</p>
<p>Write and source the file, then try it out and enjoy the fruits of your labor!</p>
<p>Because we've defined a brand new Vim operator we can use it in a lot of
different ways, such as:</p>
<ul>
<li><code>viw&lt;leader&gt;g</code>: Visually select a word, then grep for it.</li>
<li><code>&lt;leader&gt;g4w</code>: Grep for the next four words.</li>
<li><code>&lt;leader&gt;gt;</code>: Grep until semicolon.</li>
<li><code>&lt;leader&gt;gi[</code>: Grep inside square brackets.</li>
</ul>
<p>This highlights one of the best things about Vim: its editing commands are like
a language.  When you add a new verb it automatically works with (most of) the
existing nouns and adjectives.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help visualmode()</code>.</p>
<p>Read <code>:help c_ctrl-u</code>.</p>
<p>Read <code>:help operatorfunc</code>.</p>
<p>Read <code>:help map-operator</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="32.html">&laquo; Previous</a>
            
            
                <a class="next" href="34.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Case Study: Grep Operator, Part Three / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="34.html#case-study-grep-operator-part-three">Case Study: Grep Operator, Part Three</a><ul>
<li><a href="34.html#saving-registers">Saving Registers</a></li>
<li><a href="34.html#namespacing">Namespacing</a></li>
<li><a href="34.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="33.html">&laquo; Prev</a>
            
            
                <a class="next" href="35.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="case-study-grep-operator-part-three">Case Study: Grep Operator, Part Three</h1>
<p>Our shiny new "grep operator" is working great, but part of writing Vimscript is
being considerate and making your users' lives easier.  We can do two more
things to make our operator play nicely in the Vim ecosystem.</p>
<h2 id="saving-registers">Saving Registers</h2>
<p>By yanking the text into the unnamed register we destroy anything that was
previously in there.  Further, by using a visual selection to yank the text in
the case that our operator is applied with a motion, we also destroy any record
of the most recent visual selection.</p>
<p>This isn't very nice to our users, so let's avoid using a visual selection in
that case and also save the contents of the unnamed register before we yank in
all cases so that we can restore it after we're done.  Change the code to look
like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;g :set operatorfunc=GrepOperator&lt;cr&gt;g@
vnoremap &lt;leader&gt;g :&lt;c-u&gt;call GrepOperator(visualmode())&lt;cr&gt;

function! GrepOperator(type)
    let saved_unnamed_register = @@

    if a:type ==# 'v'
        normal! `&lt;v`&gt;y
    elseif a:type ==# 'char'
        normal! `[y`]
    else
        return
    endif

    silent execute "grep! -R " . shellescape(@@) . " ."
    copen

    let @@ = saved_unnamed_register
endfunction</code></pre>


<p>We've added two <code>let</code> statements at the top and bottom of the function.  The
first saves the contents of <code>@@</code> into a variable and the second restores it.
Additionally, we've applied yank with a motion rather than a visual selection in
the case that our operator is applied with a motion.</p>
<p>Write and source the file.  Make sure it works by yanking some text, then
pressing <code>&lt;leader&gt;giw</code> to run our operator, then pressing <code>p</code> to paste the text
you yanked before.</p>
<p>When writing Vim plugins you should <em>always</em> strive to save and restore any
settings or registers your code modifies so you don't surprise and confuse your
users.</p>
<h2 id="namespacing">Namespacing</h2>
<p>Our script created a function named <code>GrepOperator</code> in the global namespace.
This probably isn't a big deal, but when you're writing Vimscript it's far
better to be safe than sorry.</p>
<p>We can avoid polluting the global namespace by tweaking a couple of lines in our
code.  Edit the file to look like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;g :set operatorfunc=&lt;SID&gt;GrepOperator&lt;cr&gt;g@
vnoremap &lt;leader&gt;g :&lt;c-u&gt;call &lt;SID&gt;GrepOperator(visualmode())&lt;cr&gt;

function! s:GrepOperator(type)
    let saved_unnamed_register = @@

    if a:type ==# 'v'
        normal! `&lt;v`&gt;y
    elseif a:type ==# 'char'
        normal! `[v`]y
    else
        return
    endif

    silent execute "grep! -R " . shellescape(@@) . " ."
    copen

    let @@ = saved_unnamed_register
endfunction</code></pre>


<p>The first three lines of the script have changed.  First, we modified the
function name to start with <code>s:</code> which places it in the current script's
namespace.</p>
<p>We also modified the mappings and prepended the <code>GrepOperator</code> function name
with <code>&lt;SID&gt;</code> so they could find the function.  If we hadn't done this they would
have tried to find the function in the global namespace, which wouldn't have
worked.</p>
<p>Congratulations, our <code>grep-operator.vim</code> script is not only extremely useful,
but it's also a considerate Vimscript citizen!</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help &lt;SID&gt;</code>.</p>
<p>Treat yourself to a snack.  You deserve it!</p></div>

        <div class="prevnext">
            
                <a class="prev" href="33.html">&laquo; Previous</a>
            
            
                <a class="next" href="35.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Lists / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="35.html#lists">Lists</a><ul>
<li><a href="35.html#indexing">Indexing</a></li>
<li><a href="35.html#slicing">Slicing</a></li>
<li><a href="35.html#concatenation">Concatenation</a></li>
<li><a href="35.html#list-functions">List Functions</a></li>
<li><a href="35.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="34.html">&laquo; Prev</a>
            
            
                <a class="next" href="36.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="lists">Lists</h1>
<p>We've worked a lot with variables so far, but we haven't talked about aggregates
at all yet!  Vim has two main aggregate types, and we'll look at the first now:
lists.</p>
<p>Vimscript lists are ordered, heterogeneous collections of elements.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:echo ['foo', 3, 'bar']</code></pre>


<p>Vim displays the list.  Lists can of course be nested.  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:echo ['foo', [3, 'bar']]</code></pre>


<p>Vim happily displays the list.</p>
<h2 id="indexing">Indexing</h2>
<p>Vimscript lists are zero-indexed, and you can get at the elements in the usual
way.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo [0, [1, 2]][1]</code></pre>


<p>Vim displays <code>[1, 2]</code>.  You can also index from the end of the list, much like
Python.  Try this command:</p>
<pre class="codehilite"><code class="language-vim">:echo [0, [1, 2]][-2]</code></pre>


<p>Vim displays <code>0</code>.  The index <code>-1</code> refers to the last element in the list, <code>-2</code>
is the second-to-last, and so on.</p>
<h2 id="slicing">Slicing</h2>
<p>Vim lists can also be sliced.  This will <em>look</em> familiar to Python programmers,
but it does <em>not</em> always act the same way!  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo ['a', 'b', 'c', 'd', 'e'][0:2]</code></pre>


<p>Vim displays <code>['a', 'b', 'c']</code> (elements 0, 1 and 2).  You can safely exceed the
upper bound as well.  Try this command:</p>
<pre class="codehilite"><code class="language-vim">:echo ['a', 'b', 'c', 'd', 'e'][0:100000]</code></pre>


<p>Vim simply displays the entire list.</p>
<p>Slice indexes can be negative.  Try this command:</p>
<pre class="codehilite"><code class="language-vim">:echo ['a', 'b', 'c', 'd', 'e'][-2:-1]</code></pre>


<p>Vim displays <code>['d', 'e']</code> (elements -2 and -1).</p>
<p>When slicing lists you can leave off the first index to mean "the beginning"
and/or the last index to mean "the end".  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:echo ['a', 'b', 'c', 'd', 'e'][:1]
:echo ['a', 'b', 'c', 'd', 'e'][3:]</code></pre>


<p>Vim displays <code>['a', 'b']</code> and <code>['d', 'e']</code>.</p>
<p>Like Python, Vimscript allows you to index and slice strings too.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:echo "abcd"[0:2]</code></pre>


<p>Vim displays <code>abc</code>. However, you can't use negative bare indices with strings.
You <em>can</em> use negative indices when slicing strings though!  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:echo "abcd"[-1] . "abcd"[-2:]</code></pre>


<p>Vim displays <code>cd</code> (using a negative index silently resulted in an empty string).</p>
<h2 id="concatenation">Concatenation</h2>
<p>You can combine Vim lists with <code>+</code>.  Try this command:</p>
<pre class="codehilite"><code class="language-vim">:echo ['a', 'b'] + ['c']</code></pre>


<p>Vim, unsurprisingly, displays <code>['a', 'b', 'c']</code>.  There's not much else to say
here -- Vimscript lists are surprisingly sane compared to the rest of the
language.</p>
<h2 id="list-functions">List Functions</h2>
<p>Vim has a number of built-in functions for working with lists.  Run these
commands:</p>
<pre class="codehilite"><code class="language-vim">:let foo = ['a']
:call add(foo, 'b')
:echo foo</code></pre>


<p>Vim mutates the list <code>foo</code> in-place to append <code>'b'</code> and displays <code>['a', 'b']</code>.
Now run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo len(foo)</code></pre>


<p>Vim displays <code>2</code>, the length of the list.  Try these commands:</p>
<pre class="codehilite"><code class="language-vim">:echo get(foo, 0, 'default')
:echo get(foo, 100, 'default')</code></pre>


<p>Vim displays <code>a</code> and <code>default</code>.  The <code>get</code> function will get the item at the
given index from the given list, or return the given default value if the index
is out of range in the list.</p>
<p>Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo index(foo, 'b')
:echo index(foo, 'nope')</code></pre>


<p>Vim displays <code>1</code> and <code>-1</code>.  The <code>index</code> function returns the first index of the
given item in the given list, or <code>-1</code> if the item is not in the list.</p>
<p>Now run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo join(foo)
:echo join(foo, '---')
:echo join([1, 2, 3], '')</code></pre>


<p>Vim displays <code>a b</code>, <code>a---b</code>, and <code>123</code>.  <code>join</code> will join the items in the given
list together into a string, separated by the given separator string (or a space
if none is given), coercing each item to a string if necessary/possible.</p>
<p>Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:call reverse(foo)
:echo foo
:call reverse(foo)
:echo foo</code></pre>


<p>Vim displays <code>['b', 'a']</code> and then <code>['a', 'b']</code>.  <code>reverse</code> reverses the given
list <em>in place</em>.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help List</code>.  All of it.  Notice the capital <code>L</code>.</p>
<p>Read <code>:help add()</code>.</p>
<p>Read <code>:help len()</code>.</p>
<p>Read <code>:help get()</code>.</p>
<p>Read <code>:help index()</code>.</p>
<p>Read <code>:help join()</code>.</p>
<p>Read <code>:help reverse()</code>.</p>
<p>Skim <code>:help functions</code> to find some other list-related functions I haven't
mentioned yet.  Run <code>:match Keyword /\clist/</code> to case-insensitively highlight
the word <code>list</code> to make it easier to find what you're looking for.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="34.html">&laquo; Previous</a>
            
            
                <a class="next" href="36.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Looping / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="36.html#looping">Looping</a><ul>
<li><a href="36.html#for-loops">For Loops</a></li>
<li><a href="36.html#while-loops">While Loops</a></li>
<li><a href="36.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="35.html">&laquo; Prev</a>
            
            
                <a class="next" href="37.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="looping">Looping</h1>
<p>You might be surprised to realize that we've gone through thirty five chapters
of a programming language book without even mentioning loops!  Vimscript offers
so many other options for performing actions on text (<code>normal!</code>, etc) that loops
aren't as necessary as they are in most other languages.</p>
<p>Even so, you'll definitely need them some day, so now we'll take a look at the
two main kinds of loops Vim supports.</p>
<h2 id="for-loops">For Loops</h2>
<p>The first kind of loop is the <code>for</code> loop.  This may seem odd if you're used to
Java, C or Javascript <code>for</code> loops, but turns out to be quite elegant.  Run the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:let c = 0

:for i in [1, 2, 3, 4]
:  let c += i
:endfor

:echom c</code></pre>


<p>Vim displays <code>10</code>, which is the result of adding together each element in the
list.  Vimscript <code>for</code> loops iterate over lists (or dictionaries, which we'll
cover later).</p>
<p>There's no equivalent to the C-style <code>for (int i = 0; i &lt; foo; i++)</code> loop form in
Vimscript.  This might seem bad at first, but in practice you'll never miss it.</p>
<h2 id="while-loops">While Loops</h2>
<p>Vim also supports the classic <code>while</code> loop.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:let c = 1
:let total = 0

:while c &lt;= 4
:  let total += c
:  let c += 1
:endwhile

:echom total</code></pre>


<p>Once again Vim displays <code>10</code>.  This loop should be familiar to just about anyone
who's programmed before, so we won't spend any time on it.  You won't use it
very often.  Keep it in the back of your mind for the rare occasions that you
want it.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help for</code>.</p>
<p>Read <code>:help while</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="35.html">&laquo; Previous</a>
            
            
                <a class="next" href="37.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Dictionaries / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="37.html#dictionaries">Dictionaries</a><ul>
<li><a href="37.html#indexing">Indexing</a></li>
<li><a href="37.html#assigning-and-adding">Assigning and Adding</a></li>
<li><a href="37.html#removing-entries">Removing Entries</a></li>
<li><a href="37.html#dictionary-functions">Dictionary Functions</a></li>
<li><a href="37.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="36.html">&laquo; Prev</a>
            
            
                <a class="next" href="38.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="dictionaries">Dictionaries</h1>
<p>The last type of Vimscript variable we'll talk about is the dictionary.
Vimscript dictionaries are similar to Python's dicts, Ruby's hashes, and
Javascript's objects.</p>
<p>Dictionaries are created using curly brackets.  Values are heterogeneous, but
<em>keys are always coerced to strings</em>.  You didn't think things were going to be
<em>completely</em> sane, did you?</p>
<p>Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo {'a': 1, 100: 'foo'}</code></pre>


<p>Vim displays <code>{'a': 1, '100': 'foo'}</code>, which shows that Vimscript does indeed
coerce keys to strings while leaving values alone.</p>
<p>Vimscript avoids the stupidity of the Javascript standard and lets you use
a comma after the last element in a dictionary.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echo {'a': 1, 100: 'foo',}</code></pre>


<p>Once again Vim displays <code>{'a': 1, '100': 'foo'}</code>.  You should <em>always</em> use the
trailing comma in your dictionaries, <em>especially</em> when they're defined on
multiple lines, because it will make adding new entries less error-prone.</p>
<h2 id="indexing">Indexing</h2>
<p>To look up a key in a dictionary you use the same syntax as most languages.  Run
this command:</p>
<pre class="codehilite"><code class="language-vim">:echo {'a': 1, 100: 'foo',}['a']</code></pre>


<p>Vim displays <code>1</code>.  Try it with a non-string index:</p>
<pre class="codehilite"><code class="language-vim">:echo {'a': 1, 100: 'foo',}[100]</code></pre>


<p>Vim coerces the index to a string before performing the lookup, which makes
sense since keys can only ever be strings.</p>
<p>Vimscript also supports the Javascript-style "dot" lookup when the key is
a string consisting only of letters, digits and/or underscores.  Try the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:echo {'a': 1, 100: 'foo',}.a
:echo {'a': 1, 100: 'foo',}.100</code></pre>


<p>Vim displays the correct element in both cases.  How you choose to index your
dictionaries is a matter of taste and style.</p>
<h2 id="assigning-and-adding">Assigning and Adding</h2>
<p>Adding entries to dictionaries is done by simply assigning them like variables.
Run this command:</p>
<pre class="codehilite"><code class="language-vim">:let foo = {'a': 1}
:let foo.a = 100
:let foo.b = 200
:echo foo</code></pre>


<p>Vim displays <code>{'a': 100, 'b': 200}</code>, which shows that assigning and adding
entries both work the same way.</p>
<h2 id="removing-entries">Removing Entries</h2>
<p>There are two ways to remove entries from a dictionary.  Run the following
commands:</p>
<pre class="codehilite"><code class="language-vim">:let test = remove(foo, 'a')
:unlet foo.b
:echo foo
:echo test</code></pre>


<p>Vim displays <code>{}</code> and <code>100</code>.  The <code>remove</code> function will remove the entry with
the given key from the given dictionary and return the removed value.  The
<code>unlet</code> command also removes dictionary entries, but you can't use the value.</p>
<p>You cannot remove nonexistent entries from a dictionary.  Try running this
command:</p>
<pre class="codehilite"><code class="language-vim">:unlet foo["asdf"]</code></pre>


<p>Vim throws an error.</p>
<p>The choice of <code>remove</code> or <code>unlet</code> is mostly a matter of personal taste.  If
pressed I'd recommend using <code>remove</code> everywhere because it's more flexible than
<code>unlet</code>.  <code>remove</code> can do anything <code>unlet</code> can do but the reverse isn't true, so
you can always be consistent if you use <code>remove</code>.</p>
<h2 id="dictionary-functions">Dictionary Functions</h2>
<p>Like lists, Vim has a number of built-in functions for working with
dictionaries.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom get({'a': 100}, 'a', 'default')
:echom get({'a': 100}, 'b', 'default')</code></pre>


<p>Vim displays <code>100</code> and <code>default</code>, just like the <code>get</code> function for lists.</p>
<p>You can also check if a given key is present in a given dictionary.  Run this
commands:</p>
<pre class="codehilite"><code class="language-vim">:echom has_key({'a': 100}, 'a')
:echom has_key({'a': 100}, 'b')</code></pre>


<p>Vim displays <code>1</code> and <code>0</code>.  Remember that Vimscript treats <code>0</code> as falsy and any
other number as truthy.</p>
<p>You can pull the key-value pairs out of a dictionary with <code>items</code>.  Run this
command:</p>
<pre class="codehilite"><code class="language-vim">:echo items({'a': 100, 'b': 200})</code></pre>


<p>Vim will display a nested list that looks something like <code>[['a', 100], ['b',
200]]</code>.  As far as I can tell Vimscript dictionaries are <em>not</em> guaranteed to be
ordered, so don't expect that the items you get out of an <code>items</code> call will be
in a specific order!</p>
<p>You can get just the keys or just the values with the <code>keys</code> and <code>values</code>
functions.  They work as expected -- look them up.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help Dictionary</code>.  All of it.  Notice the capital <code>D</code>.</p>
<p>Read <code>:help get()</code>.</p>
<p>Read <code>:help has_key()</code>.</p>
<p>Read <code>:help items()</code>.</p>
<p>Read <code>:help keys()</code>.</p>
<p>Read <code>:help values()</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="36.html">&laquo; Previous</a>
            
            
                <a class="next" href="38.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Toggling / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="38.html#toggling">Toggling</a><ul>
<li><a href="38.html#toggling-options">Toggling Options</a></li>
<li><a href="38.html#toggling-other-things">Toggling Other Things</a></li>
<li><a href="38.html#improvements">Improvements</a></li>
<li><a href="38.html#restoring-windowsbuffers">Restoring Windows/Buffers</a></li>
<li><a href="38.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="37.html">&laquo; Prev</a>
            
            
                <a class="next" href="39.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="toggling">Toggling</h1>
<p>In one of the first chapters we talked about how to set options in Vim.  For
boolean options we can use <code>set someoption!</code> to "toggle" the option.  This is
especially nice when we create a mapping for that command.</p>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:nnoremap &lt;leader&gt;N :setlocal number!&lt;cr&gt;</code></pre>


<p>Try it out by pressing <code>&lt;leader&gt;N</code> in normal mode.  Vim will toggle the line
numbers for the current window off and on.  Creating a "toggle" mapping like
this is really handy, because we don't need to have two separate keys to turn
something off and on.</p>
<p>Unfortunately this only works for boolean options.  If we want to toggle
a non-boolean option we'll need to do a bit more work.</p>
<h2 id="toggling-options">Toggling Options</h2>
<p>Let's start by creating a function that will toggle an option for us, and
a mapping that will call it.  Put the following into your <code>~/.vimrc</code> file (or
a separate file in <code>~/.vim/plugin/</code> if you prefer):</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;f :call FoldColumnToggle()&lt;cr&gt;

function! FoldColumnToggle()
    echom &amp;foldcolumn
endfunction</code></pre>


<p>Write and source the file, then try it out by pressing <code>&lt;leader&gt;f</code>  Vim will
display the current value of the <code>foldcolumn</code> option.  Go ahead and read <code>:help
foldcolumn</code> if you're unfamiliar with this option.</p>
<p>Let's add in the actual toggling functionality.  Edit the code to look like
this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;f :call FoldColumnToggle()&lt;cr&gt;

function! FoldColumnToggle()
    if &amp;foldcolumn
        setlocal foldcolumn=0
    else
        setlocal foldcolumn=4
    endif
endfunction</code></pre>


<p>Write and source the file and try it out.  Each time you press it Vim will
either show or hide the fold column.</p>
<p>The <code>if</code> statement simply checks if <code>&amp;foldcolumn</code> is truthy (remember that Vim
treats the integer 0 as falsy and any other number as truthy).  If so, it sets
it to zero (which hides it).  Otherwise it sets it to four.  Pretty simple.</p>
<p>You can use a simple function like this to toggle any option where <code>0</code> means
"off" and any other number is "on".</p>
<h2 id="toggling-other-things">Toggling Other Things</h2>
<p>Options aren't the only thing we might want to toggle.  One particularly nice
thing to have a mapping for is the quickfix window.  Let's start with the same
skeleton as before.  Add the following code to your file:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;q :call QuickfixToggle()&lt;cr&gt;

function! QuickfixToggle()
    return
endfunction</code></pre>


<p>This mapping doesn't do anything yet.  Let's transform it into something
slightly more useful (but not completely finished yet).  Change the code to
look like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;q :call QuickfixToggle()&lt;cr&gt;

function! QuickfixToggle()
    copen
endfunction</code></pre>


<p>Write and source the file.  If you try out the mapping now you'll see that it
simply opens the quickfix window.</p>
<p>To get the "toggling" behavior we're looking for we'll use a quick, dirty
solution: a global variable.  Change the code to look like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;q :call QuickfixToggle()&lt;cr&gt;

function! QuickfixToggle()
    if g:quickfix_is_open
        cclose
        let g:quickfix_is_open = 0
    else
        copen
        let g:quickfix_is_open = 1
    endif
endfunction</code></pre>


<p>What we've done is pretty simple -- we're simply storing a global variable
describing the open/closed state of the quickfix window whenever we call the
function.</p>
<p>Write and source the file, and try to run the mapping.  Vim will complain that
the variable is not defined yet!  Let's fix that by initializing it once:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;q :call QuickfixToggle()&lt;cr&gt;

let g:quickfix_is_open = 0

function! QuickfixToggle()
    if g:quickfix_is_open
        cclose
        let g:quickfix_is_open = 0
    else
        copen
        let g:quickfix_is_open = 1
    endif
endfunction</code></pre>


<p>Write and source the file, and try the mapping.  It works!</p>
<h2 id="improvements">Improvements</h2>
<p>Our toggle function works, but has a few problems.</p>
<p>The first is that if the user manually opens or closes the window with <code>:copen</code>
or <code>:cclose</code> our global variable doesn't get updated.  This isn't really a huge
problem in practice because most of the time the user will probably be opening
the window with the mapping, and if not they can always just press it again.</p>
<p>This illustrates an important point about writing Vimscript code: if you try to
handle every single edge case you'll get bogged down in it and never get any
work done.</p>
<p>Getting something that works most of the time (and doesn't explode when it
doesn't work) and getting back to coding is usually better than spending hours
getting it 100% perfect.  The exception is when you're writing a plugin you
expect many people to use.  In that case it's best to spend the time and make it
bulletproof to keep your users happy and reduce bug reports.</p>
<h2 id="restoring-windowsbuffers">Restoring Windows/Buffers</h2>
<p>The other problem with our function is that if the user runs the mapping when
they're already in the quickfix window, Vim closes it and dumps them into the
last split instead of sending them back where they were.  This is annoying if
you just want to check the quickfix window really quick and get back to working.</p>
<p>To solve this we'll introduce an idiom that comes in handy a lot when writing
Vim plugins.  Edit your code to look like this:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;leader&gt;q :call QuickfixToggle()&lt;cr&gt;

let g:quickfix_is_open = 0

function! QuickfixToggle()
    if g:quickfix_is_open
        cclose
        let g:quickfix_is_open = 0
        execute g:quickfix_return_to_window . "wincmd w"
    else
        let g:quickfix_return_to_window = winnr()
        copen
        let g:quickfix_is_open = 1
    endif
endfunction</code></pre>


<p>We've added two new lines in this mapping.  One of them (in the <code>else</code> clause)
sets another global variable which saves the current window number before we run
<code>:copen</code>.</p>
<p>The second line (in the <code>if</code> clause) executes <code>wincmd w</code> with that number
prepended as a count, which tells Vim to go to that window.</p>
<p>Once again our solution isn't bulletproof, because the user might open or close
new split between runs of the mapping.  Even so, it handles the majority of
cases so it's good enough for now.</p>
<p>This strategy of manually saving global state would be frowned upon in most
serious programs, but for tiny little Vimscript functions it's a quick and dirty
way of getting something mostly working and moving on with your life.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help foldcolumn</code>.</p>
<p>Read <code>:help winnr()</code></p>
<p>Read <code>:help ctrl-w_w</code>.</p>
<p>Read <code>:help wincmd</code>.</p>
<p>Namespace the functions by adding <code>s:</code> and <code>&lt;SID&gt;</code> where necessary.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="37.html">&laquo; Previous</a>
            
            
                <a class="next" href="39.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Functional Programming / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="39.html#functional-programming">Functional Programming</a><ul>
<li><a href="39.html#immutable-data-structures">Immutable Data Structures</a></li>
<li><a href="39.html#functions-as-variables">Functions as Variables</a></li>
<li><a href="39.html#higher-order-functions">Higher-Order Functions</a></li>
<li><a href="39.html#performance">Performance</a></li>
<li><a href="39.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="38.html">&laquo; Prev</a>
            
            
                <a class="next" href="40.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="functional-programming">Functional Programming</h1>
<p>We're going to take a short break now to talk about a style of programming you
may have heard of: <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Functional_programming">functional programming</a>.</p>
<p>If you've programmed in languages like Python, Ruby or Javascript, or
<em>especially</em> Lisp, Scheme, Clojure or Haskell, you're probably familiar with the
idea of using functions as variables and using data structures with immutable
state.  If you've never done this before you can safely skip this chapter, but
I'd encourage you to try it anyway and broaden your horizons!</p>
<p>Vimscript has all the pieces necessary to program in a kind-of-functional style,
but it's a bit clunky.  We can create a few helpers that will make it less
painful though.</p>
<p>Go ahead and create a <code>functional.vim</code> file somewhere so you don't have to keep
typing everything over and over.  This file will be our scratchpad for this
chapter.</p>
<h2 id="immutable-data-structures">Immutable Data Structures</h2>
<p>Unfortunately Vim doesn't have any immutable collections like Clojure's vectors
and maps built-in, but by creating some helper functions we can fake it to some
degree.</p>
<p>Add the following function to your file:</p>
<pre class="codehilite"><code class="language-vim">function! Sorted(l)
    let new_list = deepcopy(a:l)
    call sort(new_list)
    return new_list
endfunction</code></pre>


<p>Source and write the file, then run <code>:echo Sorted([3, 2, 4, 1])</code> to try it out.
Vim echoes <code>[1, 2, 3, 4]</code>.</p>
<p>How is this different from simply calling the built-in <code>sort()</code> function?  The
key is the first line: <code>let new_list = deepcopy(a:l)</code>.  Vim's <code>sort()</code> sorts the
list <em>in place</em>, so we first create a full copy of the list and sort <em>that</em> so
the original list won't be changed.</p>
<p>This prevents side effects and helps us write code that is easier to reason
about and test.  Let's add a few more helper functions in this same style:</p>
<pre class="codehilite"><code class="language-vim">function! Reversed(l)
    let new_list = deepcopy(a:l)
    call reverse(new_list)
    return new_list
endfunction

function! Append(l, val)
    let new_list = deepcopy(a:l)
    call add(new_list, a:val)
    return new_list
endfunction

function! Assoc(l, i, val)
    let new_list = deepcopy(a:l)
    let new_list[a:i] = a:val
    return new_list
endfunction

function! Pop(l, i)
    let new_list = deepcopy(a:l)
    call remove(new_list, a:i)
    return new_list
endfunction</code></pre>


<p>Each of these functions is exactly the same except for the middle line and the
arguments they take.  Source and write the file and try them out on a few lists.</p>
<p><code>Reversed()</code> takes a list and returns a new list with the elements reversed.</p>
<p><code>Append()</code> returns a new list with the given value appended to the end of the
old one.</p>
<p><code>Assoc()</code> (short for "associate") returns a new list, with the element at the
given index replaced by the new value.</p>
<p><code>Pop()</code> returns a new list with the element at the given index removed.</p>
<h2 id="functions-as-variables">Functions as Variables</h2>
<p>Vimscript supports using variables to store functions, but the syntax is a bit
obtuse.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:let Myfunc = function("Append")
:echo Myfunc([1, 2], 3)</code></pre>


<p>Vim will display <code>[1, 2, 3]</code> as expected.  Notice that the variable we used
started with a capital letter.  If a Vimscript variable refers to a function it
must start with a capital letter.</p>
<p>Functions can be stored in lists just like any other kind of variable.  Run the
following commands:</p>
<pre class="codehilite"><code class="language-vim">:let funcs = [function("Append"), function("Pop")]
:echo funcs[1](['a', 'b', 'c'], 1)</code></pre>


<p>Vim displays <code>['a', 'c']</code>.  The <code>funcs</code> variable does <em>not</em> need to start with
a capital letter because it's storing a list, not a function.  The contents of
the list don't matter at all.</p>
<h2 id="higher-order-functions">Higher-Order Functions</h2>
<p>Let's create a few of the most commonly-used higher-order functions.  If you're
not familiar with that term, higher-order functions are functions that take
<em>other</em> functions and do something with them.</p>
<p>We'll begin with the trusty <code>map</code> function.  Add this to your file:</p>
<pre class="codehilite"><code class="language-vim">function! Mapped(fn, l)
    let new_list = deepcopy(a:l)
    call map(new_list, string(a:fn) . '(v:val)')
    return new_list
endfunction</code></pre>


<p>Source and write the file, and try it out by running the following commands:</p>
<pre class="codehilite"><code class="language-vim">:let mylist = [[1, 2], [3, 4]]
:echo Mapped(function("Reversed"), mylist)</code></pre>


<p>Vim displays <code>[[2, 1], [4, 3]]</code>, which is the result of applying <code>Reversed()</code> to
every element in the list.</p>
<p>How does <code>Mapped()</code> work?  Once again we create a fresh list with <code>deepcopy()</code>,
do something to it, and return the modified copy -- nothing new there.  The
tricky part is the middle.</p>
<p><code>Mapped()</code> takes two arguments: a funcref (Vim's term for "variable holding
a function") and a list.  We use the built-in <code>map()</code> function to perform the
actual work.  Read <code>:help map()</code> now to see how it works.</p>
<p>Now we'll create a few other common higher-order functions.  Add the following
to your file:</p>
<pre class="codehilite"><code class="language-vim">function! Filtered(fn, l)
    let new_list = deepcopy(a:l)
    call filter(new_list, string(a:fn) . '(v:val)')
    return new_list
endfunction</code></pre>


<p>Try <code>Filtered()</code> out with the following commands:</p>
<pre class="codehilite"><code class="language-vim">:let mylist = [[1, 2], [], ['foo'], []]
:echo Filtered(function('len'), mylist)</code></pre>


<p>Vim displays <code>[[1, 2], ['foo']]</code>.</p>
<p><code>Filtered()</code> takes a predicate function and a list.  It returns a copy of the
list that contains only the elements of the original where the result of calling
the function on it is "truthy".  In this case we use the built-in <code>len()</code>
function, so it filters out all the elements whose length is zero.</p>
<p>Finally we'll create the counterpart to <code>Filtered()</code>:</p>
<pre class="codehilite"><code class="language-vim">function! Removed(fn, l)
    let new_list = deepcopy(a:l)
    call filter(new_list, '!' . string(a:fn) . '(v:val)')
    return new_list
endfunction</code></pre>


<p>Try it out just like we did with <code>Filtered()</code>:</p>
<pre class="codehilite"><code class="language-vim">:let mylist = [[1, 2], [], ['foo'], []]
:echo Removed(function('len'), mylist)</code></pre>


<p>Vim displays <code>[[], []]</code>.  <code>Removed()</code> is like <code>Filtered()</code> except it only keeps
elements where the predicate function does <em>not</em> return something truthy.</p>
<p>The only difference in the code is the single <code>'!' .</code> we added to the call
command, which negates the result of the predicate.</p>
<h2 id="performance">Performance</h2>
<p>You might be thinking that copying lists all over the place is wasteful, since
Vim has to constantly create new copies and garbage collect old ones.</p>
<p>If so: you're right!  Vim's lists don't support the same kind of structural
sharing as Clojure's vectors, so all those copy operations can be expensive.</p>
<p>Sometimes this will matter.  If you're working with enormous lists, things can
slow down.  In real life, though, you might be surprised at how little you'll
actually notice the difference.</p>
<p>Consider this: as I'm writing this chapter my Vim program is using about 80
megabytes of memory (and I have a <em>lot</em> of plugins installed).  My laptop has
8 <em>gigabytes</em> of memory in it.  Is the overhead of having a few copies of a list
around really going to make a noticeable difference?  Of course that depends on
the size of the list, but in most cases the answer will be "no".</p>
<p>To contrast, my Firefox instance with five tabs open is currently using 1.22
<em>gigabytes</em> of RAM.</p>
<p>You'll need to use your own judgement about when this style of programming
creates unacceptably bad performance.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help sort()</code>.</p>
<p>Read <code>:help reverse()</code>.</p>
<p>Read <code>:help copy()</code>.</p>
<p>Read <code>:help deepcopy()</code>.</p>
<p>Read <code>:help map()</code> if you haven't already.</p>
<p>Read <code>:help function()</code>.</p>
<p>Modify <code>Assoc()</code>, <code>Pop()</code>, <code>Mapped()</code>, <code>Filtered()</code> and <code>Removed()</code> to support
dictionaries.  You'll probably need <code>:help type()</code> for this.</p>
<p>Implement <code>Reduced()</code>.</p>
<p>Pour yourself a glass of your favorite drink.  This chapter was intense!</p></div>

        <div class="prevnext">
            
                <a class="prev" href="38.html">&laquo; Previous</a>
            
            
                <a class="next" href="40.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Paths / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="40.html#paths">Paths</a><ul>
<li><a href="40.html#absolute-paths">Absolute Paths</a></li>
<li><a href="40.html#listing-files">Listing Files</a></li>
<li><a href="40.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="39.html">&laquo; Prev</a>
            
            
                <a class="next" href="41.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="paths">Paths</h1>
<p>Vim is a text editor, and text editors (usually) work with text files.  Text
files live on filesystems, and to specify files we use paths.  Vimscript has
a few built-in utilities that can be extremely helpful when you need to work
with paths.</p>
<h2 id="absolute-paths">Absolute Paths</h2>
<p>Sometimes it's handy to be able to get the absolute path of a certain file for
use with external scripts.  Run the following commands:</p>
<pre class="codehilite"><code class="language-vim">:echom expand('%')
:echom expand('%:p')
:echom fnamemodify('foo.txt', ':p')</code></pre>


<p>The first command displays the relative path of whatever file you're currently
editing.  <code>%</code> means "the current file".  Vim supports a bunch of other strings
you can use with <code>expand()</code> as well.</p>
<p>The second command displays the full, absolute path of that file.  The <code>:p</code> in
the string tells Vim that you want the absolute path.  There are a ton of other
modifiers you can use.</p>
<p>The third command displays an absolute path to the file <code>foo.txt</code> in the current
directory, regardless of whether that file actually exists.  <code>fnamemodify()</code> is
a Vim function that's more flexible than <code>expand()</code> in that you can specify any
file name, not just one of <code>expand()</code>'s special strings.</p>
<h2 id="listing-files">Listing Files</h2>
<p>You might also want to get a listing of files in a specific directory.  Run the
following command:</p>
<pre class="codehilite"><code class="language-vim">:echo globpath('.', '*')</code></pre>


<p>Vim will display all of the files and directories in the current directory.  The
<code>globpath()</code> function returns a string, with each name separated by a newline.
To get a list you'll need to <code>split()</code> it yourself.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo split(globpath('.', '*'), '\n')</code></pre>


<p>This time Vim displays a Vimscript list containing each path.  If you've got
newlines in your filenames you're on your own, sorry.</p>
<p><code>globpath()</code>'s wildcards work mostly as you would expect.  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:echo split(globpath('.', '*.txt'), '\n')</code></pre>


<p>Vim displays a list of all <code>.txt</code> files in the current directory.</p>
<p>You can recursively list files with <code>**</code>.  Run this command:</p>
<pre class="codehilite"><code class="language-vim">:echo split(globpath('.', '**'), '\n')</code></pre>


<p>Vim will list all files and directories under the current directory.</p>
<p><code>globpath()</code> is <em>extremely</em> powerful.  You'll learn more when you complete this
chapter's exercises.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help expand()</code>.</p>
<p>Read <code>:help fnamemodify()</code>.</p>
<p>Read <code>:help filename-modifiers</code>.</p>
<p>Read <code>:help simplify()</code>.</p>
<p>Read <code>:help resolve()</code>.</p>
<p>Read <code>:help globpath()</code>.</p>
<p>Read <code>:help wildcards</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="39.html">&laquo; Previous</a>
            
            
                <a class="next" href="41.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Creating a Full Plugin / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="41.html#creating-a-full-plugin">Creating a Full Plugin</a><ul>
<li><a href="41.html#potion">Potion</a></li>
<li><a href="41.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="40.html">&laquo; Prev</a>
            
            
                <a class="next" href="42.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="creating-a-full-plugin">Creating a Full Plugin</h1>
<p>We've covered a lot of ground in the last forty or so chapters.  In the final
part of the book we're going to walk through creating a Vim plugin for
a programming language from scratch.</p>
<p>This is not for the faint of heart.  It's going to take a lot of effort.</p>
<p>If you want to stop now, that's completely fine!  You've already learned enough
to make serious enhancements to your own <code>~/.vimrc</code> file and to fix bugs you
find in other people's plugins.</p>
<p>There's no shame in saying "that's enough for me, I don't want to spend hours
of my life creating plugins I won't use very often".  Be practical.  If you
can't think of a full plugin you want to make, stop now and come back when you
do.</p>
<p>If you <em>do</em> want to continue make sure you're ready to devote some time.  The
rest of the book is going to be intense, and I'm going to assume you actually
want to <em>learn</em>, not just coast through the chapters reading them on your couch.</p>
<h2 id="potion">Potion</h2>
<p>The plugin we're going to make is going to add support for the <a href="http://perl11.github.com/potion/index.html">Potion</a>
programming language.</p>
<p>Potion is a toy language created by _why the lucky stiff before his
disappearance.  It's an extremely small language which makes it ideal for our
purposes.</p>
<p>Potion feels a lot like <a href="http://iolanguage.com/">Io</a>, with some ideas from Ruby, Lua, and other
languages mixed in.  If you've never tried Io it may seem weird.  I strongly
recommend playing with Potion for at least an hour or two.  You won't use it in
real life, but it might change the way you think and expose you to new ideas.</p>
<p>The current implementation of Potion has a lot of rough edges.  For example: if
you mess up the syntax it usually segfaults.  Try not to get too hung up on
this.  I'll provide you with lots of sample code that works so you can focus
mostly on the Vimscript and not Potion.</p>
<p>The goal is not to learn Potion (though that can be fun too).  The goal is to
use Potion as a small example so we can touch on a lot of different aspects of
writing full Vim plugins.</p>
<h2 id="exercises">Exercises</h2>
<p>Download and install <a href="http://perl11.github.com/potion/index.html">Potion</a>.  You're on your own for this one.  It should be
fairly simple.</p>
<p>Make sure you can get the first couple examples in the pamphlet working in the
Potion interpreter and by putting them in a <code>.pn</code> file.  If it seems like the
interpreter isn't working check out <a href="https://github.com/perl11/potion/issues/12">this
issue</a> for a possible cause.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="40.html">&laquo; Previous</a>
            
            
                <a class="next" href="42.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Plugin Layout in the Dark Ages / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="42.html#plugin-layout-in-the-dark-ages">Plugin Layout in the Dark Ages</a><ul>
<li><a href="42.html#basic-layout">Basic Layout</a></li>
<li><a href="42.html#vimcolors">~/.vim/colors/</a></li>
<li><a href="42.html#vimplugin">~/.vim/plugin/</a></li>
<li><a href="42.html#vimftdetect">~/.vim/ftdetect/</a></li>
<li><a href="42.html#vimftplugin">~/.vim/ftplugin/</a></li>
<li><a href="42.html#vimindent">~/.vim/indent/</a></li>
<li><a href="42.html#vimcompiler">~/.vim/compiler/</a></li>
<li><a href="42.html#vimafter">~/.vim/after/</a></li>
<li><a href="42.html#vimautoload">~/.vim/autoload/</a></li>
<li><a href="42.html#vimdoc">~/.vim/doc/</a></li>
<li><a href="42.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="41.html">&laquo; Prev</a>
            
            
                <a class="next" href="43.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="plugin-layout-in-the-dark-ages">Plugin Layout in the Dark Ages</h1>
<p>The first thing we need to talk about is how to structure our plugin.  In the
past this was a messy affair, but now there's a tool that makes the process of
installing Vim plugins much, <em>much</em> saner.</p>
<p>We need to go over the basic layout first, then we'll talk about how to restore
our sanity.</p>
<h2 id="basic-layout">Basic Layout</h2>
<p>Vanilla Vim supports splitting plugins into multiple files.  There are a number
of different directories you can create under <code>~/.vim</code> that mean various things.</p>
<p>We'll cover the most important directories now, but don't stress out too much
about them.  We'll go over them one at a time as we create our Potion plugin.</p>
<p>Before we continue we need to talk about some vocabulary.</p>
<p>I've been using the word "plugin" to mean "a big ol' hunk of Vimscript that does
a bunch of related stuff".  Vim has a more specific meaning of "plugin", which
is "a file in <code>~/.vim/plugin/</code>".</p>
<p>Most of the time I'll be using the first definition.  I'll try to be clear when
I mean the second.</p>
<h2 id="vimcolors">~/.vim/colors/</h2>
<p>Files inside <code>~/.vim/colors/</code> are treated as color schemes.  For example: if you
run <code>:color mycolors</code> Vim will look for a file at <code>~/.vim/colors/mycolors.vim</code>
and run it.  That file should contain all the Vimscript commands necessary to
generate your color scheme.</p>
<p>We're not going to cover color schemes in this book.  If you want to create your
own you should copy an existing scheme and modify it.  Remember that <code>:help</code> is
your friend.</p>
<h2 id="vimplugin">~/.vim/plugin/</h2>
<p>Files inside <code>~/.vim/plugin/</code> will each be run once <em>every time</em> Vim starts.
These files are meant to contain code that you always want loaded whenever you
start Vim.</p>
<h2 id="vimftdetect">~/.vim/ftdetect/</h2>
<p>Any files in <code>~/.vim/ftdetect/</code> will <em>also</em> be run every time you start Vim.</p>
<p><code>ftdetect</code> stands for "filetype detection".  The files in this directory should
set up autocommands that detect and set the <code>filetype</code> of files, and <em>nothing
else</em>.  This means they should never be more than one or two lines long.</p>
<h2 id="vimftplugin">~/.vim/ftplugin/</h2>
<p>Files in <code>~/.vim/ftplugin/</code> are different.</p>
<p>The naming of these files matters!  When Vim sets a buffer's <code>filetype</code> to
a value it then looks for a file in <code>~/.vim/ftplugin/</code> that matches.  For
example: if you run <code>set filetype=derp</code> Vim will look for
<code>~/.vim/ftplugin/derp.vim</code>.  If that file exists, it will run it.</p>
<p>Vim also supports directories inside <code>~/.vim/ftplugin/</code>.  To continue our
example: <code>set filetype=derp</code> will also make Vim run any and all <code>*.vim</code> files
inside <code>~/.vim/ftplugin/derp/</code>.  This lets you split up your plugin's <code>ftplugin</code>
files into logical groups.</p>
<p>Because these files are run every time a buffer's <code>filetype</code> is set they <em>must</em>
only set buffer-local options!  If they set options globally they would
overwrite them for all open buffers!</p>
<h2 id="vimindent">~/.vim/indent/</h2>
<p>Files in <code>~/.vim/indent/</code> are a lot like <code>ftplugin</code> files.  They get loaded
based on their names.</p>
<p><code>indent</code> files should set options related to indentation for their filetypes,
and those options should be buffer-local.</p>
<p>Yes, you could simply put this code in the <code>ftplugin</code> files, but it's better to
separate it out so other Vim users will understand what you're doing.  It's just
a convention, but please be a considerate plugin author and follow it.</p>
<h2 id="vimcompiler">~/.vim/compiler/</h2>
<p>Files in <code>~/.vim/compiler/</code> work exactly like <code>indent</code> files.  They should set
compiler-related options in the current buffer based on their names.</p>
<p>Don't worry about what "compiler-related options" means right now.  We'll cover
that later.</p>
<h2 id="vimafter">~/.vim/after/</h2>
<p>The <code>~/.vim/after/</code> directory is a bit of a hack.  Files in this directory will
be loaded every time Vim starts, but <em>after</em> the files in <code>~/.vim/plugin/</code>.</p>
<p>This allows you to override Vim's internal files.  In practice you'll rarely
need this, so don't worry about it until you find yourself thinking "Vim itself
sets option <code>x</code>, but I want something different".</p>
<h2 id="vimautoload">~/.vim/autoload/</h2>
<p>The <code>~/.vim/autoload/</code> directory is an incredibly important hack.  It sounds
a lot more complicated than it actually is.</p>
<p>In a nutshell: <code>autoload</code> is a way to delay the loading of your plugin's code
until it's actually needed.  We'll cover this in more detail later when we
refactor our plugin's code to take advantage of it.</p>
<h2 id="vimdoc">~/.vim/doc/</h2>
<p>Finally, the <code>~/.vim/doc/</code> directory is where you can add documentation for your
plugin.  Vim has a huge focus on documentation (as evidenced by all the <code>:help</code>
commands we've been running) so it's important to document your plugins.</p>
<h2 id="exercises">Exercises</h2>
<p>Reread this chapter.  I'm not kidding.  Make sure you understand (in a very
rough way) what each directory we've talked about does.</p>
<p>For extra credit, find some Vim plugins you use and look at how they structure
their files.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="41.html">&laquo; Previous</a>
            
            
                <a class="next" href="43.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>A New Hope: Plugin Layout with Pathogen / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="43.html#a-new-hope-plugin-layout-with-pathogen">A New Hope: Plugin Layout with Pathogen</a><ul>
<li><a href="43.html#runtimepath">Runtimepath</a></li>
<li><a href="43.html#pathogen">Pathogen</a></li>
<li><a href="43.html#being-pathogen-compatible">Being Pathogen-Compatible</a></li>
<li><a href="43.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="42.html">&laquo; Prev</a>
            
            
                <a class="next" href="44.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="a-new-hope-plugin-layout-with-pathogen">A New Hope: Plugin Layout with Pathogen</h1>
<p>Vim's vanilla layout for plugin files makes sense if you're just adding a file
here and there to customize your own Vim experience, but turns into a mess when
you want to use plugins other people have written.</p>
<p>In the past, when you wanted to use a plugin someone else wrote you would
download the files and place them, one-by-one, into the appropriate directories.
You could also use <code>zip</code> or <code>tar</code> to do the placing for you.</p>
<p>There are a few significant problems with this approach:</p>
<ul>
<li>What happens when you want to update a plugin?  You can overwrite the old
  files, but how do you know if the author deleted a file that you now need to
  delete by hand?</li>
<li>What if two plugins happen to have a file with the same name (like <code>utils.vim</code>
  or something generic like that)?  Sometimes you can simply rename it, but if
  it's in <code>autoload/</code> or another directory where the names matter you've got to
  edit the plugin yourself.  Not fun.</li>
</ul>
<p>People came up with several hacks to try to make things easier, like Vimballs.
Luckily we don't need to suffer through these ugly hacks any more.  <a href="http://tpo.pe/">Tim Pope</a>
created the wonderful <a href="http://www.vim.org/scripts/script.php?script_id=2332">Pathogen</a> plugin that makes managing multiple plugins
a breeze, as long as plugin authors structure their plugins in a sane way.</p>
<p>Let's take a quick look at how Pathogen works and what we need to do to make our
plugin compatible.</p>
<h2 id="runtimepath">Runtimepath</h2>
<p>When Vim looks for files in a specific directory, like <code>syntax/</code>, it doesn't
just look in a single place.  Much like <code>PATH</code> on Linux/Unix/BSD systems, Vim
has the <code>runtimepath</code> setting which tells it where to find files to load.</p>
<p>Create a <code>colors</code> directory on your Desktop.  Create a file in that directory
called <code>mycolor.vim</code> (you can leave it empty for this demonstration).  Open Vim
and run this command:</p>
<pre class="codehilite"><code class="language-vim">:color mycolor</code></pre>


<p>Vim will display an error, because it doesn't know to look on your Desktop for
files.  Now run this command:</p>
<pre class="codehilite"><code class="language-vim">:set runtimepath=/Users/sjl/Desktop</code></pre>


<p>You'll need to change the path to match the path of your own Desktop, of course.
Now try the color command again:</p>
<pre class="codehilite"><code class="language-vim">:color mycolor</code></pre>


<p>This time Vim doesn't throw an error, because it was able to find the
<code>mycolor.vim</code> file.  Because the file was blank it didn't actually <em>do</em>
anything, but we know it was found because it didn't throw an error.</p>
<h2 id="pathogen">Pathogen</h2>
<p>The Pathogen plugin automatically adds paths to your <code>runtimepath</code> when you load
Vim.  Any directories inside <code>~/.vim/bundle/</code> will each be added to the
<code>runtimepath</code>.</p>
<p>This means that each directory inside <code>bundle/</code> should contain some or all of
the standard Vim plugin directories, like <code>colors/</code> and <code>syntax/</code>.  Vim can now
load files from each of those directories, which makes it simple to keep each
plugin's files in its own directory.</p>
<p>This makes it trivial to update plugins.  You can simply blow away the old
plugin's directory entirely and replace it with the new version.  If you keep
your <code>~/.vim</code> directory under version control (and you should) you can use
Mercurial's subrepos or Git's submodules to directly check out each plugin's
repository into <code>~/.vim/bundle/</code> and then update it with a simple <code>hg pull; hg
update</code> or <code>git pull origin master</code>.</p>
<h2 id="being-pathogen-compatible">Being Pathogen-Compatible</h2>
<p>When we write our Potion plugin we want to let our users use it with Pathogen.
Doing this is simple: we simply put our files in the appropriate directories
inside the plugin's repository!</p>
<p>Our plugin's repository will wind up looking like this:</p>
<pre class="codehilite"><code class="language-text">potion/
    README
    LICENSE
    doc/
        potion.txt
    ftdetect/
        potion.vim
    ftplugin/
        potion.vim
    syntax/
        potion.vim
    ... etc ...</code></pre>


<p>We can put this on GitHub or Bitbucket and users can simply clone it down into
<code>bundle/</code> and everything will just work!</p>
<h2 id="exercises">Exercises</h2>
<p>Install <a href="http://www.vim.org/scripts/script.php?script_id=2332">Pathogen</a> if you haven't already done so.</p>
<p>Create a Mercurial or Git repository for your plugin, called <code>potion</code>.  You can
put it anywhere you like and symlink it into <code>~/.vim/bundle/potion/</code> or just put
it directly in <code>~/.vim/bundle/potion/</code>.</p>
<p>Create <code>README</code> and <code>LICENSE</code> files in the repository and commit them.</p>
<p>Push the repository up to Bitbucket or GitHub.</p>
<p>Read <code>:help runtimepath</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="42.html">&laquo; Previous</a>
            
            
                <a class="next" href="44.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Detecting Filetypes / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="44.html#detecting-filetypes">Detecting Filetypes</a><ul>
<li><a href="44.html#detecting-potion-files">Detecting Potion Files</a></li>
<li><a href="44.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="43.html">&laquo; Prev</a>
            
            
                <a class="next" href="45.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="detecting-filetypes">Detecting Filetypes</h1>
<p>Let's create a Potion file we can use as a sample as we're working on our
plugin.  Create a <code>factorial.pn</code> file somewhere and put the following Potion
code inside it:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1
    n to 1 (i):
        total *= i.
    total.

10 times (i):
    i string print
    '! is: ' print
    factorial (i) string print
    "\n" print.</code></pre>


<p>This code creates a simple factorial function and calls it ten times, printing
the results each time.  Go ahead and run it with <code>potion factorial.pn</code>.  The
output should look like this:</p>
<pre class="codehilite"><code class="language-text">0! is: 0
1! is: 1
2! is: 2
3! is: 6
4! is: 24
5! is: 120
6! is: 720
7! is: 5040
8! is: 40320
9! is: 362880</code></pre>


<p>If you don't get this output, or you get an error, stop and figure out what's
gone wrong.  The code should work exactly as-is.</p>
<p>Take some time to understand how the code works.  Refer to the Potion docs
liberally.  It's not critical to understanding Vimscript but it will make you
a better programmer.</p>
<h2 id="detecting-potion-files">Detecting Potion Files</h2>
<p>Open <code>factorial.pn</code> in Vim and run the following command:</p>
<pre class="codehilite"><code class="language-vim">:set filetype?</code></pre>


<p>Vim will display <code>filetype=</code> because it doesn't know what a <code>.pn</code> file is yet.
Let's fix that.</p>
<p>Create <code>ftdetect/potion.vim</code> in your plugin's repo.  Put the following lines
into it:</p>
<pre class="codehilite"><code class="language-vim">au BufNewFile,BufRead *.pn set filetype=potion</code></pre>


<p>This creates a single autocommand: a command to set the filetype of <code>.pn</code> files
to <code>potion</code>.  Pretty straightforward.</p>
<p>Notice that we <em>didn't</em> use an autocommand group like we usually would.  Vim
automatically wraps the contents of <code>ftdetect/*.vim</code> files in autocommand groups
for you, so you don't need to worry about it.</p>
<p>Close the <code>factorial.pn</code> file and reopen it.  Now run the previous command
again:</p>
<pre class="codehilite"><code class="language-vim">:set filetype?</code></pre>


<p>This time Vim displays <code>filetype=potion</code>.  When Vim started up it loaded the
autocommand group inside <code>~/.vim/bundle/potion/ftdetect/potion.vim</code>, and when it
opened <code>factorial.pn</code> the autocommand fired, setting the <code>filetype</code> to <code>potion</code>.</p>
<p>Now that we've taught Vim to recognize Potion files we can move on to actually
creating some useful behavior in our plugin.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help ft</code>.  Don't worry if you don't understand everything there.</p>
<p>Read <code>:help setfiletype</code>.</p>
<p>Modify the Potion plugin's <code>ftdetect/potion.vim</code> script to use <code>setfiletype</code>
instead of <code>set filetype</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="43.html">&laquo; Previous</a>
            
            
                <a class="next" href="45.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Basic Syntax Highlighting / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="45.html#basic-syntax-highlighting">Basic Syntax Highlighting</a><ul>
<li><a href="45.html#highlighting-keywords">Highlighting Keywords</a></li>
<li><a href="45.html#highlighting-functions">Highlighting Functions</a></li>
<li><a href="45.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="44.html">&laquo; Prev</a>
            
            
                <a class="next" href="46.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="basic-syntax-highlighting">Basic Syntax Highlighting</h1>
<p>Now that we've gotten the boilerplate out of the way it's time to start writing
some useful code for our Potion plugin.  We'll start with some simple syntax
highlighting.</p>
<p>Create a <code>syntax/potion.vim</code> file in your plugin's repo.  Put the following code
into the file:</p>
<pre class="codehilite"><code class="language-vim">if exists("b:current_syntax")
    finish
endif

echom "Our syntax highlighting code will go here."

let b:current_syntax = "potion"</code></pre>


<p>Close Vim, and then open your <code>factorial.pn</code> file.  You may or may not see the
message, depending on whether you have any other plugins that perform commands
after this one gets run.  If you run <code>:messages</code> you'll definitely see that the
file was indeed loaded.</p>
<p><strong>Note:</strong>  Whenever I tell you to open the Potion file I want you to do it in
a <em>new Vim window/instance</em> instead of in a split/tab.  Opening a new Vim window
causes Vim to reload all your bundled files for that window, whereas using
a split does not.</p>
<p>The lines at the beginning and end of the file are a convention that prevents it
from being loaded if syntax highlighting has already been enabled for this
buffer.</p>
<h2 id="highlighting-keywords">Highlighting Keywords</h2>
<p>For the rest of this chapter we'll ignore the <code>if</code> and <code>let</code> boilerplate at the
beginning and end of the file.  Don't remove those lines, just forget about them.</p>
<p>Replace the placeholder <code>echom</code> in the file with the following code:</p>
<pre class="codehilite"><code class="language-vim">syntax keyword potionKeyword to times
highlight link potionKeyword Keyword</code></pre>


<p>Close the <code>factorial.pn</code> file and reopen it.  The <code>to</code> and <code>times</code> words will be
highlighted as keywords in your color scheme!</p>
<p>These two lines show the basic structure of simple syntax highlighting in Vim.
To highlight a piece of syntax:</p>
<ul>
<li>You first define a "chunk" of syntax using <code>syntax keyword</code> or a related
  command (which we'll talk about later).</li>
<li>You then link "chunks" to highlighting groups.  A highlighting group is
  something you define in a color scheme, for example "function names should be
  blue".</li>
</ul>
<p>This lets plugin authors define the "chunks" of syntax in ways that make sense
to them, and then link them to common highlighting groups.  It also lets color
scheme creators define colors for a common set of programming constructs so they
don't need to know about individual languages.</p>
<p>Potion has a bunch of other keywords that we haven't used in our toy program, so
let's edit our syntax file to highlight those too:</p>
<pre class="codehilite"><code class="language-vim">syntax keyword potionKeyword loop times to while
syntax keyword potionKeyword if elsif else
syntax keyword potionKeyword class return

highlight link potionKeyword Keyword</code></pre>


<p>First of all: the last line hasn't changed.  We're still telling Vim that
anything in the <code>potionKeyword</code> syntax group should be highlighted as
a <code>Keyword</code>.</p>
<p>We've now got three lines, each starting with <code>syntax keyword potionKeyword</code>.
This shows that running this command multiple times doesn't <em>reset</em> the syntax
group -- it adds to it!  This lets you define groups piecemeal.</p>
<p>How you define your groups is up to you:</p>
<ul>
<li>You might just toss everything onto one line and be done with it.</li>
<li>You might prefer to break the lines up so they fit within 80 columns to make
  them easier to read.</li>
<li>You could have a separate line for each item in a group, to make diffs looks
  nicer.</li>
<li>You could do what I've done here and group related items together.</li>
</ul>
<h2 id="highlighting-functions">Highlighting Functions</h2>
<p>Another standard Vim highlighting group is <code>Function</code>.  Let's add some of the
built-in Potion functions to our highlighting script.  Edit the guts of your
syntax file so it looks like this:</p>
<pre class="codehilite"><code class="language-vim">syntax keyword potionKeyword loop times to while
syntax keyword potionKeyword if elsif else
syntax keyword potionKeyword class return

syntax keyword potionFunction print join string

highlight link potionKeyword Keyword
highlight link potionFunction Function</code></pre>


<p>Close and reopen <code>factorial.pn</code> and you'll see that the built-in potion
functions are now highlighted.</p>
<p>This works exactly the same way as keyword highlighting.  We've defined a new
syntax group and linked it to a different highlighting group.</p>
<h2 id="exercises">Exercises</h2>
<p>Think about why the <code>if exists</code> and <code>let</code> lines at the beginning and end of the
file are useful.  If you can't figure it out, don't worry about it.  I had to
ask Tim Pope to be sure.</p>
<p>Skim over <code>:help syn-keyword</code>.  Pay close attention to the part that mentions
<code>iskeyword</code>.</p>
<p>Read <code>:help iskeyword</code>.</p>
<p>Read <code>:help group-name</code> to get an idea of some common highlighting groups that
color scheme authors frequently use.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="44.html">&laquo; Previous</a>
            
            
                <a class="next" href="46.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Advanced Syntax Highlighting / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="46.html#advanced-syntax-highlighting">Advanced Syntax Highlighting</a><ul>
<li><a href="46.html#highlighting-comments">Highlighting Comments</a></li>
<li><a href="46.html#highlighting-operators">Highlighting Operators</a></li>
<li><a href="46.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="45.html">&laquo; Prev</a>
            
            
                <a class="next" href="47.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="advanced-syntax-highlighting">Advanced Syntax Highlighting</h1>
<p>So far we've defined some simple syntax highlighting for Potion files: keywords
and functions.</p>
<p>If you didn't do the exercises in the last chapter, you need to go back and do
them.  I'm going to assume you did them.</p>
<p>In fact, you should go back and do <em>any</em> exercises you skipped.  Even if you
think you don't need them, you <em>need</em> to do them for this book to be effective.
Please trust me on this.</p>
<h2 id="highlighting-comments">Highlighting Comments</h2>
<p>One obvious part of Potion that we need to highlight is comments.  The problem
is that Potion comments start with <code>#</code> which is (almost always) not in
<code>iskeyword</code>.</p>
<p>If you don't know what <code>iskeyword</code> means, you didn't listen to me.  Go back and
<em>do the damn exercises</em>.  I'm not just throwing useless busywork at you when
I write the exercises for each chapter.  You <em>really</em> need to do them to
understand the book.</p>
<p>Because <code>#</code> isn't a keyword character we need to use a regular expression to
match it (and the rest of the comment).  We'll do this with <code>syntax match</code>
instead of <code>syntax keyword</code>.  Add the following lines to your syntax file:</p>
<pre class="codehilite"><code class="language-vim">syntax match potionComment "\v#.*$"
highlight link potionComment Comment</code></pre>


<p>I'm not going to tell you where to put them in the file any more.  You're
a programmer: use your judgement.</p>
<p>Close and reopen <code>factorial.pn</code>.  Add a comment somewhere in the file and you'll
see that it's highlighted as a comment.</p>
<p>The second line is simple: it tells Vim to highlight anything in the
<code>potionComment</code> syntax group as a <code>Comment</code>.</p>
<p>The first line is something new.  We use <code>syntax match</code> which tells Vim to match
<em>regexes</em> instead of literal keywords.</p>
<p>Notice that the regular expression we're using starts with <code>\v</code> which tells Vim
to use "very magic" mode.  Reread the chapter on basic regular expressions if
you're not sure what that means.</p>
<p>In this particular case the "very magic" mode isn't necessary.  But in the
future we might change this regex and wonder why it's not working, so I'd
recommend <em>always</em> using "very magic" regexes for consistency.</p>
<p>As for the regex itself, it's fairly simple: comments start with a hash and
include all characters from there to the end of the line.</p>
<p>If you need a refresher course on regular expressions you should take a look at
<a href="http://regex.learncodethehardway.org/">Learn Regex the Hard Way</a> by Zed Shaw.</p>
<h2 id="highlighting-operators">Highlighting Operators</h2>
<p>Another part of Potion we need regexes to highlight is operators.  Add the
following to your syntax file:</p>
<pre class="codehilite"><code class="language-vim">syntax match potionOperator "\v\*"
syntax match potionOperator "\v/"
syntax match potionOperator "\v\+"
syntax match potionOperator "\v-"
syntax match potionOperator "\v\?"
syntax match potionOperator "\v\*\="
syntax match potionOperator "\v/\="
syntax match potionOperator "\v\+\="
syntax match potionOperator "\v-\="

highlight link potionOperator Operator</code></pre>


<p>Close and reopen <code>factorial.pn</code>.  Notice that the <code>*=</code> in the factorial function
is now highlighted.</p>
<p>The first thing you probably noticed about this hunk of code is that I put each
regex on its own line instead of grouping them like I did with keywords.  This
is because <code>syntax match</code> does <em>not</em> support multiple groups on a single line.</p>
<p>You should also note that I used <code>\v</code> at the beginning of every regular
expression, even when it wasn't strictly necessary.  I prefer to keep my regex
syntax consistent when writing Vimscript, even if it means a few extra
characters.</p>
<p>You might be wondering why I didn't use a regex like <code>"\v-\=?"</code> to match both
<code>-</code> <em>and</em> <code>-=</code> in one line.  You can absolutely do that if you want to.  It will
work just fine.  I just tend to think of <code>-</code> and <code>-=</code> as separate operators, so
I put them on separate lines.</p>
<p>Defining those operators as separate matches simplifies the regexes at the cost
of some extra verbosity.  I prefer doing it like that, but you may feel
differently.  Use your judgement.</p>
<p>I also never defined <code>=</code> as an operator.  We'll do that in a second, but
I wanted to avoid it for now so I could teach you a lesson.</p>
<p>Because I used separate regexes for <code>-</code> and <code>-=</code> I had to define <code>-=</code> <em>after</em>
<code>-</code>!</p>
<p>If I did it in the opposite order and used <code>-=</code> in a Potion file, Vim would
match <code>-</code> (and highlight it, of course) and only <code>=</code> would remain for matching.
This shows when you're building groups with <code>syntax match</code> each group "consumes"
pieces of the file that can't be matched later.</p>
<p>This is an oversimplification, but I don't want to get bogged down in the
details just yet.  For now, your rule of thumb should be to match larger groups
after smaller groups later because groups defined <em>later</em> have priority over
groups defined <em>earlier</em>.</p>
<p>Let's go ahead and add <code>=</code> as an operator, now that we've had our lesson:</p>
<pre class="codehilite"><code class="language-vim">syntax match potionOperator "\v\="</code></pre>


<p>Take a second and think about where you need to put this in the syntax file.
Reread the last few paragraphs if you need a hint.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help syn-match</code>.</p>
<p>Read <code>:help syn-priority</code>.</p>
<p>We didn't make <code>:</code> an operator in our example.  Read the Potion docs and make
a conscious decision about whether to make <code>:</code> an operator.  If you decide to do
so, add it to the syntax file.</p>
<p>Do the same for <code>.</code> and <code>/</code>.</p>
<p>Add a syntax group <code>potionNumber</code> that highlights numbers.  Link it to the
highlight group <code>Number</code>.  Remember that Potion supports numbers like <code>2</code>,
<code>0xffaf</code>, <code>123.23</code>, <code>1e-2</code>, and <code>1.9956e+2</code>.  Remember to balance the time it
takes to handle edge cases with the amount of time those edge cases will
actually be used.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="45.html">&laquo; Previous</a>
            
            
                <a class="next" href="47.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Even More Advanced Syntax Highlighting / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="47.html#even-more-advanced-syntax-highlighting">Even More Advanced Syntax Highlighting</a><ul>
<li><a href="47.html#highlighting-strings">Highlighting Strings</a></li>
<li><a href="47.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="46.html">&laquo; Prev</a>
            
            
                <a class="next" href="48.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="even-more-advanced-syntax-highlighting">Even More Advanced Syntax Highlighting</h1>
<p>Syntax highlighting in Vim is a topic that could easily fill a book of its own.</p>
<p>We're going to cover one last important part of it here and then move on to
other things.  If you want to learn more you can read the Vim documentation with
<code>:help syntax</code> and look at syntax files other people have made.</p>
<h2 id="highlighting-strings">Highlighting Strings</h2>
<p>Potion, like most programming languages, supports string literals like <code>"Hello,
world!"</code>.  We should highlight these as strings.  To do this we'll use the
<code>syntax region</code> command.  Add the following to your Potion syntax file:</p>
<pre class="codehilite"><code class="language-vim">syntax region potionString start=/\v"/ skip=/\v\\./ end=/\v"/
highlight link potionString String</code></pre>


<p>Close and reopen your <code>factorial.pn</code> file and you'll see that the string at the
end of the file is highlighted!</p>
<p>The last line here should be familiar.  Reread the previous two chapters if you
don't understand what it does.</p>
<p>The first line adds to a syntax group using a "region".  Regions have a "start"
pattern and an "end" pattern that specify where they start and end.  In this
case, a Potion string starts when we see a double quote and ends when we see the
next double quote.</p>
<p>The "skip" argument to <code>syntax region</code> allows us to handle string escapes like
<code>"She said: \"Vimscript is tricky, but useful\"!"</code>.</p>
<p>If we didn't use the <code>skip</code> argument Vim would end the string at the <code>"</code> before
<code>Vimscript</code>, which is not what we want!</p>
<p>In a nutshell, the <code>skip</code> argument to <code>syntax region</code> tells Vim: "once you start
matching this region, I want you to ignore anything that matches <code>skip</code>, even if
it would normally be considered the end of the region".</p>
<p>Take a few minutes and think through this.  What happens with something like
<code>"foo \\" bar"</code>?  Is that the correct behavior?  Will that <em>always</em> be the
correct behavior?  Close this book, take a few minutes and really <em>think</em> about
this!</p>
<h2 id="exercises">Exercises</h2>
<p>Add syntax highlighting for single quoted strings.</p>
<p>Read <code>:help syn-region</code>.</p>
<p>Reading that should take longer than reading this chapter.  Pour yourself
a drink, you've earned it!</p></div>

        <div class="prevnext">
            
                <a class="prev" href="46.html">&laquo; Previous</a>
            
            
                <a class="next" href="48.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Basic Folding / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="48.html#basic-folding">Basic Folding</a><ul>
<li><a href="48.html#types-of-folding">Types of Folding</a><ul>
<li><a href="48.html#manual">Manual</a></li>
<li><a href="48.html#marker">Marker</a></li>
<li><a href="48.html#diff">Diff</a></li>
<li><a href="48.html#expr">Expr</a></li>
<li><a href="48.html#indent">Indent</a></li>
</ul>
</li>
<li><a href="48.html#potion-folding">Potion Folding</a></li>
<li><a href="48.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="47.html">&laquo; Prev</a>
            
            
                <a class="next" href="49.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="basic-folding">Basic Folding</h1>
<p>If you've never used code folding in Vim, you don't know what you're missing.
Read <code>:help usr_28</code> and spend some time playing around with it in your normal
work.  Come back to this chapter once you've got it in your fingers.</p>
<h2 id="types-of-folding">Types of Folding</h2>
<p>Vim supports six different ways of defining how your text should be folded.</p>
<h3 id="manual">Manual</h3>
<p>You create the folds by hand and they're stored in RAM by Vim.  When you close
Vim they go away and you have to recreate them the next time you edit the file.</p>
<p>This method can be handy if you combine it with some custom mappings to make it
easy to create folds.  We won't do that in this book, but keep it in the back
of your mind in case you run across a case where it could be handy.</p>
<h3 id="marker">Marker</h3>
<p>Vim folds your code based on characters in the actual text.</p>
<p>Usually these characters are put in comments (like <code>// {{{</code>), but in some
languages you can get away with using something in the language's syntax itself,
like <code>{</code> and <code>}</code> in Javascript files.</p>
<p>It may seem ugly to clutter up your code with comments that are purely for your
text editor, but the advantage is that it lets you hand-craft folds for
a specific file.  This can be really nice if you're working with a large file
that you want to organize in a very specific way.</p>
<h3 id="diff">Diff</h3>
<p>A special folding mode used when diff'ing files.  We won't talk about this one
at all because Vim automatically handles it.</p>
<h3 id="expr">Expr</h3>
<p>This lets you use a custom piece of Vimscript to define where folds occur.  It's
the most powerful method, but also requires the most work.  We'll talk about
this in the next chapter.</p>
<h3 id="indent">Indent</h3>
<p>Vim uses your code's indentation to determine folds.  Lines at the same
indentation level fold together, and lines with only whitespace (and blank
lines) are simply folded with their neighbors.</p>
<p>This is essentially free to use because your code is already indented; all you
have to do is turn it on.  This will be our first method of adding folding to
Potion files.</p>
<h2 id="potion-folding">Potion Folding</h2>
<p>Let's take a look at our sample Potion file once again:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1
    n to 1 (i):
        total *= i.
    total.

10 times (i):
    i string print
    '! is: ' print
    factorial (i) string print
    "\n" print.</code></pre>


<p>The bodies of the function and loop are both indented.  This means we can get
some basic folding with very little effort by using indent folding.</p>
<p>Before we start, go ahead and add a comment above the <code>total *= i.</code> line so we
have a nice multiple-line inner block to test with.  You'll learn why we need to
do this when you do the exercises, but for now just trust me.  The file should
now look like this:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1
    n to 1 (i):
        # Multiply the running total.
        total *= i.
    total.

10 times (i):
    i string print
    '! is: ' print
    factorial (i) string print
    "\n" print.</code></pre>


<p>Create an <code>ftplugin</code> folder in your Potion plugin's repository, and create
a <code>potion</code> folder inside that.  Finally, create a <code>folding.vim</code> file inside of
<em>that</em>.</p>
<p>Remember that Vim will run the code in this file whenever it sets a buffer's
<code>filetype</code> to <code>potion</code> (because it's in a folder named <code>potion</code>).</p>
<p>Putting all folding-related code into its own file is generally a good idea and
will help us keep the various functionality of our plugin organized.</p>
<p>Add the following line to this file:</p>
<pre class="codehilite"><code class="language-vim">setlocal foldmethod=indent</code></pre>


<p>Close Vim and open the <code>factorial.pn</code> file again.  Play around with the new
folding with <code>zR</code>, <code>zM</code>, and <code>za</code>.</p>
<p>One line of Vimscript gave us some useful folding!  That's pretty cool!</p>
<p>You might notice that the lines inside the inner loop of the <code>factorial</code>
function aren't folded even though they're indented.  What's going on?</p>
<p>It turns out that by default Vim will ignore lines beginning with a <code>#</code>
character when using <code>indent</code> folding.  This works great when editing C files
(where <code>#</code> signals a preprocessor directive) but isn't very helpful when you're
editing other types of files.</p>
<p>Let's add one more line to the <code>ftplugin/potion/folding.vim</code> file to fix this:</p>
<pre class="codehilite"><code class="language-vim">setlocal foldmethod=indent
setlocal foldignore=</code></pre>


<p>Close and reopen <code>factorial.pn</code> and now the inner block will be folded properly.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help foldmethod</code>.</p>
<p>Read <code>:help fold-manual</code>.</p>
<p>Read <code>:help fold-marker</code> and <code>:help foldmarker</code>.</p>
<p>Read <code>:help fold-indent</code>.</p>
<p>Read <code>:help fdl</code> and <code>:help foldlevelstart</code>.</p>
<p>Read <code>:help foldminlines</code>.</p>
<p>Read <code>:help foldignore</code>.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="47.html">&laquo; Previous</a>
            
            
                <a class="next" href="49.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Advanced Folding / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="49.html#advanced-folding">Advanced Folding</a><ul>
<li><a href="49.html#folding-theory">Folding Theory</a></li>
<li><a href="49.html#first-make-a-plan">First: Make a Plan</a></li>
<li><a href="49.html#getting-started">Getting Started</a></li>
<li><a href="49.html#expr-folding">Expr Folding</a></li>
<li><a href="49.html#blank-lines">Blank Lines</a></li>
<li><a href="49.html#special-foldlevels">Special Foldlevels</a></li>
<li><a href="49.html#an-indentation-level-helper">An Indentation Level Helper</a></li>
<li><a href="49.html#one-more-helper">One More Helper</a></li>
<li><a href="49.html#finishing-the-fold-function">Finishing the Fold Function</a><ul>
<li><a href="49.html#blanks">Blanks</a></li>
<li><a href="49.html#finding-indentation-levels">Finding Indentation Levels</a></li>
<li><a href="49.html#equal-indents">Equal Indents</a></li>
<li><a href="49.html#lesser-indent-levels">Lesser Indent Levels</a></li>
<li><a href="49.html#greater-indentation-levels">Greater Indentation Levels</a></li>
</ul>
</li>
<li><a href="49.html#review">Review</a></li>
<li><a href="49.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="48.html">&laquo; Prev</a>
            
            
                <a class="next" href="50.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="advanced-folding">Advanced Folding</h1>
<p>In the last chapter we used Vim's <code>indent</code> folding to add some quick and dirty
folding to Potion files.</p>
<p>Open <code>factorial.pn</code> and make sure all the folds are closed with <code>zM</code>.  The file
should now look something like this:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
+--  5 lines: total = 1

10 times (i):
+--  4 lines: i string print</code></pre>


<p>Toggle the first fold and it will look like this:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1
    n to 1 (i):
+---  2 lines: # Multiply the running total.
    total.

10 times (i):
+--  4 lines: i string print</code></pre>


<p>This is pretty nice, but I personally prefer to fold the first line of a block
with its contents.  In this chapter we'll write some custom folding code, and
when we're done our folds will look like this:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1
+---  3 lines: n to 1 (i):
    total.

+--  5 lines: 10 times (i):</code></pre>


<p>This is more compact and (to me) easier to read.  If you prefer the <code>indent</code>
method that's okay, but do this chapter anyway just to get some practice writing
Vim folding expressions.</p>
<h2 id="folding-theory">Folding Theory</h2>
<p>When writing custom folding code it helps to have an idea of how Vim "thinks" of
folding.  Here are the rules in a nutshell:</p>
<ul>
<li>Each line of code in a file has a "foldlevel".  This is always either zero or
  a positive integer.</li>
<li>Lines with a foldlevel of zero are <em>never</em> included in any fold.</li>
<li>Adjacent lines with the same foldlevel are folded together.</li>
<li>If a fold of level X is closed, any subsequent lines with a foldlevel greater
  than or equal to X are folded along with it until you reach a line with
  a level less than X.</li>
</ul>
<p>It's easiest to get a feel for this with an example.  Open a Vim window and
paste the following text into it.</p>
<pre class="codehilite"><code class="language-text">a
    b
    c
        d
        e
    f
g</code></pre>


<p>Turn on <code>indent</code> folding by running the following command:</p>
<pre class="codehilite"><code class="language-vim">:setlocal foldmethod=indent</code></pre>


<p>Play around with the folds for a minute to see how they behave.</p>
<p>Now run the following command to view the foldlevel of line 1:</p>
<pre class="codehilite"><code class="language-vim">:echom foldlevel(1)</code></pre>


<p>Vim will display <code>0</code>.  Now let's find the foldlevel of line 2:</p>
<pre class="codehilite"><code class="language-vim">:echom foldlevel(2)</code></pre>


<p>Vim will display <code>1</code>.  Let's try line 3:</p>
<pre class="codehilite"><code class="language-vim">:echom foldlevel(3)</code></pre>


<p>Once again Vim displays <code>1</code>.  This means that lines 2 and 3 are part of a level
1 fold.</p>
<p>Here are the foldlevels for each line:</p>
<pre class="codehilite"><code class="language-text">a           0
    b       1
    c       1
        d   2
        e   2
    f       1
g           0</code></pre>


<p>Reread the rules at the beginning of this section.  Open and close each fold in
this file, look at the foldlevels, and make sure you understand why the folds
behave as they do.</p>
<p>Once you're confident that you understand how every line's foldlevel works to
create the folding structure, move on to the next section.</p>
<h2 id="first-make-a-plan">First: Make a Plan</h2>
<p>Before we dive into writing code, let's try to sketch out some rough "rules" for
our folding.</p>
<p>First, lines that are indented should be folded together.  We also want the
<em>previous</em> line folded with them, so that something like this:</p>
<pre class="codehilite"><code class="language-text">hello = (name):
    'Hello, ' print
    name print.</code></pre>


<p>Will fold like this:</p>
<pre class="codehilite"><code class="language-text">+--  3 lines: hello = (name):</code></pre>


<p>Blank lines should be at the same level as <em>later</em> lines, so blank lines at the
end of a fold won't be included in it.  This means that this:</p>
<pre class="codehilite"><code class="language-text">hello = (name):
    'Hello, ' print
    name print.

hello('Steve')</code></pre>


<p>Will fold like this:</p>
<pre class="codehilite"><code class="language-text">+--  3 lines: hello = ():

hello('Steve')</code></pre>


<p>And <em>not</em> like this:</p>
<pre class="codehilite"><code class="language-text">+--  4 lines: hello = ():
hello('Steve')</code></pre>


<p>These rules are a matter of personal preference, but for now this is the way
we're going to implement folding.</p>
<h2 id="getting-started">Getting Started</h2>
<p>Let's get started on our custom folding code by opening Vim with two splits.
One should contain our <code>ftplugin/potion/folding.vim</code> file, and the other should
contain our sample <code>factorial.pn</code>.</p>
<p>In the previous chapter we closed and reopened Vim to make our changes to
<code>folding.vim</code> take effect, but it turns out there's an easier way to do that.</p>
<p>Remember that any files inside <code>ftplugin/potion/</code> will be run whenever the
<code>filetype</code> of a buffer is set to <code>potion</code>.  This means you can simply run <code>:set
ft=potion</code> in the split containing <code>factorial.pn</code> and Vim will reload the
folding code!</p>
<p>This is much faster than closing and reopening the file every time.  The only
thing you need to remember is that you have to <em>save</em> <code>folding.vim</code> to disk,
otherwise your unsaved changes won't be taken into account.</p>
<h2 id="expr-folding">Expr Folding</h2>
<p>We're going to use Vim's <code>expr</code> folding to give us unlimited flexibility in how
our code is folded.</p>
<p>We can go ahead and remove the <code>foldignore</code> from <code>folding.vim</code> because it's only
relevant when using <code>indent</code> folding.  We also want to tell Vim to use <code>expr</code>
folding, so change the contents of <code>folding.vim</code> to look like this:</p>
<pre class="codehilite"><code class="language-vim">setlocal foldmethod=expr
setlocal foldexpr=GetPotionFold(v:lnum)

function! GetPotionFold(lnum)
    return '0'
endfunction</code></pre>


<p>The first line simply tells Vim to use <code>expr</code> folding.</p>
<p>The second line defines the expression Vim should use to get the foldlevel of
a line.  When Vim runs the expression it will set <code>v:lnum</code> to the line number of
the line it wants to know about.  Our expression will call a custom function
with this number as an argument.</p>
<p>Finally we define a dummy function that simply returns <code>'0'</code> for every line.
Note that it's returning a String and not an Integer.  We'll see why shortly.</p>
<p>Go ahead and reload the folding code by saving <code>folding.vim</code> and running <code>:set
ft=potion</code> in <code>factorial.pn</code>.  Our function returns <code>'0'</code> for every line, so
Vim won't fold anything at all.</p>
<h2 id="blank-lines">Blank Lines</h2>
<p>Let's take care of the special case of blank lines first.  Modify the
<code>GetPotionFold</code> function to look like this:</p>
<pre class="codehilite"><code class="language-vim">function! GetPotionFold(lnum)
    if getline(a:lnum) =~? '\v^\s*$'
        return '-1'
    endif

    return '0'
endfunction</code></pre>


<p>We've added an <code>if</code> statement to take care of the blank lines.  How does it
work?</p>
<p>First we use <code>getline(a:lnum)</code> to get the content of the current line as
a String.</p>
<p>We compare this to the regex <code>\v^\s*$</code>.  Remember that <code>\v</code> turns on "very
magic" ("sane") mode.  This regex will match "beginning of line, any number
of whitespace characters, end of line".</p>
<p>The comparison is using the case-insensitive match operator <code>=~?</code>.  Technically
we don't have to be worried about case since we're only matching whitespace, but
I prefer to be more explicit when using comparison operators on Strings.  You
can use <code>=~</code> instead if you prefer.</p>
<p>If you need a refresher on using regular expressions in Vim you should go back
and reread the "Basic Regular Expressions" chapter and the chapters on the "Grep
Operator".</p>
<p>If the current line has some non-whitespace characters it won't match and we'll
just return <code>'0'</code> as before.</p>
<p>If the current line <em>does</em> match the regex (i.e. if it's empty or just
whitespace) we return the string <code>'-1'</code>.</p>
<p>Earlier I said that a line's foldlevel can be zero or a positive integer, so
what's happening here?</p>
<h2 id="special-foldlevels">Special Foldlevels</h2>
<p>Your custom folding expression can return a foldlevel directly, or return one of
a few "special" strings that tell Vim how to fold the line without directly
specifying its level.</p>
<p><code>'-1'</code> is one of these special strings.  It tells Vim that the level of this
line is "undefined".  Vim will interpret this as "the foldlevel of this line is
equal to the foldlevel of the line above or below it, whichever is smaller".</p>
<p>This isn't <em>exactly</em> what our plan called for, but we'll see that it's close
enough and will do what we want.</p>
<p>Vim can "chain" these undefined lines together, so if you have two in a row
followed by a line at level 1, it will set the last undefined line to 1, then
the next to last to 1, then the first to 1.</p>
<p>When writing custom folding code you'll often find a few types of line that you
can easily set a specific level for.  Then you'll use <code>'-1'</code> (and some other
special foldlevels we'll see soon) to "cascade" the proper folding levels to the
rest of the file.</p>
<p>If you reload the folding code for <code>factorial.pn</code> Vim <em>still</em> won't fold any
lines together.  This is because all the lines have a foldlevel of either zero
or "undefined".  The level <code>0</code> will "cascade" through the undefined lines and
eventually all the lines will have their foldlevel set to <code>0</code>.</p>
<h2 id="an-indentation-level-helper">An Indentation Level Helper</h2>
<p>To tackle non-blank lines we'll need to know their indentation level, so let's
create a small helper function to calculate it for us.  Add the following
function above <code>GetPotionFold</code>:</p>
<pre class="codehilite"><code class="language-vim">function! IndentLevel(lnum)
    return indent(a:lnum) / &amp;shiftwidth
endfunction</code></pre>


<p>Reload the folding code.  Test out your function by running the following
command in the <code>factorial.pn</code> buffer:</p>
<pre class="codehilite"><code class="language-vim">:echom IndentLevel(1)</code></pre>


<p>Vim displays <code>0</code> because line 1 is not indented.  Now try it on line 2:</p>
<pre class="codehilite"><code class="language-vim">:echom IndentLevel(2)</code></pre>


<p>This time Vim displays <code>1</code>.  Line two has 4 spaces at the beginning, and
<code>shiftwidth</code> is set to 4, so 4 divided by 4 is 1.</p>
<p><code>IndentLevel</code> is fairly straightforward.  The <code>indent(a:lnum)</code> returns the
number of spaces at the beginning of the given line number.  We divide that by
the <code>shiftwidth</code> of the buffer to get the indentation level.</p>
<p>Why did we use <code>&amp;shiftwidth</code> instead of just dividing by 4?  If someone prefers
two-space indentation in their Potion files, dividing by 4 would produce an
incorrect result.  We use the <code>shiftwidth</code> setting to allow for any number of
spaces per level.</p>
<h2 id="one-more-helper">One More Helper</h2>
<p>It might not be obvious where to go from here.  Let's stop and think about what
type of information we need to have to figure out how to fold a non-blank line.</p>
<p>We need to know the indentation level of the line itself.  We've got that
covered with the <code>IndentLevel</code> function, so we're all set there.</p>
<p>We'll also need to know the indentation level of the <em>next non-blank line</em>,
because we want to fold the "header" lines with their indented bodies.</p>
<p>Let's write a helper function to get the number of the next non-blank line after
a given line.  Add the following function above <code>IndentLevel</code>:</p>
<pre class="codehilite"><code class="language-vim">function! NextNonBlankLine(lnum)
    let numlines = line('$')
    let current = a:lnum + 1

    while current &lt;= numlines
        if getline(current) =~? '\v\S'
            return current
        endif

        let current += 1
    endwhile

    return -2
endfunction</code></pre>


<p>This function is a bit longer, but is pretty simple.  Let's take it
piece-by-piece.</p>
<p>First we store the total number of lines in the file with <code>line('$')</code>.  Check
out the documentation for <code>line()</code> to see how this works.</p>
<p>Next we set the variable <code>current</code> to the number of the next line.</p>
<p>We then start a loop that will walk through each line in the file.</p>
<p>If the line matches the regex <code>\v\S</code>, which means "match a character that's
<em>not</em> a whitespace character", then it must be non-blank, so we should return
its line number.</p>
<p>If the line doesn't match, we loop around to the next one.</p>
<p>If the loop gets all the way to the end of the file without ever returning, then
there are <em>no</em> non-blank lines after the current line!  We return <code>-2</code> if that
happens to indicate this.  <code>-2</code> isn't a valid line number, so it's an easy way
to say "sorry, there's no valid result".</p>
<p>We could have returned <code>-1</code>, because that's not a valid line number either.
I could have even picked <code>0</code>, since line numbers in Vim start at <code>1</code>!  So why
did I pick <code>-2</code>, which seems like a strange choice?</p>
<p>I chose <code>-2</code> because we're working with folding code, and <code>'-1'</code> (and <code>'0'</code>) is
a special Vim foldlevel string.</p>
<p>When my eyes are reading over this file and I see a <code>-1</code> my brain immediately
thinks "undefined foldlevel".  The same is true with <code>0</code>.  I picked <code>-2</code> here
simply to make it obvious that it's <em>not</em> a foldlevel, but is instead an
"error".</p>
<p>If this feels weird to you, you can safely change the <code>-2</code> to a <code>-1</code> or a <code>0</code>.
It's just a coding style preference.</p>
<h2 id="finishing-the-fold-function">Finishing the Fold Function</h2>
<p>This is turning out to be quite a long chapter, so let's wrap up the folding
function.  Change <code>GetPotionFold</code> to look like this:</p>
<pre class="codehilite"><code class="language-vim">function! GetPotionFold(lnum)
    if getline(a:lnum) =~? '\v^\s*$'
        return '-1'
    endif

    let this_indent = IndentLevel(a:lnum)
    let next_indent = IndentLevel(NextNonBlankLine(a:lnum))

    if next_indent == this_indent
        return this_indent
    elseif next_indent &lt; this_indent
        return this_indent
    elseif next_indent &gt; this_indent
        return '&gt;' . next_indent
    endif
endfunction</code></pre>


<p>That's a lot of new code!  Let's step through it to see how it all works.</p>
<h3 id="blanks">Blanks</h3>
<p>First we have our check for blank lines.  Nothing's changed there.</p>
<p>If we get past that check we know we're looking at a non-blank line.</p>
<h3 id="finding-indentation-levels">Finding Indentation Levels</h3>
<p>Next we use our two helper functions to get the indent level of the current
line, and the indent level of the next non-blank line.</p>
<p>You might wonder what happens if <code>NextNonBlankLine</code> returns our error condition
of <code>-2</code>.  If that happens, <code>indent(-2)</code> will be run.  Running <code>indent()</code> on
a nonexistent line number will just return <code>-1</code>.  Go ahead and try it yourself
with <code>:echom indent(-2)</code>.</p>
<p><code>-1</code> divided by any <code>shiftwidth</code> larger than <code>1</code> will return <code>0</code>.  This may seem
like a problem, but it turns out that it won't be.  For now, don't worry about
it.</p>
<h3 id="equal-indents">Equal Indents</h3>
<p>Now that we have the indentation levels of the current line and the next
non-blank line, we can compare them and decide how to fold the current line.</p>
<p>Here's the <code>if</code> statement again:</p>
<pre class="codehilite"><code class="language-vim">if next_indent == this_indent
    return this_indent
elseif next_indent &lt; this_indent
    return this_indent
elseif next_indent &gt; this_indent
    return '&gt;' . next_indent
endif</code></pre>


<p>First we check if the two lines have the same indentation level.  If they do, we
simply return that indentation level as the foldlevel!</p>
<p>An example of this would be:</p>
<pre class="codehilite"><code class="language-text">a
b
    c
    d
e</code></pre>


<p>If we're looking at the line containing "c", it has an indentation level of 1.
This is the same as the level of the next non-blank line ("d"), so we return <code>1</code>
as the foldlevel.</p>
<p>If we're looking at "a", it has an indentation level of 0.  This is the same as
the level of the next non-blank line ("b"), so we return <code>0</code> as the foldlevel.</p>
<p>This case fills in two foldlevels in this simple example:</p>
<pre class="codehilite"><code class="language-text">a       0
b       ?
    c   1
    d   ?
e       ?</code></pre>


<p>By pure luck this also handles the special "error" case of the last line as
well!  Remember we said that <code>next_indent</code> will be <code>0</code> if our helper function
returns <code>-2</code>.</p>
<p>In this example the line "e" has an indent level of <code>0</code>, and <code>next_indent</code> will
also be set to <code>0</code>, so this case matches and returns <code>0</code>.  The foldlevels now
look like this:</p>
<pre class="codehilite"><code class="language-text">a       0
b       ?
    c   1
    d   ?
e       0</code></pre>


<h3 id="lesser-indent-levels">Lesser Indent Levels</h3>
<p>Once again, here's the <code>if</code> statement:</p>
<pre class="codehilite"><code class="language-vim">if next_indent == this_indent
    return this_indent
elseif next_indent &lt; this_indent
    return this_indent
elseif next_indent &gt; this_indent
    return '&gt;' . next_indent
endif</code></pre>


<p>The second part of the <code>if</code> checks if the indentation level of the next line is
<em>smaller</em> than the current line.  This would be like line "d" in our example.</p>
<p>If that's the case, we once again return the indentation level of the current
line.</p>
<p>Now our example looks like this:</p>
<pre class="codehilite"><code class="language-text">a       0
b       ?
    c   1
    d   1
e       0</code></pre>


<p>You could, of course, combine these two cases with <code>||</code>, but I prefer to keep
them separate to make it more explicit.  You might feel differently.  It's
a style issue.</p>
<p>Again, purely by luck, this case handles the other possible "error" case of our
helper function.  Imagine that we have a file like this:</p>
<pre class="codehilite"><code class="language-text">a
    b
    c</code></pre>


<p>The first case takes care of line "b":</p>
<pre class="codehilite"><code class="language-text">a       ?
    b   1
    c   ?</code></pre>


<p>Line "c" is the last line, and it has an indentation level of 1.  The
<code>next_indent</code> will be set to <code>0</code> thanks to our helper functions.  The second
part of the <code>if</code> matches and sets the foldlevel to the current indentation
level, or <code>1</code>:</p>
<pre class="codehilite"><code class="language-text">a       ?
    b   1
    c   1</code></pre>


<p>This works out great, because "b" and "c" will be folded together.</p>
<h3 id="greater-indentation-levels">Greater Indentation Levels</h3>
<p>Here's that tricky <code>if</code> statement for the last time:</p>
<pre class="codehilite"><code class="language-vim">if next_indent == this_indent
    return this_indent
elseif next_indent &lt; this_indent
    return this_indent
elseif next_indent &gt; this_indent
    return '&gt;' . next_indent
endif</code></pre>


<p>And our example file:</p>
<pre class="codehilite"><code class="language-text">a       0
b       ?
    c   1
    d   1
e       0</code></pre>


<p>The only line we haven't figured out is "b", because:</p>
<ul>
<li>"b" has an indent level of <code>0</code>.</li>
<li>"c" has an indent level of <code>1</code>.</li>
<li>1 is not equal to 0, nor is 1 less than 0.</li>
</ul>
<p>The last case checks if the next line has a <em>larger</em> indentation level than the
current one.</p>
<p>This is the case that Vim's <code>indent</code> folding gets wrong, and it's the entire
reason we're writing this custom folding in the first place!</p>
<p>The final case says that when the next line is indented more than the current
one, it should return a string of a <code>&gt;</code> character and the indentation level of
the <em>next</em> line.  What the heck is <em>that</em>?</p>
<p>Returning a string like <code>&gt;1</code> from the fold expression is another one of Vim's
"special" foldlevels.  It tells Vim that the current line should <em>open</em> a fold
of the given level.</p>
<p>In this simple example we could have just returned the number, but we'll see
why this is important shortly.</p>
<p>In this case line "b" will open a fold at level 1, which makes our example look
like this:</p>
<pre class="codehilite"><code class="language-text">a       0
b       &gt;1
    c   1
    d   1
e       0</code></pre>


<p>That's exactly what we want!  Hooray!</p>
<h2 id="review">Review</h2>
<p>If you've made it this far you should feel proud of yourself.  Even simple
folding code like this can be tricky and mind bending.</p>
<p>Before we end, let's go through our original <code>factorial.pn</code> code and see how our
folding expression fills in the foldlevels of its lines.</p>
<p>Here's <code>factorial.pn</code> for reference:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1
    n to 1 (i):
        # Multiply the running total.
        total *= i.
    total.

10 times (i):
    i string print
    '! is: ' print
    factorial (i) string print
    "\n" print.</code></pre>


<p>First, any blank lines' foldlevels will be set to undefined:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1
    n to 1 (i):
        # Multiply the running total.
        total *= i.
    total.
                                         undefined
10 times (i):
    i string print
    '! is: ' print
    factorial (i) string print
    "\n" print.</code></pre>


<p>Any lines where the next line's indentation is <em>equal</em> to its own are set to its
own level:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1                            1
    n to 1 (i):
        # Multiply the running total.    2
        total *= i.
    total.
                                         undefined
10 times (i):
    i string print                       1
    '! is: ' print                       1
    factorial (i) string print           1
    "\n" print.</code></pre>


<p>The same thing happens when the next line's indentation is <em>less</em> than the
current line's: </p>
<pre class="codehilite"><code class="language-text">factorial = (n):
    total = 1                            1
    n to 1 (i):
        # Multiply the running total.    2
        total *= i.                      2
    total.                               1
                                         undefined
10 times (i):
    i string print                       1
    '! is: ' print                       1
    factorial (i) string print           1
    "\n" print.                          1</code></pre>


<p>The last case is when the next line's indentation is <em>greater</em> than the current
line's.  When that happens the line's foldlevel is set to <em>open</em> a fold of the
<em>next</em> line's foldlevel:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):                         &gt;1
    total = 1                            1
    n to 1 (i):                          &gt;2
        # Multiply the running total.    2
        total *= i.                      2
    total.                               1
                                         undefined
10 times (i):                            &gt;1
    i string print                       1
    '! is: ' print                       1
    factorial (i) string print           1
    "\n" print.                          1</code></pre>


<p>Now we've got a foldlevel for every line in the file.  All that's left is for
Vim to resolve any undefined lines.</p>
<p>Earlier I said that undefined lines will take on the smallest foldlevel of
either of their neighbors.</p>
<p>That's how Vim's manual describes it, but it's not entirely accurate.  If that
were the case, the blank line in our file would take foldlevel 1, because both
of its neighbors have a foldlevel of 1.</p>
<p>In reality, the blank line will be given a foldlevel of 0!</p>
<p>The reason for this is that we didn't just set the <code>10 times (i):</code> line to
foldlevel <code>1</code> directly.  We told Vim that the line <em>opens</em> a fold of level <code>1</code>.
Vim is smart enough to know that this means the undefined line should be set to
<code>0</code> instead of <code>1</code>.</p>
<p>The exact logic of this is probably buried deep within Vim's source code.  In
general Vim behaves pretty intelligently when resolving undefined lines against
"special" foldlevels, so it will usually do what you want.</p>
<p>Once Vim's resolved the undefined line it has a complete description of how to
fold each line in the file, which looks like this:</p>
<pre class="codehilite"><code class="language-text">factorial = (n):                         1
    total = 1                            1
    n to 1 (i):                          2
        # Multiply the running total.    2
        total *= i.                      2
    total.                               1
                                         0
10 times (i):                            1
    i string print                       1
    '! is: ' print                       1
    factorial (i) string print           1
    "\n" print.                          1</code></pre>


<p>That's it, we're done!  Reload the folding code and play around with the fancy
new folding in <code>factorial.pn</code>.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help foldexpr</code>.</p>
<p>Read <code>:help fold-expr</code>.  Pay particular attention to all the "special" strings
your expression can return.</p>
<p>Read <code>:help getline</code>.</p>
<p>Read <code>:help indent()</code>.</p>
<p>Read <code>:help line()</code>.</p>
<p>Figure out why it's important that we use <code>.</code> to combine the <code>&gt;</code> character with
the number in our folding function.  What would happen if you used <code>+</code> instead?
Why?</p>
<p>We defined our helper functions as global functions, but that's not a good idea.
Change them to be script-local functions.</p>
<p>Put this book down and go outside for a while to let your brain recover from
this chapter.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="48.html">&laquo; Previous</a>
            
            
                <a class="next" href="50.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Section Movement Theory / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="50.html#section-movement-theory">Section Movement Theory</a><ul>
<li><a href="50.html#nroff-files">Nroff Files</a></li>
<li><a href="50.html#braces">Braces</a></li>
<li><a href="50.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="49.html">&laquo; Prev</a>
            
            
                <a class="next" href="51.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="section-movement-theory">Section Movement Theory</h1>
<p>If you've never used Vim's section movement commands (<code>[[</code>, <code>]]</code>, <code>[]</code> and <code>][</code>)
take a second and read the help for them now.  Go ahead and read <code>:help section</code>
as well.</p>
<p>Confused yet?  That's okay, so was I the first time I read that stuff.  We're
going to take a quick detour from writing code to learn about how these
movements work, and then in the next chapter we'll make our Potion plugin
support them.</p>
<h2 id="nroff-files">Nroff Files</h2>
<p>The four "section movement" commands are conceptually meant to move around
between "sections" of a file.</p>
<p>All of these commands are designed to work with <a href="http://en.wikipedia.org/wiki/Nroff">nroff files</a> by default.
Nroff is a language like LaTeX or Markdown -- it's used to write text that will
be reformatted later (it's actually the format used by UNIX man pages).</p>
<p>Nroff files use a certain set of "macros" to define "section headings".  For
example, here's an excerpt from the <code>awk</code> man page:</p>
<pre class="codehilite"><code class="language-nroff">.SH NAME                                                     ***
awk \- pattern-directed scanning and processing language
.SH SYNOPSIS                                                 ***
.B awk
[
.BI \-F
.I fs
]
[
.BI \-v
.I var=value
]
[
.I 'prog'
|
.BI \-f
.I progfile
]
[
.I file ...
]
.SH DESCRIPTION                                              ***
.I Awk
scans each input
.I file
for lines that match ...</code></pre>


<p>The lines starting with <code>.SH</code> are section headings.  I've marked them with
<code>***</code>.  The four section movement commands will move your cursor between these
section heading lines.</p>
<p>Vim considers any line starting with <code>.</code> and one of the nroff heading macros to
be a section header, <em>even when you're not editing an nroff file</em>!</p>
<p>You can change the macros by changing the <code>sections</code> setting, but Vim still
requires a period at the beginning of the line, and the macros must be pairs of
characters, so that setting doesn't add enough flexibility for Potion files.</p>
<h2 id="braces">Braces</h2>
<p>Section movement commands <em>also</em> look for one more thing: an opening or closing
curly brace (<code>{</code> or <code>}</code>) as the first character on a line.</p>
<p><code>[[</code> and <code>]]</code> look for opening braces, while <code>[]</code> and <code>][</code> look for closing
braces.</p>
<p>This extra "hack" allows you to move between sections of C-like languages
easily.  However, these rules are always the same no matter what type of file
you're in!</p>
<p>Put the following into a buffer:</p>
<pre class="codehilite"><code class="language-text">Test           A B
Test

.SH Hello      A B

Test

{              A
Test
}                B

Test

.H World       A B

Test
Test           A B</code></pre>


<p>Now run <code>:set filetype=basic</code> to tell Vim that this is a BASIC file, and try the
section movement comments.</p>
<p>The <code>[[</code> and <code>]]</code> commands will move between the lines marked <code>A</code>, while <code>[]</code>
and <code>][</code> move between the lines marked <code>B</code>.</p>
<p>This shows us that Vim always uses these same two rules for section movement,
even for languages where neither one makes sense (like BASIC)!</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help section</code> again, now that you know the story of section movement.</p>
<p>Read <code>:help sections</code> just for the fun of it.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="49.html">&laquo; Previous</a>
            
            
                <a class="next" href="51.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Potion Section Movement / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="51.html#potion-section-movement">Potion Section Movement</a><ul>
<li><a href="51.html#custom-mappings">Custom Mappings</a></li>
<li><a href="51.html#using-a-function">Using a Function</a></li>
<li><a href="51.html#base-movement">Base Movement</a></li>
<li><a href="51.html#top-level-text-sections">Top Level Text Sections</a></li>
<li><a href="51.html#search-flags">Search Flags</a></li>
<li><a href="51.html#function-definitions">Function Definitions</a></li>
<li><a href="51.html#visual-mode">Visual Mode</a></li>
<li><a href="51.html#why-bother">Why Bother?</a></li>
<li><a href="51.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="50.html">&laquo; Prev</a>
            
            
                <a class="next" href="52.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="potion-section-movement">Potion Section Movement</h1>
<p>Now that we know how section movement works, let's remap the commands to work
in a way that makes sense for Potion files.</p>
<p>First we need to decide what "section" should mean for a Potion file.  There are
two pairs of section movement commands, so we can come up with two "schemes" and
our users can use the one they prefer.</p>
<p>Let's use the following two schemes to define where Potion sections start:</p>
<ol>
<li>Any line following a blank line that contains non-whitespace as the first
   character, or the first line in the file.</li>
<li>Any line that contains non-whitespace as the first character, an equal sign
   somewhere inside the line, and ends with a colon.</li>
</ol>
<p>Using a slightly-expanded version of our sample <code>factorial.pn</code> file, here's
what these rules will consider to be section headers:</p>
<pre class="codehilite"><code class="language-text"># factorial.pn                              1
# Print some factorials, just for fun.

factorial = (n):                            1 2
    total = 1

    n to 1 (i):
        total *= i.

    total.

print_line = ():                            1 2
    "-=-=-=-=-=-=-=-\n" print.

print_factorial = (i):                      1 2
    i string print
    '! is: ' print
    factorial (i) string print
    "\n" print.

"Here are some factorials:\n\n" print       1

print_line ()                               1
10 times (i):
    print_factorial (i).
print_line ()</code></pre>


<p>Our first definition tends to be more liberal.  It defines a section to be
roughly a "top-level chunk of text".</p>
<p>The second definition is more restrictive.  It defines a section to be
(effectively) a function definition.</p>
<h2 id="custom-mappings">Custom Mappings</h2>
<p>Create a <code>ftplugin/potion/sections.vim</code> file in your plugin's repo.  This
is where we'll put the code for section movement.  Remember that this code will
be run whenever a buffer's <code>filetype</code> is set to <code>potion</code>.</p>
<p>We're going to remap all four section movement commands, so go ahead and create
a "skeleton" file:</p>
<pre class="codehilite"><code class="language-vim">noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; [[ &lt;nop&gt;
noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; ]] &lt;nop&gt;

noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; [] &lt;nop&gt;
noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; ][ &lt;nop&gt;</code></pre>


<p>Notice that we use <code>noremap</code> commands instead of <code>nnoremap</code>, because we want
these to work in operator-pending mode too.  That way you'll be able to do
things like <code>d]]</code> to "delete from here to the next section".</p>
<p>We make the mappings buffer-local so they'll only apply to Potion files and
won't take over globally.</p>
<p>We also make them silent, because the user won't care about the details of how
we move between sections.</p>
<h2 id="using-a-function">Using a Function</h2>
<p>The code for performing the section movements is going to be very similar for
all of the various commands, so let's abstract it into a function that our
mappings will call.</p>
<p>You'll see this strategy in a lot of Vim plugins that create a number of similar
mappings.  It's easier to read and maintain than stuffing all the functionality
in to a bunch of mapping lines.</p>
<p>Change the <code>sections.vim</code> file to contain this:</p>
<pre class="codehilite"><code class="language-vim">function! s:NextSection(type, backwards)
endfunction

noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; ]]
        \ :call &lt;SID&gt;NextSection(1, 0)&lt;cr&gt;

noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; [[
        \ :call &lt;SID&gt;NextSection(1, 1)&lt;cr&gt;

noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; ][
        \ :call &lt;SID&gt;NextSection(2, 0)&lt;cr&gt;

noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; []
        \ :call &lt;SID&gt;NextSection(2, 1)&lt;cr&gt;</code></pre>


<p>I used Vimscript's long line continuation feature here because the lines were
getting a bit long for my taste.  Notice how the backslash to escape long lines
comes at the <em>beginning</em> of the second line.  Read <code>:help line-continuation</code> for
more information.</p>
<p>Notice that we're using <code>&lt;SID&gt;</code> and a script-local function to avoid polluting
the global namespace with our helper function.</p>
<p>Each mapping simply calls <code>NextSection</code> with the appropriate arguments to
perform the movement.  Now we can start implementing <code>NextSection</code>.</p>
<h2 id="base-movement">Base Movement</h2>
<p>Let's think about what our function needs to do.  We want to move the cursor to
the next "section", and an easy way to move the cursor somewhere is with the <code>/</code>
and <code>?</code> commands.</p>
<p>Edit <code>NextSection</code> to look like this:</p>
<pre class="codehilite"><code class="language-vim">function! s:NextSection(type, backwards)
    if a:backwards
        let dir = '?'
    else
        let dir = '/'
    endif

    execute 'silent normal! ' . dir . 'foo' . "\r"
endfunction</code></pre>


<p>Now the function uses the <code>execute normal!</code> pattern we've seen before to perform
either <code>/foo</code> or <code>?foo</code>, depending on the value given for <code>backwards</code>.  This is
a good start.</p>
<p>Moving on, we're obviously going to need to search for something other than
<code>foo</code>, and that pattern is going to depend on whether we want to use the first
or second definition of section headings.</p>
<p>Change <code>NextSection</code> to look like this:</p>
<pre class="codehilite"><code class="language-vim">function! s:NextSection(type, backwards)
    if a:type == 1
        let pattern = 'one'
    elseif a:type == 2
        let pattern = 'two'
    endif

    if a:backwards
        let dir = '?'
    else
        let dir = '/'
    endif

    execute 'silent normal! ' . dir . pattern . "\r"
endfunction</code></pre>


<p>Now we just need to fill in the patterns, so let's go ahead and do that.</p>
<h2 id="top-level-text-sections">Top Level Text Sections</h2>
<p>Replace the first <code>let pattern = '...'</code> line with the following:</p>
<pre class="codehilite"><code class="language-vim">let pattern = '\v(\n\n^\S|%^)'</code></pre>


<p>To understand how the regular expression works, remember the definition of
"section" that we're implementing:</p>
<blockquote>
<p>Any line following a blank line that contains a non-whitespace as the first
character, or the first line in the file.</p>
</blockquote>
<p>The <code>\v</code> at the beginning simply forces "very magic" mode like we've seen
several times before.</p>
<p>The remainder of the regex is a group with two options.  The first, <code>\n\n^\S</code>,
searches for "a newline, followed by a newline, followed by a non-whitespace
character".  This finds the first set of lines in our definition.</p>
<p>The other option is <code>%^</code>, which is a special Vim regex atom that means
"beginning of file".</p>
<p>Now we're at a point where we can try out the first two mappings.  Save
<code>ftplugin/potion/sections.vim</code> and run <code>:set filetype=potion</code> in your sample
Potion buffer.  The <code>[[</code> and <code>]]</code> commands should work, but somewhat oddly.</p>
<h2 id="search-flags">Search Flags</h2>
<p>You'll notice that when you move between sections your cursor gets placed on the
blank line above the one we actually want to move to.  Think about why this
happens before reading on.</p>
<p>The answer is that we searched using <code>/</code> (or <code>?</code>) and by default Vim places your
cursor at the beginning of matches.  For example, when you run <code>/foo</code> your
cursor will be placed on the <code>f</code> in <code>foo</code>.</p>
<p>To tell Vim to put the cursor at the end of the match instead of the beginning,
we can use a search flag.  Try searching in your Potion file like so:</p>
<pre class="codehilite"><code class="language-vim">/factorial/e</code></pre>


<p>Vim will find the word <code>factorial</code> and move you to it.  Press <code>n</code> a few times to
move through the matches.  The <code>e</code> flag tells Vim to put the cursor at the end
of matches instead of the beginning.  Try it in the other direction too:</p>
<pre class="codehilite"><code class="language-vim">?factorial?e</code></pre>


<p>Let's modify our function to use a search flag to put our cursor on the other
end of the matches for this section:</p>
<pre class="codehilite"><code class="language-vim">function! s:NextSection(type, backwards)
    if a:type == 1
        let pattern = '\v(\n\n^\S|%^)'
        let flags = 'e'
    elseif a:type == 2
        let pattern = 'two'
        let flags = ''
    endif

    if a:backwards
        let dir = '?'
    else
        let dir = '/'
    endif

    execute 'silent normal! ' . dir . pattern . dir . flags . "\r"
endfunction</code></pre>


<p>We've changed two things here.  First, we set a <code>flags</code> variable depending on
the type of section movement.  For now we only worry about the first type, which
is going to need a flag of <code>e</code>.</p>
<p>Second, we've concatenated <code>dir</code> and <code>flags</code> to the search string.  This will
add <code>?e</code> or <code>/e</code> depending on which direction we're searching.</p>
<p>Save the file, switch back to your sample Potion file and run <code>:set ft=potion</code>
to make the changes take effect.  Now try <code>[[</code> and <code>]]</code> to see them working
properly!</p>
<h2 id="function-definitions">Function Definitions</h2>
<p>It's time to tackle our second definition of "section", and luckily this one is
much more straightforward than the first.  Recall the definition we need to
implement:</p>
<blockquote>
<p>Any line that contains a non-whitespace as the first character, an equal sign
somewhere inside the line, and ends with a colon.</p>
</blockquote>
<p>We can use a fairly simple regex to find these lines.  Change the second <code>let
pattern = '...'</code> line in the function to this:</p>
<pre class="codehilite"><code class="language-vim">let pattern = '\v^\S.*\=.*:$'</code></pre>


<p>This regex should look much less frightening than the last one.  I'll leave it
as an exercise for you to figure out how it works -- it's a pretty
straightforward translation of our definition.</p>
<p>Save the file, run <code>:set filetype=potion</code> in <code>factorial.pn</code>, and try out the new
<code>][</code> and <code>[]</code> mappings.  They should work as expected.</p>
<p>We don't need a search flag here because putting the cursor at the beginning of
the match (the default) works just fine.</p>
<h2 id="visual-mode">Visual Mode</h2>
<p>Our section movement commands work great in normal mode, but we need to add
a bit more to make them work in visual mode as well.  First, change the function
to look like this:</p>
<pre class="codehilite"><code class="language-vim">function! s:NextSection(type, backwards, visual)
    if a:visual
        normal! gv
    endif

    if a:type == 1
        let pattern = '\v(\n\n^\S|%^)' 
        let flags = 'e'
    elseif a:type == 2
        let pattern = '\v^\S.*\=.*:$'
        let flags = ''
    endif

    if a:backwards
        let dir = '?'
    else
        let dir = '/'
    endif

    execute 'silent normal! ' . dir . pattern . dir . flags . "\r"
endfunction</code></pre>


<p>Two things have changed.  First, the function takes an extra argument so it knows
whether it's being called from visual mode or not.  Second, if it's called from
visual mode we run <code>gv</code> to restore the visual selection.</p>
<p>Why do we need to do this?  Let's try something that will make it clear.
Visually select some text in any buffer and then run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom "hello"</code></pre>


<p>Vim will display <code>hello</code> but the visual selection will also be cleared!</p>
<p>When running an ex mode command with <code>:</code> the visual selection is always cleared.
The <code>gv</code> command reselects the previous visual selection, so this will "undo"
the clearing.  It's a useful command, and can be handy in your day-to-day work
too.</p>
<p>Now we need to update the existing mappings to pass <code>0</code> in for the new <code>visual</code>
argument:</p>
<pre class="codehilite"><code class="language-vim">noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; ]]
        \ :call &lt;SID&gt;NextSection(1, 0, 0)&lt;cr&gt;

noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; [[
        \ :call &lt;SID&gt;NextSection(1, 1, 0)&lt;cr&gt;

noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; ][
        \ :call &lt;SID&gt;NextSection(2, 0, 0)&lt;cr&gt;

noremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; []
        \ :call &lt;SID&gt;NextSection(2, 1, 0)&lt;cr&gt;</code></pre>


<p>Nothing too complex there.  Now let's add the visual mode mappings as the final
piece of the puzzle:</p>
<pre class="codehilite"><code class="language-vim">vnoremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; ]]
        \ :&lt;c-u&gt;call &lt;SID&gt;NextSection(1, 0, 1)&lt;cr&gt;

vnoremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; [[
        \ :&lt;c-u&gt;call &lt;SID&gt;NextSection(1, 1, 1)&lt;cr&gt;

vnoremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; ][
        \ :&lt;c-u&gt;call &lt;SID&gt;NextSection(2, 0, 1)&lt;cr&gt;

vnoremap &lt;script&gt; &lt;buffer&gt; &lt;silent&gt; []
        \ :&lt;c-u&gt;call &lt;SID&gt;NextSection(2, 1, 1)&lt;cr&gt;</code></pre>


<p>These mappings all pass <code>1</code> for the <code>visual</code> argument to tell Vim to reselect
the last selection before performing the movement.  They also use the <code>&lt;c-u&gt;</code>
trick we learned about in the Grep Operator chapters.</p>
<p>Save the file, <code>:set ft=potion</code> in the Potion file and you're done!  Give your
new mappings a try.  Things like <code>v]]</code> and <code>d[]</code> should all work properly now.</p>
<h2 id="why-bother">Why Bother?</h2>
<p>This has been a long chapter for some seemingly small functionality, but you've
learned and practiced a lot of useful things along the way:</p>
<ul>
<li>Using <code>noremap</code> instead of <code>nnoremap</code> to create mappings that work as
  movements and motions.</li>
<li>Using a single function with several arguments to simplify creating related
  mappings.</li>
<li>Building up functionality in a Vimscript function incrementally.</li>
<li>Building up an <code>execute 'normal! ...'</code> string programmatically.</li>
<li>Using simple searches to move around with regexes.</li>
<li>Using special regex atoms like <code>%^</code> (beginning of file).</li>
<li>Using search flags to modify how searches work.</li>
<li>Handling visual mode mappings that need to retain the visual selection.</li>
</ul>
<p>Go ahead and do the exercises (it's just a bit of <code>:help</code> reading) and then grab
some ice cream.  You've earned it after this chapter!</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help search()</code>.  This is a useful function to know, but you can also use
the flags listed with the <code>/</code> and <code>?</code> commands.</p>
<p>Read <code>:help ordinary-atom</code> to learn about more interesting things you can use in
search patterns.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="50.html">&laquo; Previous</a>
            
            
                <a class="next" href="52.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>External Commands / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="52.html#external-commands">External Commands</a><ul>
<li><a href="52.html#compiling">Compiling</a></li>
<li><a href="52.html#bang">Bang!</a></li>
<li><a href="52.html#displaying-bytecode">Displaying Bytecode</a></li>
<li><a href="52.html#system">system()</a></li>
<li><a href="52.html#scratch-splits">Scratch Splits</a></li>
<li><a href="52.html#exercises">Exercises</a></li>
<li><a href="52.html#extra-credit">Extra Credit</a></li>
<li><a href="52.html#more-extra-credit">More Extra Credit</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="51.html">&laquo; Prev</a>
            
            
                <a class="next" href="53.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="external-commands">External Commands</h1>
<p>Vim follows the UNIX philosophy of "do one thing well".  Instead of trying to
cram all the functionality you could ever want inside the editor itself, the
right way to use Vim is to delegate to external commands when appropriate.</p>
<p>Let's add some interaction with the Potion compiler to our plugin to get our
feet wet with external commands in Vim.</p>
<h2 id="compiling">Compiling</h2>
<p>First we'll add a command to compile and run the current Potion file.  There are
a number of ways to do this, but we'll simply use an external command for now.</p>
<p>Create a <code>potion/ftplugin/potion/running.vim</code> file in your plugin's repo.  This
is where we'll create the mappings for compiling and running Potion files.</p>
<pre class="codehilite"><code class="language-vim">if !exists("g:potion_command")
    let g:potion_command = "potion"
endif

function! PotionCompileAndRunFile()
    silent !clear
    execute "!" . g:potion_command . " " . bufname("%")
endfunction

nnoremap &lt;buffer&gt; &lt;localleader&gt;r :call PotionCompileAndRunFile()&lt;cr&gt;</code></pre>


<p>The first chunk stores the command used to execute Potion in a global variable,
if that variable isn't already set.  We've seen this kind of check before.</p>
<p>This will allow users to override it if <code>potion</code> isn't in their <code>$PATH</code> by
putting a line like <code>let g:potion_command = "/Users/sjl/src/potion/potion"</code> in
their <code>~/.vimrc</code> file.</p>
<p>The last line adds a buffer-local mapping that calls a function we've defined
above.  Remember that because this file is in the <code>ftdetect/potion</code> directory it
will be run every time a file's <code>filetype</code> is set to <code>potion</code>.</p>
<p>The real functionality is in the <code>PotionCompileAndRunFile()</code> function.  Go ahead
and save this file, open up <code>factorial.pn</code> and press <code>&lt;localleader&gt;r</code> to run the
mapping and see what happens.</p>
<p>If <code>potion</code> is in your <code>$PATH</code>, the file should be run and you should see its
output in your terminal (or at the bottom of the window if you're using a GUI
Vim).  If you get an error about the <code>potion</code> command not being found, you'll
need to set <code>g:potion_command</code> in your <code>~/.vimrc</code> file as mentioned above.</p>
<p>Let's take a look at how <code>PotionCompileAndRunFile()</code> function works.</p>
<h2 id="bang">Bang!</h2>
<p>The <code>:!</code> command (pronounced "bang") in Vim runs external commands and displays
their output on the screen.  Try it out by running the following command:</p>
<pre class="codehilite"><code class="language-vim">:!ls</code></pre>


<p>Vim should show you the output of the <code>ls</code> command, as well as a "Press ENTER or
type command to continue" prompt.</p>
<p>Vim doesn't pass any input to the command when run this way.  Confirm this by
running:</p>
<pre class="codehilite"><code class="language-vim">:!cat</code></pre>


<p>Type a few lines and you'll see that the <code>cat</code> command spits them back out, just
as it normally would if you ran <code>cat</code> outside of Vim.  Use Ctrl-D to finish.</p>
<p>To run an external command without the <code>Press ENTER or type command to continue</code>
prompt, use <code>:silent !</code>.  Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:silent !echo Hello, world.</code></pre>


<p>If you run this in a GUI Vim like MacVim or gVim, you won't see the <code>Hello,
world.</code> output of the command.</p>
<p>If you run it in a terminal Vim, your results may vary depending on your
configuration.  You may need to run <code>:redraw!</code> to fix your screen after running
a bare <code>:silent !</code>.</p>
<p>Note that this command is <code>:silent !</code> and not <code>:silent!</code> (see the space?)!
Those are two different commands, and we want the former!  Isn't Vimscript
great?</p>
<p>Let's look back at the <code>PotionCompileAndRun()</code> function:</p>
<pre class="codehilite"><code class="language-vim">function! PotionCompileAndRunFile()
    silent !clear
    execute "!" . g:potion_command . " " . bufname("%")
endfunction</code></pre>


<p>First we run a <code>silent !clear</code> command, which should clear the screen without
a <code>Press ENTER...</code> prompt.  This will make sure we only see the output of this
run, which is helpful when you're running the same commands over and over.</p>
<p>The next line uses our old friend <code>execute</code> to build a command dynamically.  The
command it builds will look something like this:</p>
<pre class="codehilite"><code class="language-text">!potion factorial.pn</code></pre>


<p>Notice that there's no <code>silent</code> here, so the user will see the output of the
command and will have to press enter to go back to Vim.  This is what we want
for this particular mapping, so we're all set.</p>
<h2 id="displaying-bytecode">Displaying Bytecode</h2>
<p>The Potion compiler has an option that will let you view the bytecode it
generates as it compiles.  This can be handy if you're trying to debug your
program at a very low level.  Try it out by running the following command at
a shell prompt:</p>
<pre class="codehilite"><code class="language-text">potion -c -V factorial.pn</code></pre>


<p>You should see a lot of output that looks like this:</p>
<pre class="codehilite"><code class="language-text">-- parsed --
code ...
-- compiled --
; function definition: 0x109d6e9c8 ; 108 bytes
; () 3 registers
.local factorial ; 0
.local print_line ; 1
.local print_factorial ; 2
...
[ 2] move     1 0
[ 3] loadk    0 0   ; string
[ 4] bind     0 1
[ 5] loadpn   2 0   ; nil
[ 6] call     0 2
...</code></pre>


<p>Let's add a mapping that will let the user view the bytecode generated for the
current Potion file in a Vim split so they can easily navigate and examine it.</p>
<p>First, add the following line to the bottom of <code>ftplugin/potion/running.vim</code>:</p>
<pre class="codehilite"><code class="language-vim">nnoremap &lt;buffer&gt; &lt;localleader&gt;b :call PotionShowBytecode()&lt;cr&gt;</code></pre>


<p>Nothing special there -- it's just a simple mapping.  Now let's sketch out the
function that will do the work:</p>
<pre class="codehilite"><code class="language-vim">function! PotionShowBytecode()
    " Get the bytecode.

    " Open a new split and set it up.

    " Insert the bytecode.

endfunction</code></pre>


<p>Now that we've got a little skeleton set up, let's talk about how to make it
happen.</p>
<h2 id="system">system()</h2>
<p>There are a number of ways we could implement this, so I'll choose one that will
come in handy later for you.</p>
<p>Run the following command:</p>
<pre class="codehilite"><code class="language-vim">:echom system("ls")</code></pre>


<p>You should see the output of the <code>ls</code> command at the bottom of your screen.  If
you run <code>:messages</code> you'll see it there too.  The <code>system()</code> Vim function takes
a command string as a parameter and returns the output of that command as
a String.</p>
<p>You can pass a second string as an argument to <code>system()</code>.  Run the following
command:</p>
<pre class="codehilite"><code class="language-vim">:echom system("wc -c", "abcdefg")</code></pre>


<p>Vim will display <code>7</code> (with some padding).  If you pass a second argument like
this, Vim will write it to a temporary file and pipe it into the command on
standard input.  For our purposes we won't need this, but it's good to know.</p>
<p>Back to our function.  Edit <code>PotionShowBytecode()</code> to fill out the first part of
the skeleton like this:</p>
<pre class="codehilite"><code class="language-vim">function! PotionShowBytecode()
    " Get the bytecode.
    let bytecode = system(g:potion_command . " -c -V " . bufname("%"))
    echom bytecode

    " Open a new split and set it up.

    " Insert the bytecode.

endfunction</code></pre>


<p>Go ahead and try it out by saving the file, running <code>:set ft=potion</code> in
<code>factorial.pn</code> to reload it, and using the <code>&lt;localleader&gt;b</code> mapping.  Vim should
display the bytecode at the bottom of the screen.  Once you can see it's working
you can remove the <code>echom</code> line.</p>
<h2 id="scratch-splits">Scratch Splits</h2>
<p>Next we're going to open up a new split window for the user to show the results.
This will let the user view and navigate the bytecode with all the power of Vim,
instead of just reading it once from the screen.</p>
<p>To do this we're going to create a "scratch" split: a split containing a buffer
that's never going to be saved and will be overwritten each time we run the
mapping.  Change the <code>PotionShowBytecode()</code> function to look like this:</p>
<pre class="codehilite"><code class="language-vim">function! PotionShowBytecode()
    " Get the bytecode.
    let bytecode = system(g:potion_command . " -c -V " . bufname("%"))

    " Open a new split and set it up.
    vsplit __Potion_Bytecode__
    normal! ggdG
    setlocal filetype=potionbytecode
    setlocal buftype=nofile

    " Insert the bytecode.

endfunction</code></pre>


<p>These new command should be pretty easy to follow.</p>
<p><code>vsplit</code> creates a new vertical split for a buffer named <code>__Potion_Bytecode__</code>.
We surround the name with underscores to make it clearer to the user that this
isn't a normal file (it's a buffer just to hold the output).  The underscores
aren't special, they're just a convention.</p>
<p>Next we delete everything in this buffer with <code>normal! ggdG</code>.  The first time
the mapping is run this won't do anything, but subsequent times we'll be reusing
the <code>__Potion_Bytecode__</code> buffer, so this clears it.</p>
<p>Next we prepare the buffer by setting two local settings.  First we set its
filetype to <code>potionbytecode</code>, just to make it clear what it's holding.  We also
change the <code>buftype</code> setting to <code>nofile</code>, which tells Vim that this buffer isn't
related to a file on disk and so it should never try to write it.</p>
<p>All that's left is to dump the bytecode that we saved into the <code>bytecode</code>
variable into this buffer.  Finish off the function by making it look like this:</p>
<pre class="codehilite"><code class="language-vim">function! PotionShowBytecode()
    " Get the bytecode.
    let bytecode = system(g:potion_command . " -c -V " . bufname("%") . " 2&gt;&amp;1")

    " Open a new split and set it up.
    vsplit __Potion_Bytecode__
    normal! ggdG
    setlocal filetype=potionbytecode
    setlocal buftype=nofile

    " Insert the bytecode.
    call append(0, split(bytecode, '\v\n'))
endfunction</code></pre>


<p>The <code>append()</code> Vim function takes two arguments: a line number to append after,
and a list of Strings to append as lines.  For example, try running the
following command:</p>
<pre class="codehilite"><code class="language-vim">:call append(3, ["foo", "bar"])</code></pre>


<p>This will append two lines, <code>foo</code> and <code>bar</code>, below line 3 in your current
buffer.  In this case we're appending below line 0, which means "at the top of
the file".</p>
<p>We need a list of Strings to append, but we just have a single string with
newline characters embedded in it from when we used <code>system()</code>.  We use Vim's
<code>split()</code> function to split that giant hunk of text into a list of Strings.
<code>split()</code> takes a String to split and a regular expression to find the split
points.  It's pretty simple.</p>
<p>Now that the function is complete, go ahead and try out the mapping.  When you
run <code>&lt;localleader&gt;b</code> in the <code>factorial.pn</code> buffer Vim will open a new buffer
containing the Potion bytecode.  Play around with it by changing the source,
saving the file, and running the mapping again to see the bytecode change.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help bufname</code>.</p>
<p>Read <code>:help buftype</code>.</p>
<p>Read <code>:help append()</code>.</p>
<p>Read <code>:help split()</code>.</p>
<p>Read <code>:help :!</code>.</p>
<p>Read <code>:help :read</code> and <code>:help :read!</code> (we didn't cover these commands, but
they're extremely useful).</p>
<p>Read <code>:help system()</code>.</p>
<p>Read <code>:help design-not</code>.</p>
<p>Currently our mappings require that the user save the file themselves before
running the mapping in order for their changes to take effect.  Undo is cheap
these days, so edit the functions we wrote to save the current file for them.</p>
<p>What happens when you run the bytecode mapping on a Potion file with a syntax
error?  Why does that happen?</p>
<p>Change the <code>PotionShowBytecode()</code> function to detect when the Potion compiler
returns an error, and show an error message to the user.</p>
<h2 id="extra-credit">Extra Credit</h2>
<p>Each time you run the bytecode mapping a new vertical split will be created,
even if the user hasn't closed the previous one.  If the user doesn't bother
closing them they could end up with many extra windows stacked up.</p>
<p>Change <code>PotionShowBytecode()</code> to detect with a window is already open for the
<code>__Potion_Bytecode__</code> buffer, and when that's the case switch to it instead of
creating a new split.</p>
<p>You'll probably want to read <code>:help bufwinnr()</code> for this one.</p>
<h2 id="more-extra-credit">More Extra Credit</h2>
<p>Remember how we set the <code>filetype</code> of the temporary buffer to <code>potionbytecode</code>?
Create a <code>syntax/potionbytecode.vim</code> file and define syntax highlighting for
Potion bytecode buffers to make them easier to read.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="51.html">&laquo; Previous</a>
            
            
                <a class="next" href="53.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Autoloading / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="53.html#autoloading">Autoloading</a><ul>
<li><a href="53.html#how-autoload-works">How Autoload Works</a></li>
<li><a href="53.html#experimenting">Experimenting</a></li>
<li><a href="53.html#what-to-autoload">What to Autoload</a></li>
<li><a href="53.html#adding-autoloading-to-the-potion-plugin">Adding Autoloading to the Potion Plugin</a></li>
<li><a href="53.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="52.html">&laquo; Prev</a>
            
            
                <a class="next" href="54.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="autoloading">Autoloading</h1>
<p>We've written a fair amount of functionality for our Potion plugin, and that's
all we're going to do in this book.  Before we finish we'll talk about a few
more important ways to polish it up and really make it shine.</p>
<p>First on the list is making our plugin more efficient with autoloading.</p>
<h2 id="how-autoload-works">How Autoload Works</h2>
<p>Currently when a user loads our plugin (by opening a Potion file) <em>all</em> of its
functionality is loaded.  Our plugin is still small so this probably isn't a big
deal, but for larger plugins loading all of their code can take a noticeable
amount of time.</p>
<p>Vim's solution to this is something called "autoload".  Autoload lets you delay
loading code until it's actually needed.  You'll take a slight performance hit
overall, but if your users don't always use every single bit of code in your
plugin autoloading can be a huge speedup.</p>
<p>Here's how it works.  Look at the following command:</p>
<pre class="codehilite"><code class="language-vim">:call somefile#Hello()</code></pre>


<p>When you run this command, Vim will behave a bit differently than a normal
function call.</p>
<p>If this function has already been loaded, Vim will simply call it normally.</p>
<p>Otherwise Vim will look for a file called <code>autoload/somefile.vim</code> in your
<code>~/.vim</code> directory (and any Pathogen bundles).</p>
<p>If this file exists, Vim will load/source the file.  It will then try to call
the function normally.</p>
<p>Inside this file, the function should be defined like this:</p>
<pre class="codehilite"><code class="language-vim">function somefile#Hello()
    " ...
endfunction</code></pre>


<p>You can use multiple <code>#</code> characters in the function name to represent
subdirectories.  For example:</p>
<pre class="codehilite"><code class="language-vim">:call myplugin#somefile#Hello()</code></pre>


<p>This will look for the autoloaded file at <code>autoload/myplugin/somefile.vim</code>.  The
function inside it needs to be defined with the full autoload path:</p>
<pre class="codehilite"><code class="language-vim">function myplugin#somefile#Hello()
    " ...
endfunction</code></pre>


<h2 id="experimenting">Experimenting</h2>
<p>To get a feel for how this works, let's give it a try.  Create
a <code>~/.vim/autoload/example.vim</code> file and add the following to it:</p>
<pre class="codehilite"><code class="language-vim">echom "Loading..."

function! example#Hello()
    echom "Hello, world!"
endfunction

echom "Done loading."</code></pre>


<p>Save the file and run <code>:call example#Hello()</code>.  Vim will output the following:</p>
<pre class="codehilite"><code class="language-text">Loading...
Done loading.
Hello, world!</code></pre>


<p>This little demonstration proves a few things:</p>
<ol>
<li>Vim really does load the <code>example.vim</code> file on the fly.  It didn't even exist
   when we opened Vim, so it couldn't have been loaded on startup!</li>
<li>When Vim finds the file it needs to autoload, it loads the entire file before
   actually calling the function.</li>
</ol>
<p><strong>Without closing Vim</strong>, change the definition of the function to look like
this:</p>
<pre class="codehilite"><code class="language-vim">echom "Loading..."

function! example#Hello()
    echom "Hello AGAIN, world!"
endfunction

echom "Done loading."</code></pre>


<p>Save the file and <strong>without closing Vim</strong> run <code>:call example#Hello()</code>.  Vim will
simply output:</p>
<pre class="codehilite"><code class="language-text">Hello, world!</code></pre>


<p>Vim already has a definition for <code>example#Hello</code>, so it doesn't need to reload
the file, which means:</p>
<ol>
<li>The code outside the function wasn't run again.</li>
<li>It didn't pick up the changes to the function.</li>
</ol>
<p>Now run <code>:call example#BadFunction()</code>.  You'll see the loading messages again,
as well as an error about a nonexistent function.  But now try running <code>:call
example#Hello()</code> again.  This time you'll see the updated message!</p>
<p>By now you should have a pretty clear grip on what happens when Vim encounters
a call to a function with an autoload-style name:</p>
<ol>
<li>It checks to see if it has a function by that name defined already.  If so,
   just call it.</li>
<li>Otherwise, find the appropriate file (based on the name) and source it.</li>
<li>Then attempt to call the function.  If it works, great. If it fails, just
   print an error.</li>
</ol>
<p>If that's not completely solid in your mind yet, go back and work through this
demonstration again and try to see where each rule takes effect.</p>
<h2 id="what-to-autoload">What to Autoload</h2>
<p>Autoloading isn't free.  There's some (small) overhead involved with setting it
up, not to mention the ugly function names you need to sprinkle through your
code.</p>
<p>With that said, if you're creating a plugin that won't be used <em>every</em> time
a user opens a Vim session it's probably a good idea to move as much
functionality into autoloaded files as possible.  This will reduce the impact
your plugin has on your users' startup times, which is important as people
install more and more Vim plugins.</p>
<p>So what kind of things can be safely autoloaded?  The answer is basically
anything that's not directly called by your users.  Mappings and custom commands
can't be autoloaded (because they wouldn't be available for the users to call),
but many other things can be.</p>
<p>Let's look at our Potion plugin and see what we can autoload.</p>
<h2 id="adding-autoloading-to-the-potion-plugin">Adding Autoloading to the Potion Plugin</h2>
<p>We'll start with the compile and run functionality.  Remember that our
<code>ftplugin/potion/running.vim</code> file looked like this at the end of the previous
chapter:</p>
<pre class="codehilite"><code class="language-vim">if !exists("g:potion_command")
    let g:potion_command = "potion"
endif

function! PotionCompileAndRunFile()
    silent !clear
    execute "!" . g:potion_command . " " . bufname("%")
endfunction

function! PotionShowBytecode()
    " Get the bytecode.
    let bytecode = system(g:potion_command . " -c -V " . bufname("%"))

    " Open a new split and set it up.
    vsplit __Potion_Bytecode__
    normal! ggdG
    setlocal filetype=potionbytecode
    setlocal buftype=nofile

    " Insert the bytecode.
    call append(0, split(bytecode, '\v\n'))
endfunction

nnoremap &lt;buffer&gt; &lt;localleader&gt;r :call PotionCompileAndRunFile()&lt;cr&gt;
nnoremap &lt;buffer&gt; &lt;localleader&gt;b :call PotionShowBytecode()&lt;cr&gt;</code></pre>


<p>This file is already only called when a Potion file is loaded, so it doesn't add
to the overhead of Vim's startup in general.  But there may be some users who
simply don't need this functionality, so if we can autoload some of it we'll
save them a few milliseconds every time they open a Potion file.</p>
<p>Yes, in this case the savings won't be huge.  But I'm sure you can imagine
a plugin with many thousands of lines of functions where the time required to
load them would be more significant.</p>
<p>Let's get started.  Create an <code>autoload/potion/running.vim</code> file in your plugin
repo.  Then move the two functions into it and adjust their names, so they look
like this:</p>
<pre class="codehilite"><code class="language-vim">echom "Autoloading..."

function! potion#running#PotionCompileAndRunFile()
    silent !clear
    execute "!" . g:potion_command . " " . bufname("%")
endfunction

function! potion#running#PotionShowBytecode()
    " Get the bytecode.
    let bytecode = system(g:potion_command . " -c -V " . bufname("%"))

    " Open a new split and set it up.
    vsplit __Potion_Bytecode__
    normal! ggdG
    setlocal filetype=potionbytecode
    setlocal buftype=nofile

    " Insert the bytecode.
    call append(0, split(bytecode, '\v\n'))
endfunction</code></pre>


<p>Notice how the <code>potion#running</code> portion of the function names matches the
directory and file name where they live.  Now change the
<code>ftplugin/potion/running.vim</code> file to look like this:</p>
<pre class="codehilite"><code class="language-vim">if !exists("g:potion_command")
    let g:potion_command = "potion"
endif

nnoremap &lt;buffer&gt; &lt;localleader&gt;r
            \ :call potion#running#PotionCompileAndRunFile()&lt;cr&gt;

nnoremap &lt;buffer&gt; &lt;localleader&gt;b
            \ :call potion#running#PotionShowBytecode()&lt;cr&gt;</code></pre>


<p>Save the files, close Vim, and open up your <code>factorial.pn</code> file.  Try using the
mappings to make sure they still work properly.</p>
<p>Make sure that you see the diagnostic <code>Autoloading...</code> message only the first
time you run one of the mappings (you may need to use <code>:messages</code> to see it).
Once you confirm that autoloading is working properly you can remove that
message.</p>
<p>As you can see, we've left the <code>nnoremap</code> calls that map the keys.  We can't
autoload these because the user would have no way to initiate the autoloading if
we did!</p>
<p>This is a common pattern you'll see in Vim plugins: most of their functionality
will be held in autoloaded functions, with just <code>nnoremap</code> and <code>command</code>
commands in the files that Vim loads every time.  Keep it in mind whenever
you're writing a non-trivial Vim plugin.</p>
<h2 id="exercises">Exercises</h2>
<p>Read <code>:help autoload</code>.</p>
<p>Experiment a bit and find out how autoloading variables behaves.</p>
<p>Suppose you wanted to programatically force a reload of an autoload file Vim has
already loaded, without bothering the user.  How might you do this?  You may
want to read <code>:help :silent</code>.  Please don't ever do this in real life.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="52.html">&laquo; Previous</a>
            
            
                <a class="next" href="54.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Documentation / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="54.html#documentation">Documentation</a><ul>
<li><a href="54.html#how-documentation-works">How Documentation Works</a></li>
<li><a href="54.html#help-header">Help Header</a></li>
<li><a href="54.html#what-to-document">What to Document</a></li>
<li><a href="54.html#table-of-contents">Table of Contents</a></li>
<li><a href="54.html#sections">Sections</a></li>
<li><a href="54.html#examples">Examples</a></li>
<li><a href="54.html#write">Write!</a></li>
<li><a href="54.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="53.html">&laquo; Prev</a>
            
            
                <a class="next" href="55.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="documentation">Documentation</h1>
<p>Our Potion plugin has a bunch of useful functionality in it, but it won't be
really useful to anyone unless we document it so they know what it can do!</p>
<p>Vim's own documentation is superb.  It's not overly wordy, but it's extremely
thorough.  It's also inspired many plugin authors to document their own plugins
very well, which has resulted in a wonderful culture of strong documentation in
the Vimscript community.</p>
<h2 id="how-documentation-works">How Documentation Works</h2>
<p>When you read a <code>:help</code> topic in Vim you've surely noticed that some things are
highlighted differently than others.  Let's take a look at how this works.</p>
<p>Open up any help topic (such as <code>:help help</code>) and run <code>:set filetype?</code>.  Vim
will display <code>filetype=help</code>.  Now run <code>:set filetype=text</code>, and you'll see that
the highlighting goes away.  <code>:set filetype=help</code> again and it will come back.</p>
<p>It turns out that Vim help files are simply syntax-highlighted text files like
any other file format!  This means you can write your own and get the same
highlighting.</p>
<p>Create a file called <code>doc/potion.txt</code> in your plugin repo.  Vim/Pathogen looks
for files inside <code>doc</code> folders when indexing help topics, so this is where we'll
write the help for our plugin.</p>
<p>Open this file in Vim and run <code>:set filetype=help</code> so you can see the syntax
highlighting as you type.</p>
<h2 id="help-header">Help Header</h2>
<p>The format of help files is a matter of personal taste.  With that said, I'll
talk about one way to structure them that seems to be popular with the modern
Vimscript community.</p>
<p>The first line of the file should contain the filename of the help file,
followed by a one-line description of what the plugin does.  Add the following
as the first line of your <code>potion.txt</code> file:</p>
<pre class="codehilite"><code class="language-text">*potion.txt* functionality for the potion programming language</code></pre>


<p>Surrounding a word with asterisks in a help file creates a "tag" that can be
jumped to.  Run <code>:Helptags</code> to tell Pathogen to rebuild the index of help tags,
and then open a new Vim window and run <code>:help potion.txt</code>.  Vim will open your
help document like any other one.</p>
<p>Next you should put the title of your plugin along with a longer description.
Some authors (including me) like to have a bit of fun with this and use some
ASCII art to spice things up.  Add a nice title section to the <code>potion.txt</code>
file:</p>
<pre class="codehilite"><code class="language-text">*potion.txt* functionality for the potion programming language

                      ___      _   _              ~
                     / _ \___ | |_(_) ___  _ __   ~
                    / /_)/ _ \| __| |/ _ \| '_ \  ~
                   / ___/ (_) | |_| | (_) | | | | ~
                   \/    \___/ \__|_|\___/|_| |_| ~

          Functionality for the Potion programming language.
        Includes syntax highlighting, code folding, and more!</code></pre>


<p>I got those fun letters by running the <code>figlet -f ogre "Potion"</code> command.
<a href="http://www.figlet.org/">Figlet</a> is a great little program for generating ASCII art text.  The <code>~</code>
characters at the end of the lines ensure that Vim doesn't try to highlight or
hide individual characters inside the art.</p>
<h2 id="what-to-document">What to Document</h2>
<p>Next usually comes a table of contents.  First, though, let's decide what we
actually want to document.</p>
<p>When writing documentation for a new plugin I usually start with the following
list of sections and work from there:</p>
<ul>
<li>Introduction</li>
<li>Usage</li>
<li>Mappings</li>
<li>Configuration</li>
<li>License</li>
<li>Bugs</li>
<li>Contributing</li>
<li>Changelog</li>
<li>Credits</li>
</ul>
<p>If the plugin is large and requires an "overview" I'll write an introductory
section that summarizes how things work.  Otherwise I'll skip that and just move
on.</p>
<p>A "usage" section should explain in, general, how the user will actually <em>use</em>
your plugin.  If they'll interact with it through mappings, tell them that.  If
there aren't too many mappings you can simply list them here, otherwise you may
want to create a separate "mappings" section that lists them all.</p>
<p>The "configuration" section should list each and every user-modifiable variable,
along with its effects and its default value.</p>
<p>The "license" section should specify what license the plugin's code is under, as
well as a URL where the user can find the full text of that license.  Don't
include the full text in the actual help file -- most users know what the common
licenses mean and it just clutters things up.</p>
<p>The "bugs" section should be short and sweet.  List any major bugs that you're
aware of but haven't gotten around to fixing, and tell the user how they can
report new bugs they find to you.</p>
<p>If you want your users to be able to contribute bug fixes and features for the
plugin back to you, they'll need to know how to do it.  Should they send a pull
request on GitHub?  On Bitbucket?  Send a patch in an email?  Any/all of the
above?  Include a "contributing" section makes it clear how you prefer to
receive code.</p>
<p>A changelog is a wonderful thing to include so that when users update your
plugin from version X to version Y they can immediately see what changed.  Also,
I highlight recommend you pick a sane versioning scheme like <a href="http://semver.org/">Semantic
Versioning</a> for your plugin and stick to it.  Your users will thank you.</p>
<p>Finally, I like to include a "credits" section to mention my own name, list
other plugins that this one was inspired by, thank contributors, and so on.</p>
<p>This is usually a good starting point.  For more unique plugins you may feel the
need to deviate from this list, and that's completely fine.  There are no hard
and fast rules except the following:</p>
<ul>
<li>Be thorough.</li>
<li>Don't be too wordy.</li>
<li>Take the user on a journey from having no idea what your plugin is to being an
  expert user of it.</li>
</ul>
<h2 id="table-of-contents">Table of Contents</h2>
<p>Now that we have an idea of what sections we'll include, add the following to
the <code>potion.txt</code> file:</p>
<pre class="codehilite"><code class="language-text">====================================================================
CONTENTS                                            *PotionContents*

    1. Usage ................ |PotionUsage|
    2. Mappings ............. |PotionMappings|
    3. License .............. |PotionLicense|
    4. Bugs ................. |PotionBugs|
    5. Contributing ......... |PotionContributing|
    6. Changelog ............ |PotionChangelog|
    7. Credits .............. |PotionCredits|</code></pre>


<p>There are a couple things to note here.  First, the line of <code>=</code> characters will
be syntax highlighted.  You can use these lines to visually divide up sections
of your help document.  You can also use lines of <code>-</code> characters for
subsections, if you want.</p>
<p>The <code>*PotionContents*</code> will create another tag, so a user can type <code>:help
PotionContents</code> to go directly to the table of contents.</p>
<p>Each of the words surrounded by <code>|</code> characters creates a link to a tag.  Users
can place their cursor on the word in the help file and press <code>&lt;c-]&gt;</code> to jump to
the tag, just as if they had typed <code>:help TheTag</code>.  They can also click them
with their mouse.</p>
<p>Vim will hide these <code>*</code> and <code>|</code> characters and syntax highlight them, so the
result will be a nice, pretty table of contents people can use to get to what
they're looking for.</p>
<h2 id="sections">Sections</h2>
<p>You can create section headers like this:</p>
<pre class="codehilite"><code class="language-text">====================================================================
Section 1: Usage                                       *PotionUsage*

This plugin with automatically provide syntax highlighting for
Potion files (files ending in .pn).

It also...</code></pre>


<p>Make sure to create the correct tags with the <code>*</code> characters so that all the
links in your table of contents work properly.</p>
<p>Go ahead and create headers for each section in the table of contents.</p>
<h2 id="examples">Examples</h2>
<p>I could try to go over all the syntax of help files and how to use it, but it's
really a matter of taste.  So instead I'll give you a list of several Vim
plugins with extensive documentation.</p>
<p>For each one, copy the raw source of the documentation into a Vim buffer and set
its filetype to <code>help</code> to see how it renders.  Switch back to <code>text</code> when you
want to see how an effect was created.</p>
<p>You may find it useful to use your Vimscript skills create a key mapping to
toggle the <code>help</code> and <code>text</code> filetypes for the current buffer.</p>
<ul>
<li><a href="https://github.com/sjl/clam.vim/blob/master/doc/clam.txt">Clam</a>, my own plugin for working with shell commands.  It's a pretty short
  example that hits most of the sections I talked about.</li>
<li>The <a href="https://github.com/scrooloose/nerdtree/blob/master/doc/NERD_tree.txt">NERD tree</a>, a file navigation plugin by Scrooloose.  Note the general
  structure, as well as how he summarizes the mappings in an easy-to-read list
  before explaining every one in detail.</li>
<li><a href="https://github.com/tpope/vim-surround/blob/master/doc/surround.txt">Surround</a>, a plugin for handling "surrounding" characters by Tim Pope.
  Note the lack of a table of contents, the different style of section
  headers, and the table column headers.  Figure out how these things were done,
  and decide if you like them.  It's a matter of taste.</li>
<li><a href="https://github.com/sjl/splice.vim/blob/master/doc/splice.txt">Splice</a>, my own plugin for resolving three-way merge conflicts in version
  control systems.  Note how the lists of mappings are formatted, and how I used
  ASCII-art diagrams to explain layouts.  Sometimes a picture really is worth
  a thousand words.</li>
</ul>
<p>Remember that all of the vanilla Vim documentation can also be used as an
example too.  That should give you plenty to study and learn from.</p>
<h2 id="write">Write!</h2>
<p>Now that you've see how some other plugins structured and wrote their
documentation, fill in the sections for your Potion plugin.</p>
<p>If you're not used to writing technical documentation this might be a challenge.
Learning to write certainly isn't simple, but like any other skill it definitely
requires practice, so just go to it!  It doesn't need to be perfect and you can
always improve it later.</p>
<p>Don't be afraid to write something you're not completely sure about and then
throw it away and rewrite it later.  Often just getting <em>something</em> in the
buffer will get your mind in the mood to write.  It'll still be in version
control if you ever want it back any way.</p>
<p>A good way to start is to imagine you've got a friend who also uses Vim sitting
next to you.  They've never used your plugin before but are intrigued, and your
goal is to turn them into an expert user of it.  Thinking about explaining
things to an actual human being will help keep you grounded and avoid getting
too deeply technical before you've established a good overview of how things
work.</p>
<p>If you're still stuck and feel like you're not up to the challenge of writing
the documentation for a full plugin, try doing something smaller.  Pick
a mapping in your <code>~/.vimrc</code> file and document it fully in a comment.  Explain
what it's for, how to use it, and how it works.  For example, this is in my own
<code>~/.vimrc</code> file:</p>
<pre class="codehilite"><code class="language-vim">" "Uppercase word" mapping.
"
" This mapping allows you to press &lt;c-u&gt; in insert mode to convert the
" current word to uppercase.  It's handy when you're writing names of
" constants and don't want to use Capslock.
"
" To use it you type the name of the constant in lowercase.  While
" your cursor is at the end of the word, press &lt;c-u&gt; to uppercase it,
" and then continue happily on your way:
"
"                            cursor
"                            v
"     max_connections_allowed|
"     &lt;c-u&gt;
"     MAX_CONNECTIONS_ALLOWED|
"                            ^
"                            cursor
"
" It works by exiting out of insert mode, recording the current cursor
" location in the z mark, using gUiw to uppercase inside the current
" word, moving back to the z mark, and entering insert mode again.
"
" Note that this will overwrite the contents of the z mark.  I never
" use it, but if you do you'll probably want to use another mark.
inoremap &lt;C-u&gt; &lt;esc&gt;mzgUiw`za</code></pre>


<p>It's much shorter than the documentation for a full plugin, but it's a good
exercise that will help you practice writing.  It's also very helpful for people
reading your <code>~/.vimrc</code> if you put it up on Bitbucket or GitHub.</p>
<h2 id="exercises">Exercises</h2>
<p>Write the documentation for each section of the Potion plugin.</p>
<p>Read <code>:help help-writing</code> for help about writing help.</p>
<p>Read <code>:help :left</code>, <code>:help :right</code>, and <code>:help :center</code> to learn about three
useful commands for getting your ASCII art perfect.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="53.html">&laquo; Previous</a>
            
            
                <a class="next" href="55.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>Distribution / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="55.html#distribution">Distribution</a><ul>
<li><a href="55.html#hosting">Hosting</a></li>
<li><a href="55.html#documentation">Documentation</a></li>
<li><a href="55.html#publicity">Publicity</a></li>
<li><a href="55.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="54.html">&laquo; Prev</a>
            
            
                <a class="next" href="56.html">Next &raquo;</a>
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="distribution">Distribution</h1>
<p>By now you have the Vimscript skills to make Vim plugins many other people might
find useful.  This chapter will go over getting your plugins online and making
them easily available, as well as how to get the word out about them to
potential users.</p>
<h2 id="hosting">Hosting</h2>
<p>The first thing you'll need to do is get your plugin online so other people can
download it.  The canonical place for Vim plugins to live is <a href="http://www.vim.org/scripts/">the scripts
section of the Vim website</a>.</p>
<p>You'll need a free account on the website.  Once you've got one you can click
the "Add Script" link and fill out the form.  It should be pretty self
explanatory.</p>
<p>A recent trend in the past few years has been to distribute plugins by hosting
their repositories in a public place like Bitbucket or GitHub.  The rise in
popularity of this method can probably be attributed to two factors.  First,
Pathogen has made it trivial to keep each installed plugin's code in its own
separate location. The rise of distributed version control systems like
Mercurial and Git and public hosting sites like Bitbucket and GitHub has also
probably had an impact.</p>
<p>Providing repositories is handy for people who keep their dotfiles in
a version-controlled repository of their own.  Mercurial users can use
Mercurial's "subrepositories" to keep track of plugin versions, and Git users
can use submodules (though only for other Git repos, unlike Mercurial's
subrepos).</p>
<p>Having a full repository for each of your installed plugins also makes it easier
to debug when something goes wrong with them.  You can use blame, bisection, and
any of the other tools your VCS provides available to figure out what's going
on.  It's also easier to contribute fixes back if you already have the
repository on your machine.</p>
<p>Hopefully I've convinced you that you should also make your plugin's repository
available publicly.  It doesn't really matter which service you use, as long as
the repository is available <em>somewhere</em>.</p>
<h2 id="documentation">Documentation</h2>
<p>You've already documented your plugin thoroughly in Vim's internal help format,
but your job isn't quite over yet.  You're still going to want to come up with
a quick overview that summarizes a few things:</p>
<ol>
<li>What is your plugin all about?</li>
<li>Why would the user want to use it?</li>
<li>Why is it better than competing plugins (if any)?</li>
<li>What's the license?</li>
<li>A link to a pretty version of the full documentation, rendered by the
   <a href="http://vim-doc.heroku.com/">vim-doc</a> website.</li>
</ol>
<p>This should go in your README file (which will be displayed on the landing page
of Bitbucket and GitHub repos), and you can use it as the description for the
plugin's entry on Vim.org.</p>
<p>Including some screenshots is almost always a great idea.  Being a text-only
editor doesn't mean Vim doesn't have a user interface.</p>
<h2 id="publicity">Publicity</h2>
<p>Once you've got your plugin settled into all its various homes on the web: tell
the world about it!  You could share it with your followers on Twitter, post it
to the <a href="http://reddit.com/r/vim/">/r/vim</a> section of Reddit, write a blog entry about it on your own
personal website, and announce it on the <a href="http://www.vim.org/maillist.php">Vim mailing list</a> for starters.</p>
<p>Whenever you release a creation of yours into the wild you're going to get some
praise and some criticism.  Don't let negative words get to you too much.
Listen to what they say, but keep a thick skin and don't get too emotional when
someone points out flaws (valid or otherwise) in your work.  No one is perfect,
and this is the Internet, so you'll need to be able to take some heat and shrug
it off if you want to stay happy and motivated.</p>
<h2 id="exercises">Exercises</h2>
<p>Create an account on Vim.org if you don't already have one.</p>
<p>Look at the README files for some of your favorite plugins to see how they're
structured and what kind of information they include.</p></div>

        <div class="prevnext">
            
                <a class="prev" href="54.html">&laquo; Previous</a>
            
            
                <a class="next" href="56.html">Next &raquo;</a>
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html><!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>What Now? / Learn Vimscript the Hard Way</title>
        <meta name="description" content="">
        <meta name="author" content="Steve Losh">
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link href="../static/styles/skeleton/base.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/skeleton.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/skeleton/layout.css" rel="stylesheet" type="text/css" />

        <link href="../static/styles/tango.css" rel="stylesheet" type="text/css" />
        <link href="../static/styles/style.less" rel="stylesheet/less" type="text/css" />

        <script type="text/javascript" src="../static/scripts/less.js"></script>
    </head>

    <body class="">
        <div class="container">
            <header class="sixteen columns">
                <h1><a href="https://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></h1>
            </header>

            
    <section class="nav three columns">
        
<ul>
<li><a href="56.html#what-now">What Now?</a><ul>
<li><a href="56.html#color-schemes">Color Schemes</a></li>
<li><a href="56.html#the-command-command">The Command Command</a></li>
<li><a href="56.html#runtimepath">runtimepath</a></li>
<li><a href="56.html#omnicomplete">Omnicomplete</a></li>
<li><a href="56.html#compiler-support">Compiler Support</a></li>
<li><a href="56.html#other-languages">Other Languages</a></li>
<li><a href="56.html#vims-documentation">Vim's Documentation</a></li>
<li><a href="56.html#exercises">Exercises</a></li>
</ul>
</li>
</ul>


        <div class="prevnext">
            
                <a class="prev" href="55.html">&laquo; Prev</a>
            
            
        </div>
    </section>

    <section class="content twelve columns offset-by-one">
        <div> 
<h1 id="what-now">What Now?</h1>
<p>If you've read up to this point and completed all the examples and exercises
you now have a pretty solid grasp of the basics of Vimscript.  Don't worry
though, there's still <em>plenty</em> left to learn!</p>
<p>Here are a few ideas of topics to look into if you're hungry for more.</p>
<h2 id="color-schemes">Color Schemes</h2>
<p>In this book we added syntax highlighting for Potion files.  The other side of
the coin is the creation of custom color schemes that define what color to
display each syntax element.</p>
<p>Color schemes in Vim are fairly straightforward, if a bit repetitive, to make.
Read <code>:help highlight</code> to learn the basics.  You may want to take a look at some
of the built-in color schemes to see how they structure their files.</p>
<p>If you're up for a challenge, take a look at the source of my own <a href="https://github.com/sjl/badwolf/blob/master/colors/badwolf.vim">Bad Wolf</a>
color scheme to see how I've used Vimscript to make the definition and
maintenance much easier for myself.  Pay attention to the "palette" dictionary
and the <code>HL</code> function that dynamically builds the <code>highlight</code> commands.</p>
<h2 id="the-command-command">The Command Command</h2>
<p>Many plugins allow the user to interact with them through key mappings and
function calls, but some prefer to create Ex commands instead.  For example, the
<a href="https://github.com/tpope/vim-fugitive">Fugitive</a> plugin creates commands like <code>:Gbrowse</code> and <code>:Gdiff</code> and leaves it up
to the user to decide how to call them.</p>
<p>Commands like this are created with the <code>:command</code> command.  Read <code>:help
user-commands</code> to learn how to make your own.  You should know enough Vimscript
by now that reading Vim's documentation is sufficient for learning about new
commands.</p>
<h2 id="runtimepath">runtimepath</h2>
<p>In this book I've kind of glossed over how Vim decides which files to load by
saying "just use Pathogen".  Now that you know a decent amount of Vimscript you
can read <code>:help runtimepath</code> and check out <a href="https://github.com/tpope/vim-pathogen/blob/master/autoload/pathogen.vim">Pathogen's source
code</a> to find out what's <em>really</em> happening under the hood.</p>
<h2 id="omnicomplete">Omnicomplete</h2>
<p>Vim offers a number of different ways to complete text (read <code>:help
ins-completion</code> for an overview).  Most are fairly simple, but the most powerful
of them is "omnicomplete" which lets you call a custom Vimscript function to
determine completions in just about any way you could possibly think of.</p>
<p>When you're ready to dive into the rabbit hole of omnicompletion you can start
with <code>:help omnifunc</code> and <code>:help compl-omni</code> and follow the trail from there.</p>
<h2 id="compiler-support">Compiler Support</h2>
<p>In our Potion plugin we created some mappings to compile and run our Potion
files.  Vim offers much deeper support for interacting with compilers, including
parsing compile errors and providing a nice list that lets you jump to the line
of each error.</p>
<p>If you're interested in this you can dive in by reading through <code>:help
quickfix.txt</code> in its entirety.  However, I will warn you now that <code>errorformat</code>
is <em>not</em> for the faint of heart!</p>
<h2 id="other-languages">Other Languages</h2>
<p>This book has focused on Vimscript, but Vim also offers interfaces in several
other languages, like Python, Ruby, and Lua.  This means you can script Vim in
a different language if you don't like Vimscript.</p>
<p>It's still good to know Vimscript for editing your <code>~/.vimrc</code>, and for
understanding the API Vim presents in each language.  But using an alternate
language can be a great way to escape from the cruftiness of Vimscript,
especially for large plugins.</p>
<p>If you want to learn more about scripting Vim in a particular language, check
out the help documents for it:</p>
<ul>
<li><code>:help Python</code></li>
<li><code>:help Ruby</code></li>
<li><code>:help Lua</code></li>
<li><code>:help perl-using</code></li>
<li><code>:help MzScheme</code></li>
</ul>
<h2 id="vims-documentation">Vim's Documentation</h2>
<p>As a final parting note, here's a list of Vim help topics that are especially
useful, informative, interesting, or just plain fun (in no particular order):</p>
<ul>
<li><code>:help various-motions</code></li>
<li><code>:help sign-support</code></li>
<li><code>:help virtualedit</code></li>
<li><code>:help map-alt-keys</code></li>
<li><code>:help error-messages</code></li>
<li><code>:help development</code></li>
<li><code>:help tips</code></li>
<li><code>:help 24.8</code></li>
<li><code>:help 24.9</code></li>
<li><code>:help usr_12.txt</code></li>
<li><code>:help usr_26.txt</code></li>
<li><code>:help usr_32.txt</code></li>
<li><code>:help usr_42.txt</code></li>
</ul>
<h2 id="exercises">Exercises</h2>
<p>Go write a Vim plugin for something you've always wanted and share it with the
world!</p></div>

        <div class="prevnext">
            
                <a class="prev" href="55.html">&laquo; Previous</a>
            
            
        </div>
    </section>


            <footer class="sixteen columns">
                Made by <a href="http://stevelosh.com">Steve Losh</a>.

                <a href="../license.html">License</a>.

                Built with
                <a href="http://bitbucket.org/sjl/bookmarkdown/">Bookmarkdown</a>.
            </footer>
        </div>

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-15328874-8']);
                _gaq.push(['_trackPageview']);

                (function() {
                 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                 })();
            </script>
        

        
            <script type="text/javascript">
                var _gauges = _gauges || [];
                (function() {
                 var t   = document.createElement('script');
                 t.type  = 'text/javascript';
                 t.async = true;
                 t.id    = 'gauges-tracker';
                 t.setAttribute('data-site-id', '4e8f83b7f5a1f546e200000d');
                 t.src = '//secure.gaug.es/track.js';
                 var s = document.getElementsByTagName('script')[0];
                 s.parentNode.insertBefore(t, s);
                 })();
             </script>
        
    </body>
</html>